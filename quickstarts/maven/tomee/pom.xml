<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>org.eclipse.jkube.quickstarts.maven</groupId>
	<artifactId>tomee</artifactId>
	<version>10.0.1</version>
	<name>Eclipse JKube :: Quickstarts :: Maven :: Tomee</name>

	<description>
		Tomee deployment template for JKube
	</description>
	<properties>
		<k8sgroupId>com-example-container</k8sgroupId>
		<jkube.enricher.jkube-project-label.app>${k8sgroupId}-${project.artifactId}</jkube.enricher.jkube-project-label.app>
		<tomee.version>8.0.2</tomee.version>
		<tomee.port>8080</tomee.port>
		<failOnMissingWebXml>false</failOnMissingWebXml>
		<maven.compiler.source>11</maven.compiler.source>
		<maven.compiler.target>11</maven.compiler.target>
		<proj.hostname>container.example.com</proj.hostname>
		<docker.host>dockerhub.example.com</docker.host>
		<timestamp>${maven.build.timestamp}</timestamp>
		<maven.build.timestamp.format>yyyy-MM-dd_HH-mm</maven.build.timestamp.format>
		<work.version>${project.version}</work.version>

	</properties>
	<profiles>
		<profile>
			<id>develop</id>
			<properties>
				<work.version>${project.version}-${timestamp}</work.version>
			</properties>
		</profile>
	</profiles>
	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.tomee.maven</groupId>
				<artifactId>tomee-maven-plugin</artifactId>
				<version>${tomee.version}</version>
				<executions>
					<execution>
						<id>executable-jar</id>
						<phase>package</phase>
						<goals>
							<goal>exec</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<context>ROOT</context>
					<tomeeClassifier>microprofile</tomeeClassifier>
					<tomeeHttpPort>${tomee.port}</tomeeHttpPort>
					<simpleLog>true</simpleLog>
					<inlinedTomEEXml>
						<tomee>
							
						</tomee>
					</inlinedTomEEXml>
					<libs>

					</libs>
					<webapps>

					</webapps>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.eclipse.jkube</groupId>
				<artifactId>kubernetes-maven-plugin</artifactId>
				<version>1.10.1</version>
				<executions>
					<execution>
						<id>k8s-build</id>
						<phase>package</phase>
						<goals>
							<goal>build</goal>
							<goal>resource</goal>
						</goals>
					</execution>
					<execution>
						<id>k8s-install</id>
						<phase>install</phase>
						<goals>
							<goal>push</goal>
							<goal>apply</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<resources>
						<labels>
							<all>
								<property>
									<name>version</name>
									<value>${work.version}</value>
								</property>
							</all>
						</labels>
					</resources>
					<images>
						<image>
							<registry>${docker.host}</registry>

							<name>${project.groupId}.${project.artifactId}:latest</name>
							<build>
								<from>openjdk:11-jre-alpine</from>
								<assembly>
									<inline>
										<files>
											<file>
												<source>target/${project.artifactId}-exec.jar</source>
												<outputDirectory>.</outputDirectory>
											</file>
										</files>
									</inline>
								</assembly>
								<ports>
									<port>${tomee.port}</port>
								</ports>
								<cmd>java -jar maven/${project.artifactId}-exec.jar</cmd>
							</build>
							<run>
								<ports>
									<port>${tomee.port}:${tomee.port}</port>
								</ports>
							</run>
						</image>
					</images>
					<pushRegistry>${docker.host}}</pushRegistry>
				</configuration>
			</plugin>
		</plugins>
	</build>
</project>