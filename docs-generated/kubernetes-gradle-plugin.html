<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>org.eclipse.jkube/kubernetes-gradle-plugin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>org.eclipse.jkube/kubernetes-gradle-plugin</h1>
<div class="details">
<span id="revnumber">version 1.14-SNAPSHOT,</span>
<span id="revdate">2023-07-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">kubernetes-gradle-plugin</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#minikube-gettingstarted">2.1. Minikube</a></li>
<li><a href="#vanilla-kubernetes">2.2. Vanilla Kubernetes Cluster</a></li>
<li><a href="#spring-boot-getting-started">2.3. Spring Boot</a></li>
<li><a href="#vertx-scenario">2.4. Vert.x</a></li>
<li><a href="#quarkus-gettingstarted-scenario">2.5. Quarkus</a></li>
<li><a href="#dockerfile-scenario">2.6. Dockerfile</a></li>
</ul>
</li>
<li><a href="#examples">3. Examples</a>
<ul class="sectlevel2">
<li><a href="#groovy-scenario">3.1. Using Groovy Configuration</a>
<ul class="sectlevel3">
<li><a href="#groovy-scenario-image">3.1.1. Configuring Images</a></li>
<li><a href="#groovy-scenario-image-copy-files">3.1.2. Copying Files/Directories into Image</a></li>
<li><a href="#kubernetes-labels-and-annotations">3.1.3. Kubernetes Labels and Annotations</a></li>
<li><a href="#kubernetes-controller-generation">3.1.4. Kubernetes Controller Generation</a></li>
<li><a href="#kubernetes-ingress-generation">3.1.5. Kubernetes Ingress Generation</a></li>
<li><a href="#kubernetes-serviceaccount-generation">3.1.6. Kubernetes ServiceAccount Generation</a></li>
</ul>
</li>
<li><a href="#kubernetes-resource-fragments">3.2. Kubernetes Resource Fragments</a></li>
<li><a href="#zero-config-scenario">3.3. Zero Configuration</a></li>
</ul>
</li>
<li><a href="#tasks">4. Tasks Overview</a>
<ul class="sectlevel2">
<li><a href="#task-overview-build">4.1. Build And Deployment Tasks</a>
<ul class="sectlevel3">
<li><a href="#jkubeBuild">4.1.1. <strong>k8sBuild</strong></a></li>
<li><a href="#jkubePush">4.1.2. <strong>k8sPush</strong></a></li>
<li><a href="#jkubeResource">4.1.3. <strong>k8sResource</strong></a></li>
<li><a href="#jkubeApply">4.1.4. <strong>k8sApply</strong></a></li>
<li><a href="#jkubeHelm">4.1.5. <strong>k8sHelm</strong></a></li>
<li><a href="#jkubeHelmPush">4.1.6. <strong>k8sHelmPush</strong></a></li>
</ul>
</li>
<li><a href="#task-overview-develop">4.2. Development Tasks</a>
<ul class="sectlevel3">
<li><a href="#jkubeUndeploy">4.2.1. <strong>k8sUndeploy</strong></a></li>
<li><a href="#jkubeLog">4.2.2. <strong>k8sLog</strong></a></li>
<li><a href="#jkubeDebug">4.2.3. <strong>k8sDebug</strong></a></li>
<li><a href="#jkube:remote-dev">4.2.4. <strong>k8sRemoteDev</strong> (preview)</a></li>
<li><a href="#jkube:watch">4.2.5. <strong>k8sWatch</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#groovy-configuration">5. Gradle Groovy DSL Configuration</a>
<ul class="sectlevel2">
<li><a href="#global-configuration">5.1. Global Configuration</a></li>
<li><a href="#image-configuration">5.2. Image Configuration</a>
<ul class="sectlevel3">
<li><a href="#build-configuration">5.2.1. Build Configuration</a></li>
<li><a href="#build-assembly">5.2.2. Assembly</a></li>
<li><a href="#build-assembly-layer">5.2.3. Assembly - Inline/Layer</a></li>
<li><a href="#build-buildargs">5.2.4. Build Args</a></li>
</ul>
</li>
<li><a href="#misc-env">5.3. Environment and Labels</a></li>
<li><a href="#misc-startup">5.4. Startup Arguments</a></li>
<li><a href="#kubernetes-resource-configuration">5.5. Kubernetes Resource Configuration</a>
<ul class="sectlevel3">
<li><a href="#labels-annotation-configuration">5.5.1. Labels/Annotations</a></li>
<li><a href="#resource-controller-generation">5.5.2. Controller Generation</a></li>
<li><a href="#probe-resources-configuration">5.5.3. Probe Configuration</a></li>
<li><a href="#volume-resource-configuration">5.5.4. Volume Configuration</a></li>
<li><a href="#resource-secrets">5.5.5. Secrets</a></li>
<li><a href="#ingress-generation">5.5.6. Ingress Generation</a></li>
<li><a href="#serviceaccount-generation">5.5.7. ServiceAccount Generation</a></li>
<li><a href="#resource-validation">5.5.8. Resource Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#generators">6. Generators</a>
<ul class="sectlevel2">
<li><a href="#generators-default">6.1. Default Generators</a>
<ul class="sectlevel3">
<li><a href="#generator-java-exec">6.1.1. Java Applications</a></li>
<li><a href="#generator-spring-boot">6.1.2. Spring Boot</a></li>
<li><a href="#generator-thorntail-v2">6.1.3. Thorntail v2</a></li>
<li><a href="#generator-vertx">6.1.4. Vert.x</a></li>
<li><a href="#generator-webapp">6.1.5. Web Applications</a></li>
<li><a href="#generator-quarkus">6.1.6. Quarkus</a></li>
<li><a href="#generator-openliberty">6.1.7. Open Liberty</a></li>
<li><a href="#generator-micronaut">6.1.8. Micronaut Generator</a></li>
<li><a href="#generator-helidon">6.1.9. Helidon</a></li>
</ul>
</li>
<li><a href="#generators-api">6.2. Generator API</a></li>
</ul>
</li>
<li><a href="#enrichers">7. Enrichers</a>
<ul class="sectlevel2">
<li><a href="#enrichers-default">7.1. Default Enrichers</a>
<ul class="sectlevel3">
<li><a href="#enrichers-generic">7.1.1. Generic Enrichers</a></li>
<li><a href="#enrichers-specific">7.1.2. Specific Enrichers</a></li>
</ul>
</li>
<li><a href="#enricher-api">7.2. Enricher API</a></li>
</ul>
</li>
<li><a href="#profiles">8. Profiles</a>
<ul class="sectlevel2">
<li><a href="#generator-enricher-definition">8.1. Generator and Enricher definitions</a></li>
<li><a href="#profiles-lookup-order">8.2. Lookup order</a></li>
<li><a href="#profiles-using">8.3. Using Profiles</a></li>
<li><a href="#profiles-predefined">8.4. Predefined Profiles</a></li>
<li><a href="#profiles-extended">8.5. Extending Profiles</a></li>
</ul>
</li>
<li><a href="#jkube-plugin">9. JKube Plugins</a></li>
<li><a href="#registry">10. Registry handling</a></li>
<li><a href="#authentication">11. Registry Authentication</a>
<ul class="sectlevel2">
<li><a href="#pull-vs-push-authentication">11.1. Pull vs. Push Authentication</a></li>
</ul>
</li>
<li><a href="#kind-filename-mapping">12. Kind/Filename Mapping</a>
<ul class="sectlevel2">
<li><a href="#default-kind-filename-mapping">12.1. Default Kind/Filename Mapping</a></li>
<li><a href="#custom-kind-mapping">12.2. Custom Kind/Filename Mapping</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2021 The original authors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>kubernetes-gradle-plugin</strong> brings your Gradle Java applications on to
<a href="http://kubernetes.io/">Kubernetes</a>.
This plugin focuses on two tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Building Container images.</p>
</li>
<li>
<p>Creating Kubernetes resource descriptors.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">2. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When working with kubernetes-gradle-plugin, you&#8217;ll probably be facing similar situations and following
the same patterns other users do. These are some of the most common scenarios and
configuration modes:</p>
</div>
<div class="sect2">
<h3 id="minikube-gettingstarted">2.1. Minikube</h3>
<div class="paragraph">
<p>This is an example of how you can use the JKube zero configuration to build and deploy your Java application with Minikube. This is using a Quarkus project, but it could be changed to any supported Java framework.</p>
</div>
<div id="minikube-gettingstarted-prerequisites" class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>You will need the following for the scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minikube</code> installed and running on your computer</p>
</li>
<li>
<p><code>minikube</code> ingress addon enabled</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ minikube addons enable ingress</code></pre>
</div>
</div>
</li>
<li>
<p>Use the docker daemon installed in minikube</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ eval $(minikube -p minikube docker-env)</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div id="minikube-gettingstarted-zero-configuration" class="paragraph">
<p><strong>Zero configuration</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by generating a new Gradle Quarkus project from <a href="https://code.quarkus.io" class="bare">https://code.quarkus.io</a>. Make sure gradle is selected. Download the generated project and extract the content.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>2.
Open the <code>build.gradle</code> file and add the plugin in the <code>plugins</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
   id 'java'
   id 'io.quarkus'
   id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.
Run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew quarkusBuild k8sBuild k8sResource k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task <a href="#jkubePush"><strong>k8sPush</strong></a> is not required as we are using the Minikube internal container image registry.</p>
</div>
<div class="paragraph">
<p>At this point, the Quarkus app has been built, containerized, configured for kubernetes and deployed to the minikube cluster. But there is no external endpoint to access to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP    14h
quarkus      ClusterIP   10.101.31.90   &lt;none&gt;        8080/TCP   13h

$ kubectl get ingress
No resources found in default namespace.</code></pre>
</div>
</div>
<div id="minikube-gettingstarted-external-url" class="paragraph">
<p><strong>External URL</strong></p>
</div>
<div class="paragraph">
<p>To make this service available publicly, change the settings in project properties.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the minikube ip address</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ minikube ip
192.168.99.102</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following in the properties. For the domain, we are using <code>nip.io</code> service that dynamically maps custom hostname and IP address and avoid editing the <code>/etc/hosts</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># Enable Creating External Urls
jkube.createExternalUrls=true
# Configure host domain suffix for Ingress
jkube.domain=192.168.99.102.nip.io</code></pre>
</div>
</div>
</li>
<li>
<p>Re-generate and apply the kubernetes resource</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sResource k8sApply</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure the ingress resource has been created</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ kubectl get ingress
NAME      CLASS    HOSTS                           ADDRESS          PORTS   AGE
quarkus   &lt;none&gt;   quarkus.192.168.99.102.nip.io   192.168.99.102   80      30m</code></pre>
</div>
</div>
</li>
<li>
<p>Give it a try:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ curl http://quarkus.192.168.99.102.nip.io/hello
Hello RESTEasy</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="vanilla-kubernetes">2.2. Vanilla Kubernetes Cluster</h3>
<div class="paragraph">
<p>This is an example of how you can use the kubernetes-gradle-plugin to build and deploy your Java application to any Kubernetes Cluster.</p>
</div>
<div id="vanilla-kubernetes-prerequisites" class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>You will need the following for the scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes Cluster</p>
</li>
<li>
<p>Access to a Container registry (Docker Hub/Quay.io)</p>
</li>
<li>
<p>A <a href="https://adoptopenjdk.net/">Java Development Kit</a> (JDK)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Adding kubernetes-gradle-plugin to project</strong></p>
</div>
<div class="paragraph">
<p>You would need to add kubernetes-gradle-plugin to your project in order to use it:</p>
</div>
<div class="paragraph">
<p>Open the <code>build.gradle</code> file and add the plugin in the <code>plugins</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
   id 'java'
   id 'io.quarkus'
   id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Building and pushing image to Container registry</strong></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve set up your project and tested it, You can create a container image for your application using kubernetes-gradle-plugin. If you&#8217;ve access to a docker daemon try running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have access to any docker daemon, you can configure kubernetes-gradle-plugin to use JIB mode as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.build.strategy=jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running this command you&#8217;ll see kubernetes-gradle-plugin created a container image with opinionated defaults by inspecting your project dependencies. However, you would want to configure the name of the container image.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to push your image to Quay.io with username foo. You can configure image name by running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve created a container image of your application, you need to push it to some container registry. Make sure you&#8217;ve already created account on some public/private container registry. You can provide your credentials either via environment variables or plugin configuration. kubernetes-gradle-plugin also tries to read <code>~/.docker/config.json</code> that gets created after <code>docker login</code>. You can read more about this in <a href="#authentication">Authentication</a> section.</p>
</div>
<div class="paragraph">
<p>Log into your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ docker login quay.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this command to instruct kubernetes-gradle-plugin to push container image you built in previous step to your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sPush -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generating &amp; applying Kubernetes manifests</strong></p>
</div>
<div class="paragraph">
<p>Just like container image, kubernetes-gradle-plugin can generate opinionated Kubernetes manifests. Run this command to automatically generate and apply manifests onto currently logged in Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sResource k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running these tasks, you can also check Kubernetes manifests generated by kubernetes-gradle-plugin in <code>build/classes/java/main/META-INF/jkube/</code> directory.</p>
</div>
<div class="paragraph">
<p>Cleanup applied Kubernetes resources after testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sUndeploy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-getting-started">2.3. Spring Boot</h3>
<div class="paragraph">
<p>kubernetes-gradle-plugin works with any Spring Boot project without any configuration. It automatically detects your project dependencies and generated opinionated container image and Kubernetes manifests.</p>
</div>
<div class="paragraph">
<p><strong>Adding kubernetes-gradle-plugin to project</strong></p>
</div>
<div class="paragraph">
<p>You would need to add kubernetes-gradle-plugin to your project in order to use it:</p>
</div>
<div class="paragraph">
<p>Open the <code>build.gradle</code> file and add the plugin in the <code>plugins</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
   id 'java'
   id 'io.quarkus'
   id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Building and pushing image to Container registry</strong></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve set up your project and tested it, You can create a container image for your application using kubernetes-gradle-plugin. If you&#8217;ve access to a docker daemon try running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have access to any docker daemon, you can configure kubernetes-gradle-plugin to use JIB mode as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.build.strategy=jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running this command you&#8217;ll see kubernetes-gradle-plugin created a container image with opinionated defaults by inspecting your project dependencies. However, you would want to configure the name of the container image.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to push your image to Quay.io with username foo. You can configure image name by running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve created a container image of your application, you need to push it to some container registry. Make sure you&#8217;ve already created account on some public/private container registry. You can provide your credentials either via environment variables or plugin configuration. kubernetes-gradle-plugin also tries to read <code>~/.docker/config.json</code> that gets created after <code>docker login</code>. You can read more about this in <a href="#authentication">Authentication</a> section.</p>
</div>
<div class="paragraph">
<p>Log into your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ docker login quay.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this command to instruct kubernetes-gradle-plugin to push container image you built in previous step to your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sPush -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generating &amp; applying Kubernetes manifests</strong></p>
</div>
<div class="paragraph">
<p>Just like container image, kubernetes-gradle-plugin can generate opinionated Kubernetes manifests. Run this command to automatically generate and apply manifests onto currently logged in Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sResource k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running these tasks, you can also check Kubernetes manifests generated by kubernetes-gradle-plugin in <code>build/classes/java/main/META-INF/jkube/</code> directory.</p>
</div>
<div class="paragraph">
<p>Cleanup applied Kubernetes resources after testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sUndeploy</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>How to add a liveness and readiness probe?</strong></p>
</div>
<div class="paragraph">
<p>kubernetes-gradle-plugin automatically adds Kubernetes liveness and readiness probes in generated Kubernetes manifests in presence of <a href="https://docs.spring.io/spring-boot/docs/2.5.6/reference/html/actuator.html">Spring Boot Actuator</a> dependency.</p>
</div>
<div class="paragraph">
<p>To add actuator to your project, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-gradle" data-lang="gradle">dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you run k8sResource task again, you should be able to see liveness and readiness probes added in generated manifests.</p>
</div>
</div>
<div class="sect2">
<h3 id="vertx-scenario">2.4. Vert.x</h3>
<div class="paragraph">
<p>You can easily get started with using kubernetes-gradle-plugin on an <a href="https://start.vertx.io/">Eclipse Vert.x</a> without providing any explicit configuration. kubernetes-gradle-plugin would generate an opinionated container image and manifests by inspecting your project configuration.</p>
</div>
<div class="paragraph">
<p><strong>Adding kubernetes-gradle-plugin to project</strong></p>
</div>
<div class="paragraph">
<p>You would need to add kubernetes-gradle-plugin to your project in order to use it:</p>
</div>
<div class="paragraph">
<p>Open the <code>build.gradle</code> file and add the plugin in the <code>plugins</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
   id 'java'
   id 'io.quarkus'
   id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Building and pushing image to Container registry</strong></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve set up your project and tested it, You can create a container image for your application using kubernetes-gradle-plugin. If you&#8217;ve access to a docker daemon try running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have access to any docker daemon, you can configure kubernetes-gradle-plugin to use JIB mode as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.build.strategy=jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running this command you&#8217;ll see kubernetes-gradle-plugin created a container image with opinionated defaults by inspecting your project dependencies. However, you would want to configure the name of the container image.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to push your image to Quay.io with username foo. You can configure image name by running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve created a container image of your application, you need to push it to some container registry. Make sure you&#8217;ve already created account on some public/private container registry. You can provide your credentials either via environment variables or plugin configuration. kubernetes-gradle-plugin also tries to read <code>~/.docker/config.json</code> that gets created after <code>docker login</code>. You can read more about this in <a href="#authentication">Authentication</a> section.</p>
</div>
<div class="paragraph">
<p>Log into your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ docker login quay.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this command to instruct kubernetes-gradle-plugin to push container image you built in previous step to your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sPush -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generating &amp; applying Kubernetes manifests</strong></p>
</div>
<div class="paragraph">
<p>Just like container image, kubernetes-gradle-plugin can generate opinionated Kubernetes manifests. Run this command to automatically generate and apply manifests onto currently logged in Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sResource k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running these tasks, you can also check Kubernetes manifests generated by kubernetes-gradle-plugin in <code>build/classes/java/main/META-INF/jkube/</code> directory.</p>
</div>
<div class="paragraph">
<p>Cleanup applied Kubernetes resources after testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sUndeploy</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>How to set Service Port?</strong></p>
</div>
<div class="paragraph">
<p>By default, in Vert.x applications, application port value is 8888. kubernetes-gradle-plugin opinionated defaults use port 8080. If you want to change this, you&#8217;ll need to configure kubernetes-gradle-plugin to generate image with desired port:</p>
</div>
<div class="listingblock">
<div class="title">Example for setting port number for vertx apps</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  generator {
      config {
          'vertx' {
              webPort = '8888'
          }
      }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once configured, you can go ahead and deploy application to Kubernetes.</p>
</div>
<div class="paragraph">
<p><strong>How to add Kubernetes Readiness Liveness probes?</strong></p>
</div>
<div class="paragraph">
<p>kubernetes-gradle-plugin doesn&#8217;t add any Kubernetes liveness and readiness probes by default. However, it does provide a rich set of configuration options to add health checks. Read <a href="#jkube-healthcheck-vertx">Vert.x Healthchecks</a> section for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="quarkus-gettingstarted-scenario">2.5. Quarkus</h3>
<div class="paragraph">
<p>You can easily get started with using kubernetes-gradle-plugin on a <a href="https://code.quarkus.io/">Quarkus</a> project without providing any explicit configuration. kubernetes-gradle-plugin would generate an opinionated container image and manifests by inspecting your project configuration.</p>
</div>
<div class="paragraph">
<p><strong>Zero Configuration</strong></p>
</div>
<div class="paragraph">
<p><strong>Adding kubernetes-gradle-plugin to project</strong></p>
</div>
<div class="paragraph">
<p>You would need to add kubernetes-gradle-plugin to your project in order to use it:</p>
</div>
<div class="paragraph">
<p>Open the <code>build.gradle</code> file and add the plugin in the <code>plugins</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
   id 'java'
   id 'io.quarkus'
   id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Building and pushing image to Container registry</strong></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve set up your project and tested it, You can create a container image for your application using kubernetes-gradle-plugin. If you&#8217;ve access to a docker daemon try running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have access to any docker daemon, you can configure kubernetes-gradle-plugin to use JIB mode as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.build.strategy=jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running this command you&#8217;ll see kubernetes-gradle-plugin created a container image with opinionated defaults by inspecting your project dependencies. However, you would want to configure the name of the container image.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to push your image to Quay.io with username foo. You can configure image name by running this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sBuild -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve created a container image of your application, you need to push it to some container registry. Make sure you&#8217;ve already created account on some public/private container registry. You can provide your credentials either via environment variables or plugin configuration. kubernetes-gradle-plugin also tries to read <code>~/.docker/config.json</code> that gets created after <code>docker login</code>. You can read more about this in <a href="#authentication">Authentication</a> section.</p>
</div>
<div class="paragraph">
<p>Log into your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ docker login quay.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this command to instruct kubernetes-gradle-plugin to push container image you built in previous step to your container registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sPush -Pjkube.generator.name="quay.io/foo/%a:%l"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generating &amp; applying Kubernetes manifests</strong></p>
</div>
<div class="paragraph">
<p>Just like container image, kubernetes-gradle-plugin can generate opinionated Kubernetes manifests. Run this command to automatically generate and apply manifests onto currently logged in Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sResource k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running these tasks, you can also check Kubernetes manifests generated by kubernetes-gradle-plugin in <code>build/classes/java/main/META-INF/jkube/</code> directory.</p>
</div>
<div class="paragraph">
<p>Cleanup applied Kubernetes resources after testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ ./gradlew k8sUndeploy</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Quarkus Native Mode</strong></p>
</div>
<div class="paragraph">
<p>While containerizing a Quarkus application under native mode, kubernetes-gradle-plugin would automatically detect that it&#8217;s a native executable artifact and would select a lighter base image while containerizing application. There is no additional configuration needed by kubernetes-gradle-plugin for Native Builds.</p>
</div>
<div class="paragraph">
<p><strong>How to add Kubernetes liveness and readiness probes?</strong></p>
</div>
<div class="paragraph">
<p>kubernetes-gradle-plugin automatically adds Kubernetes liveness and readiness probes in generated Kubernetes manifests in presence of <a href="https://quarkus.io/guides/smallrye-health">SmallRye Health</a> dependency.</p>
</div>
<div class="paragraph">
<p>To add SmallRye to your project, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-gradle" data-lang="gradle">dependencies {
    implementation 'io.quarkus:quarkus-smallrye-health'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you run k8sResource task again, you should be able to see liveness and readiness probes added in generated manifests.</p>
</div>
</div>
<div class="sect2">
<h3 id="dockerfile-scenario">2.6. Dockerfile</h3>
<div class="paragraph">
<p>You can build a container image and deploy to Kubernetes with kubernetes-gradle-plugin by just providing a <a href="#external-dockerfile">Dockerfile</a>.
kubernetes-gradle-plugin builds a container image based on your Dockerfile and generates
opinionated Kubernetes manifests by inspecting it.</p>
</div>
<div id="simple-dockerfile-mode-scenario" class="paragraph">
<p><strong>Placing Dockerfile in project root directory</strong></p>
</div>
<div class="paragraph">
<p>You can place the Dockerfile in the project root directory along with <code>build.gradle</code>.</p>
</div>
<div class="paragraph">
<p>kubernetes-gradle-plugin detects it and automatically builds an image based on this Dockerfile.
There is no need to provide any sort of configuration apart from Dockerfile and project root directory as docker context directory.
The Image is created with an opinionated name from group, artifact and version.
The name can be overridden by using the <code>jkube.image.name</code> property.
Read <a href="#simple-dockerfile-build">Simple Dockerfile</a> section for more details.</p>
</div>
<div id="docker-file-provided-mode-scenario" class="paragraph">
<p><strong>Placing Dockerfile in some other directory</strong></p>
</div>
<div class="paragraph">
<p>You can choose to place your Dockerfile at some other location.
By default, the plugin assumes it to be <code>src/main/docker</code>, but you&#8217;ll need to configure docker context directory in plugin configuration.
When not specified, context directory is assumed to be Dockerfile&#8217;s parent directory.
You can take a look at <a href="https://github.com/eclipse/jkube/tree/master/quickstarts/gradle/docker-file-provided-docker-file">Docker File Provided Quickstarts</a> for more details.</p>
</div>
<div id="docker-file-mode-include-exclude" class="paragraph">
<p><strong>Controlling what gets copied to image</strong></p>
</div>
<div class="paragraph">
<p>When using Dockerfile mode, every file and directory present in the Docker build context directory
gets copied to the created Docker image.
In case you want to ignore some files, or you want to include only a specific set of files,
the kubernetes-gradle-plugin provides the following options to achieve this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ex-build-dockerinclude"><code>.jkube-dockerinclude</code></a> : Include only a specific set of files specified in this file</p>
</li>
<li>
<p><a href="#ex-build-dockerexclude"><code>.jkube-dockerexclude</code></a> : Exclude a certain set of files from being copied into container image</p>
</li>
<li>
<p><a href="#ex-build-dockerexclude"><code>.jkube-dockerignore</code></a>  : Same as <code>.jkube-dockerexclude</code>, ignore certain files from being copied into container image</p>
</li>
</ul>
</div>
<div id="docker-file-mode-property-placeholders" class="paragraph">
<p><strong>Using Property placeholders in Dockerfiles</strong></p>
</div>
<div class="paragraph">
<p>You can reference properties in your Dockerfiles using standard maven property placeholders <code>${*}</code>. For example, if you have a property in your <code>gradle.properties</code> like this:</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre>fromImage = fabric8/s2i-java</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM ${fromImage}:latest-java11</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override placeholders using the filter field in image build configuration, see <a href="#build-filtering">Build Filtering</a> for more details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">3. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s have a look at some code. The following examples will demonstrate all available configurations variants:</p>
</div>
<div class="sect2">
<h3 id="groovy-scenario">3.1. Using Groovy Configuration</h3>
<div class="paragraph">
<p>If the <a href="#zero-config-scenario">zero configuration</a> mode doesn&#8217;t fit your use case, and you want more
flexibility, you can also use kubernetes-gradle-plugin Groovy configuration to configure
plugin as per your needs.
kubernetes-gradle-plugin provides a rich set of configuration in form of Groovy DSL which
can be used to tune plugin&#8217;s output as per your specific requirements.</p>
</div>
<div class="paragraph">
<p>The plugin configuration can be roughly divided into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global configuration options are responsible for tuning the behavior of plugin tasks.</p>
</li>
<li>
<p><code>images</code> defines which container <a href="#config-image">images</a> are used and configured.</p>
</li>
<li>
<p><code>resources</code> defines the resource descriptors for deploying on Kubernetes cluster.</p>
</li>
<li>
<p><code>enricher</code> configures various aspects of creating and enhancing resource descriptors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A working example can be found in <a href="https://github.com/eclipse/jkube/tree/master/quickstarts/gradle/groovy-dsl-config"><code>quickstarts/gradle/groovy-dsl-config</code></a> directory.</p>
</div>
<div class="sect3">
<h4 id="groovy-scenario-image">3.1.1. Configuring Images</h4>
<div class="paragraph">
<p>This section provides an overview of <code>images</code> element with which you can configure different aspects of container images generated by kubernetes-gradle-plugin.
Here is an example of providing Groovy DSL configuration for a simple image:</p>
</div>
<div class="listingblock">
<div class="title">Example for providing image using Groovy DSL configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = "jkube/${project.name}:${project.version}" <i class="conum" data-value="1"></i><b>(1)</b>
            alias = "camel-service" <i class="conum" data-value="2"></i><b>(2)</b>
            build {
                from = "quay.io/jkube/jkube-java:0.0.13" <i class="conum" data-value="3"></i><b>(3)</b>
                assembly { <i class="conum" data-value="4"></i><b>(4)</b>
                    targetDir = "/deployments" <i class="conum" data-value="5"></i><b>(5)</b>
                    layers = [{ <i class="conum" data-value="6"></i><b>(6)</b>
                        fileSets = [{ <i class="conum" data-value="7"></i><b>(7)</b>
                            directory = file("${project.rootDir}/build/dependencies")
                       }]
                    }]
                }
                env { <i class="conum" data-value="8"></i><b>(8)</b>
                    JAVA_LIB_DIR = "/deployments/dependencies/*"
                    JAVA_MAIN_CLASS = "org.apache.camel.cdi.Main"
                }
                labels { <i class="conum" data-value="9"></i><b>(9)</b>
                    labelWithValue = "foo"
                    version = "${project.version}"
                    artifactId = "${project.name}"
                }
                ports = ["8787"] <i class="conum" data-value="10"></i><b>(10)</b>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name with which we want our image to be built; See <code>name</code> field in <a href="#config-image">Image Configuration</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Shortcut name for image; See <code>alias</code> field in <a href="#config-image">Image Configuration</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Base image on which this image would be built upon; See <code>from</code> field in <a href="#config-image-build">Image Build Configuration</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assembly Configuration for copying files/directories into image.
See <a href="#config-image-build-assembly">Assembly Configuration</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Target directory inside image for copying a directory into image</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Assembly layer; See <a href="#build-assembly-layer">Assembly Inline/Layer Configuration</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>FileSet Assembly Configuraton for copying directories.
See <code>fileSets</code> field in <a href="#build-assembly-layer">Assembly Layer Configuration</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Environment variables added to image.
See <a href="#misc-env">Environment and Labels</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Labels added to image.
See <a href="#misc-env">Environment and Labels</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Ports to be exposed.
See <code>port</code> field in <a href="#config-image-build">Image Build Configuration</a> for details.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can read more about supported fields in <code>image</code> configuration element in <a href="#config-image">Image Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="groovy-scenario-image-copy-files">3.1.2. Copying Files/Directories into Image</h4>
<div class="paragraph">
<p>If you want to copy some files/directories into your image.
You can make use of kubernetes-gradle-plugin <a href="#config-image-build-assembly">Assembly Configuration</a>.
You would need to provide <code>assembly</code> element in <code>image</code> &gt; <code>build</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of copying a single jar file into image.
This configuration would copy a jar file located in <code>build/libs/</code> to  <code>/deployments</code> folder inside the image:</p>
</div>
<div class="listingblock">
<div class="title">Example for copying a file to image using Groovy DSL configuration:</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = "${project.group}/${project.name}:${project.version}"
            build {
                from = "quay.io/jkube/jkube-java:0.0.13"
                assembly {
                    targetDir = "/deployments"
                    layers = [{
                        id = "custom-assembly-for-copying-file"
                        files = [{
                            source = file("build/libs/${project.name}-${project.version}-all.jar")
                            outputDirectory = "."
                        }]
                    }]
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to copy directories, you would be using <code>fileSets</code> configuration element instead of <code>files</code>.
Here is an example of copying directories.
This example would copy <code>build/dependencies</code> directory to <code>/deployments</code> directory inside image.</p>
</div>
<div class="listingblock">
<div class="title">Example for copying a directory to image using Groovy DSL configuration:</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = "${project.group}/${project.name}:${project.version}"
            build {
                from = "quay.io/jkube/jkube-java:0.0.13"
                assembly {
                    targetDir = "/deployments"
                    layers = [{
                        id = "custom-assembly-for-copying-directory"
                        fileSets = [{
                            directory = file("${project.rootDir}/build/dependencies")
                       }]
                    }]
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-labels-and-annotations">3.1.3. Kubernetes Labels and Annotations</h4>
<div class="paragraph">
<p>Refer to <a href="#labels-annotation-configuration">Labels/Annotations Configuration</a> in Kubernetes Resource Configuration</p>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-controller-generation">3.1.4. Kubernetes Controller Generation</h4>
<div class="paragraph">
<p>Refer to <a href="#resource-controller-generation">Kubernetes Controller Resource Generation</a> in Kubernetes Resource Configuration</p>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-ingress-generation">3.1.5. Kubernetes Ingress Generation</h4>
<div class="paragraph">
<p>Refer to <a href="#ingress-generation">Ingress Generation</a> in Kubernetes Resource Configuration</p>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-serviceaccount-generation">3.1.6. Kubernetes ServiceAccount Generation</h4>
<div class="paragraph">
<p>Refer to <a href="#serviceaccount-generation">ServiceAccount Generation</a> in Kubernetes Resource Configuration</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes-resource-fragments">3.2. Kubernetes Resource Fragments</h3>
<div class="paragraph">
<p>You can also use an external configuration in form of YAML resource descriptors which are located in the  <code>src/main/jkube</code> directory. Each resource gets its own file, which contains a skeleton of a resource descriptor. The plugin will pick up the resource, enrich it and then combine all to a single <code>kubernetes.yml</code> and <code>openshift.yml</code> file. Within these descriptor files you are can freely use any Kubernetes feature.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at an example from
<a href="https://github.com/eclipse/jkube/tree/master/quickstarts/gradle/external-resources">quickstarts/gradle/external-resources</a>.
This is a plain Spring Boot application, whose images are auto generated like in case of no configuration.
The resource fragments are in <code>src/main/jkube</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment "deployment.yml"</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  replicas: 1
  template:
    spec:
      volumes:
        - name: config
          gitRepo:
            repository: 'https://github.com/jstrachan/sample-springboot-config.git'
            revision: 667ee4db6bc842b127825351e5c9bae5a4fb2147
            directory: .
      containers:
        - volumeMounts:
            - name: config
              mountPath: /app/config
          env:
            - name: MY_POD_NAMESPACE
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
      serviceAccount: ribbon</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there is no <code>metadata</code> section as would be expected for Kubernetes resources because it will be automatically added by the <code>kubernetes-gradle-plugin</code>. The object&#8217;s <code>Kind</code>, if not given, is automatically derived from the
filename. In this case, the <code>kubernetes-gradle-plugin</code> will create a <code>Deployment</code> because the file is called <code>deployment.yml</code>. Similar mappings between file names and resource type exist for each supported resource kind, the
complete list of which (along with associated abbreviations) can be found in the <a href="#default-kind-filename-mapping">Kind Filename Mapping</a> section.</p>
</div>
<div class="paragraph">
<p>Additionally, if you name your fragment using a name prefix followed by a dash and the mapped file name, the plugin will automatically use that name for your resource. So, for example, if you name your deployment fragment
<code>myapp-deployment.yml</code>, the plugin will name your resource <code>myapp</code>. In the absence of such provided name for your resource, a name will be automatically derived from your project&#8217;s metadata (in particular, its project <code>name</code> as specified in your <code>build.gradle</code>).</p>
</div>
<div class="paragraph">
<p>No image is also referenced in this example because the plugin also fills in the image details based on the configured image you are building with (either from a generator or from a dedicated image plugin configuration, as seen before).</p>
</div>
<div class="paragraph">
<p>Enrichment of resource fragments can be fine-tuned by using profile sub-directories.</p>
</div>
</div>
<div class="sect2">
<h3 id="zero-config-scenario">3.3. Zero Configuration</h3>
<div class="paragraph">
<p>It&#8217;s very common, especially when dealing with the inner development loop, that you
don&#8217;t need to provide any configuration for your Gradle project.
You can get started simply by adding the plugin to your build.gradle file:</p>
</div>
<div class="listingblock">
<div class="title">Example for setting up the kubernetes-gradle-plugin in build.gradle</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
  id 'org.eclipse.jkube.kubernetes' version '1.14-SNAPSHOT'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, kubernetes-gradle-plugin analyzes your project and configures the container image and the
cluster configuration manifests using a set of opinionated defaults.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tasks">4. Tasks Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin supports a rich set for providing a smooth Java developer experience.
These tasks can be categorized in multiple groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#tasks-build">Build and Deployment tasks</a> are all about creating and managing Kubernetes build artifacts like Docker images or S2I builds.</p>
</li>
<li>
<p><a href="#tasks-develop">Development tasks</a> target help not only in developing resource descriptors to the development cluster but also to manage the lifecycle of the development cluster as well.</p>
</li>
</ul>
</div>
<table id="tasks-build" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Build &amp; Deployment Tasks</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeBuild"><strong>k8sBuild</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubePush"><strong>k8sPush</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pushes the built images to the container image registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeResource"><strong>k8sResource</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate resource manifests for your application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeApply"><strong>k8sApply</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applies the generated resources to the connected cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeHelm"><strong>k8sHelm</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate Helm charts for your application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeHelmPush"><strong>k8sHelmPush</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upload Helm charts to Helm repositories.</p></td>
</tr>
</tbody>
</table>
<table id="tasks-develop" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Development Tasks</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeDebug"><strong>k8sDebug</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug your Java app running on the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeLog"><strong>k8sLog</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the logs of your Java app running on the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkubeUndeploy"><strong>k8sUndeploy</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes the kubernetes resources that you deployed via the <a href="#jkubeApply"><strong>k8sApply</strong></a> task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube:remote-dev"><strong>k8sRemoteDev</strong> (preview)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a remote development session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#jkube:watch"><strong>k8sWatch</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watch for file changes and perform rebuilds and redeployments</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="task-overview-build">4.1. Build And Deployment Tasks</h3>
<div class="sect3">
<h4 id="jkubeBuild">4.1.1. <strong>k8sBuild</strong></h4>
<div class="paragraph">
<p>This task is for building container images for your application.</p>
</div>
<div class="sect4">
<h5 id="build-kubernetes">Kubernetes Build</h5>
<div class="paragraph">
<p>A normal Docker build is performed by default.For Kubernetes builds the kubernetes-gradle-plugin uses the Docker remote API so the URL of your Docker Daemon must be specified.The URL can be specified by the dockerHost or machine configuration, or by the <code>DOCKER_HOST</code> environment variable.</p>
</div>
<div class="paragraph">
<p>The Docker remote API supports communication via SSL and authentication with certificates.The path to the certificates can be specified by the certPath or machine configuration, or by the <code>DOCKER_CERT_PATH</code> environment variable.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have access to docker daemon, you can change build strategy using <code>buildStrategy</code> option in Groovy configuration like this:</p>
</div>
<div class="listingblock">
<div class="title">Example of overriding default build strategy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    buildStrategy = 'jib'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the different options supported by <code>buildStrategy</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. JKube Build Strategies</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildStrategy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker build with a binary source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deamonless container image creation using <a href="https://github.com/GoogleContainerTools/jib">JIB</a> build</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>kubernetes-gradle-plugin by default tries to build up an opinionated <a href="#config-image">Image Configuration</a> by inspecting <code>build.gradle</code>.
You can also provide your own <a href="#dockerfile-scenario">Dockerfile</a> or provide Custom ImageConfiguration via <a href="#groovy-scenario-image">Groovy DSL configuration</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jkubePush">4.1.2. <strong>k8sPush</strong></h4>
<div class="paragraph">
<p>This task uploads images to the registry which have a <code>build</code> configuration section.
The images to push can be restricted with the global option <code>filter</code> (see <a href="#build-configuration">Build Goal Configuration</a> for details).
The registry to push is by default <code>docker.io</code> but can be specified as part of the images&#8217;s <code>name</code> the Docker way.
E.g. <code>docker.test.org:5000/data:1.5</code> will push the image <code>data</code> with tag <code>1.5</code> to the registry <code>docker.test.org</code> at port
<code>5000</code>.
Registry credentials (i.e. username and password) can be specified in multiple ways as described in section <a href="#authentication">Authentication</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jkubeResource">4.1.3. <strong>k8sResource</strong></h4>
<div class="paragraph">
<p>This task generates Kubernetes resources based on your project.
It can either be opinionated defaults or based on the configuration provided in Groovy DSL configuration or resource fragments in <code>src/main/jkube</code>.
Generated resources are in <code>build/classes/java/main/META-INF/jkube/kubernetes</code> directory.
You can find all Groovy DSL configuration options for k8sResource in <a href="#kubernetes-resource-configuration">Kubernetes Resource configuration</a> section.</p>
</div>
<div class="paragraph">
<p>Resource task also validates the generated resource descriptors using API specification of <a href="https://raw.githubusercontent.com/kubernetes/kubernetes/master/api/openapi-spec/swagger.json">Kubernetes</a>.
You can see configuration options regarding Kubernetes resource validation in <a href="#global-configuration">Global Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="jkubeApply">4.1.4. <strong>k8sApply</strong></h4>
<div class="paragraph">
<p>This task applies the resources created with <a href="#jkubeResource"><strong>k8sResource</strong></a> to a connected Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sApply</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jkubeHelm">4.1.5. <strong>k8sHelm</strong></h4>
<div class="paragraph">
<p>This task is for creating
<a href="https://helm.sh/docs/topics/charts">Helm charts</a>
for your Gradle project so that you can install, update or delete your app in Kubernetes
using <a href="https://github.com/helm/helm">Helm</a>.
For creating a Helm chart you simply call <code>k8sHelm</code> task on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sResource k8sHelm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>k8sResource</code> goal is required to create the resource descriptors which are included in the Helm chart.
If you have already built the resource then you can omit this task.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to configure the generated Helm Chart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By providing a <code>Chart.helm.yaml</code> fragment in <code>src/main/jkube</code> directory.</p>
</li>
<li>
<p>Through the <code>helm</code> section in the kubernetes-gradle-plugin Groovy DSL configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the fragment approach, you simply need to create a <code>Chart.helm.yaml</code> file in the <code>src/main/jkube</code> directory with the fields you want to override.
JKube will take care of merging this fragment with the opinionated and configured defaults.</p>
</div>
<div class="paragraph">
<p>The Groovy DSL configuration is defined in a <code>helm</code> section within the plugin&#8217;s configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Helm configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  helm {
    chart = 'Jenkins'
    keywords = ['ci', 'cd', 'server']
    dependencies = [{
      name = 'ingress-nginx'
      version = '1.26.0'
      repository = 'https://kubernetes.github.io/ingress-nginx'
    }]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration section knows the following sub-elements in order to configure your Helm chart.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Helm configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chart</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.chart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart SemVer version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.version</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart single-sentence description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.description</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>home</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart URL for this project&#8217;s home page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.home</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sources</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart list of URLs to source code for this project</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#helm-maintainers">maintainers</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart list of maintainers (name+email)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>icon</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart URL to an SVG or PNG image to be used as an icon , default is extracted from the kubernetes manifest
(<code>kubernetes.yml</code>) <code>jkube.eclipse.org/iconUrl</code> annotation if not provided.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.icon</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>keywords</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of keywords to add to the chart.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>engine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The template engine to use.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>additionalFiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of additional files to be included in the Chart archive. Any file named <code>README</code> or <code>LICENSE</code> will <strong>always</strong>
be included by default.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong> / <strong>types</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform for which to generate the chart. By default this is <code>kubernetes</code>, but can be also <code>openshift</code> for using
OpenShift specific resources in the chart. You can also add both values as a comma separated list.</p>
<p class="tableblock">  <em>Please note that there is no OpenShift support yet for charts, so this is experimental.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sourceDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the resource descriptors generated with <code>k8sResource</code>.
By default this is <code>${basedir}/build/classes/java/main/classes/META-INF/jkube</code>, which is also the output directory used by <code>k8sResource</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.sourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to create the Helm chart, which is <code>${basedir}/build/jkube/helm/${chartName}/kubernetes</code> by default for Kubernetes
and <code>${basedir}/build/jkube/helms/${chartName}/openshift</code> for OpenShift.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.outputDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tarballOutputDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to create the the Helm chart archive, which is same as <code>outputDir</code> if not provided.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.tarballOutputDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tarFileClassifier</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string at the end of Helm archive filename as a classifier.</p>
<p class="tableblock">Defaults to empty string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.tarFileClassifier</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chartExtension</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Helm chart file extension (<code>tgz</code>, <code>tar.bz</code>, <code>tar.bzip2</code>, <code>tar.bz2</code>), default value is <code>tar.gz</code> if not provided.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.chartExtension</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#helm-dependencies">dependencies</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of dependencies for this chart.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#helm-parameters">parameters</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of parameters to interpolate the Chart templates from the provided Fragments.</p>
<p class="tableblock">  These parameters can represent variables, in this case the values are used to generate
  the <code>values.yaml</code> file. The fragment placeholders will be replaced with a <code>.Values</code> variable.</p>
<p class="tableblock">  The parameters can also represent a Golang expression</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table id="helm-maintainers" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Helm Configuration - Maintainer</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maintainer user name or organization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>email</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maintainer&#8217;s contact email address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>url</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maintainer URL address.</p></td>
</tr>
</tbody>
</table>
<table id="helm-dependencies" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Helm Configuration - Dependency</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the chart dependency.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Semantic version or version range for the dependency.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>repository</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL pointing to a chart repository.</p></td>
</tr>
</tbody>
</table>
<table id="helm-parameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Helm Configuration - Parameters</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the interpolatable parameter. Will be used to replace placeholders
(<code>${name}</code>) in the provided YAML fragments. And to generate the <code>values.yaml</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true if this is a required value (when used to generate values).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In case we are generating a <code>.Values</code> variable, the default value.</p>
<p class="tableblock">  In case the placeholder has to be replaced by an expression, the Golang expression
  e.g. `{{ .Chart.Name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In a next step you can install this via the <a href="https://github.com/helm/helm/releases">helm command line tool</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">helm install nameForChartInRepository build/jkube/helm/${chartName}/Kubernetes</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">helm install build/jkube/helm/${chartName}/Kubernetes --generate-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, this task will also create a tar-archive below <code>outputDir</code> which contains the chart with its template.</p>
</div>
</div>
<div class="sect3">
<h4 id="jkubeHelmPush">4.1.6. <strong>k8sHelmPush</strong></h4>
<div class="paragraph">
<p>This goal is for pushing
<a href="https://helm.sh/docs/topics/charts">Helm charts</a>
in a remote repository [Artifactory, Chartmuseum, Nexus].</p>
</div>
<div class="paragraph">
<p>To publish a Helm chart you simply call <code>k8sHelmPush</code> task on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sResource k8sHelm k8sHelmPush</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>k8sResource</code> and the <code>k8sHelm</code> tasks are required to create the resource descriptors which are included in the Helm chart and the Helm chart itself.
If you have already built the resource and create the chart, then you can omit these goals.</p>
</div>
<div class="paragraph">
<p>The configuration is defined in a <code>helm</code> section within the plugin&#8217;s configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Helm configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  helm {
    chart = 'Jenkins'
    keywords = ['ci', 'cd', 'server']
    stableRepository {
      name = 'stable-repo-id'
      url = 'https://stable-repo-url'
      type = 'ARTIFACTORY'
    }
    snapshotRepository {
      name = 'snapshot-repo-id'
      url = 'https://snapshot-repo-url'
      type = 'ARTIFACTORY'
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration section knows the following sub-elements in order to configure your Helm chart.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Helm configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>stableRepository</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration of the stable helm repository (see Helm stable repository configuration).</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>snapshotRepository</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration of the snapshot helm repository (see Helm repository configuration).</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Helm stable repository configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name (id) of the server configuration. It can select the maven server by this ID.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.stableRepository.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>url</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The url of the server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.stableRepository.url</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>username</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username of the repository. Optional. If a maven server ID is specified, the username is taken from there.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.stableRepository.username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the repository. Optional. If a maven server ID is specified, the password is taken from there.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.stableRepository.password</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the repository. One of ARTIFACTORY, NEXUS, CHARTMUSEUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.stableRepository.type</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Helm snapshot repository configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name (id) of the server configuration. It can select the maven server by this ID.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.snapshotRepository.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>url</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The url of the server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.snapshotRepository.url</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>username</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username of the repository. Optional. If a maven server ID is specified, the username is taken from there.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.snapshotRepository.username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the repository. Optional. If a maven server ID is specified, the password is taken from there.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.snapshotRepository.password</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the repository. One of ARTIFACTORY, NEXUS, CHARTMUSEUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.snapshotRepository.type</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="task-overview-develop">4.2. Development Tasks</h3>
<div class="sect3">
<h4 id="jkubeUndeploy">4.2.1. <strong>k8sUndeploy</strong></h4>
<div class="paragraph">
<p>This task is for deleting the kubernetes resources that you deployed via the  <a href="#jkubeApply">k8sApply</a> task.</p>
</div>
<div class="paragraph">
<p>It iterates through all the resources generated by the <a href="#jkubeResource">k8sResource</a> task and deletes them from your current Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sUndeploy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jkubeLog">4.2.2. <strong>k8sLog</strong></h4>
<div class="paragraph">
<p>This task tails the log of the app that you deployed via the <a href="#jkubeApply">k8sApply</a> task</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sLog</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then terminate the output by hitting <code>Ctrl+C</code></p>
</div>
<div class="paragraph">
<p>If you wish to get the log of the app and then terminate immediately then try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sLog -Djkube.log.follow=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lets you pipe the output into grep or some other tool</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sLog -Djkube.log.follow=false | grep Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your app is running in multiple pods you can configure the pod name to log via the <code>jkube.log.pod</code> property, otherwise it defaults to the latest pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sLog -Djkube.log.pod=foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your pod has multiple containers you can configure the container name to log via the <code>jkube.log.container</code> property, otherwise it defaults to the first container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sLog -Djkube.log.container=foo</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jkubeDebug">4.2.3. <strong>k8sDebug</strong></h4>
<div class="paragraph">
<p>This task enables debugging in your Java app and then port forwards from localhost to the latest running pod of your app so that you can easily debug your app from your Java IDE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sDebug</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then follow the on screen instructions.</p>
</div>
<div class="paragraph">
<p>The default debug port is <code>5005</code>.If you wish to change the local port to use for debugging then pass in the <code>jkube.debug.port</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sDebug -Djkube.debug.port=8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your IDE you start a Remote debug execution using this remote port using localhost and you should be able to set breakpoints and step through your code.</p>
</div>
<div class="paragraph">
<p>This lets you debug your apps while they are running inside a Kubernetes cluster - for example if you wish to debug a REST endpoint while another pod is invoking it.</p>
</div>
<div class="paragraph">
<p>Debug is enabled via the <code>JAVA_ENABLE_DEBUG</code> environment variable being set to <code>true</code>.
This environment variable is used for all the standard Java docker images used by Spring Boot, Quarkus,
flat classpath and executable JAR projects.
If you use your own custom docker base image you may wish to also respect this environment variable too
to enable debugging.</p>
</div>
<div class="sect4">
<h5 id="speeding-up-debugging">Speeding up debugging</h5>
<div class="paragraph">
<p>By default the <code>k8sDebug</code> task has to edit your Deployment to enable debugging then wait for a pod to start.It might be in development you frequently want to debug things and want to speed things up a bit.</p>
</div>
<div class="paragraph">
<p>If so you can enable debug mode for each build via the <code>jkube.debug.enabled</code> property.</p>
</div>
<div class="paragraph">
<p>e.g. you can pass this property on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sResource k8sApply -Djkube.debug.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then whenever you type the <code>k8sDebug</code> task there is no need for the gradle task to edit the <code>Deployment</code> and wait for a pod to restart; we can immediately start debugging when you type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sDebug</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="debugging-with-suspension">Debugging with suspension</h5>
<div class="paragraph">
<p>The <code>k8sDebug</code> task allows to attach a remote debugger to a running container, but the application is free to execute when the debugger is not attached.
In some cases, you may want to have complete control on the execution, e.g. to investigate the application behavior at startup. This can be done using the <code>jkube.debug.suspend</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sDebug -Djkube.debug.suspend</code></pre>
</div>
</div>
<div class="paragraph">
<p>The suspend flag will set the <code>JAVA_DEBUG_SUSPEND</code> environment variable to <code>true</code> and <code>JAVA_DEBUG_SESSION</code> to a random number in your deployment.
When the <code>JAVA_DEBUG_SUSPEND</code> environment variable is set, standard docker images will use <code>suspend=y</code> in the JVM startup options for debugging.</p>
</div>
<div class="paragraph">
<p>The <code>JAVA_DEBUG_SESSION</code> environment variable is always set to a random number (each time you run the debug task with the suspend flag) in order to tell Kubernetes to restart the pod.
The remote application will start only after a remote debugger is attached. You can use the remote debugging feature of your IDE to connect (on <code>localhost</code>, port <code>5005</code> by default).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>jkube.debug.suspend</code> flag will disable readiness probes in the Kubernetes deployment in order to start port-forwarding during the early phases of application startup
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jkube:remote-dev">4.2.4. <strong>k8sRemoteDev</strong> (preview)</h4>
<div class="paragraph">
<p>Eclipse JKube Remote Development allows you to run and debug code in your <strong>local</strong> machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While connected to and consuming services that are only available in your cluster</p>
</li>
<li>
<p>While exposing your locally running application to other Pods and services running on your cluster</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Remote Development features</div>
<ul>
<li>
<p>Expose your local application to the cluster</p>
</li>
<li>
<p>Consume cluster services locally without having to expose them to the Internet</p>
</li>
<li>
<p>Connect your local toolset to the cluster services</p>
</li>
<li>
<p>Simple configuration</p>
</li>
<li>
<p><strong>No</strong> tools required</p>
</li>
<li>
<p><strong>No</strong> special or super-user permissions required in the local machine</p>
</li>
<li>
<p><strong>No</strong> special features required in the cluster (should work on any kind of Kubernetes flavor)</p>
</li>
<li>
<p>Boosts your inner-loop developer experience when combined with live-reload frameworks such as Quarkus</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="project-configuration">Project configuration</h5>
<div class="paragraph">
<p>The remote development configuration must be provided within the <code><a href="#remote-dev-remote-development">remoteDevelopment</a></code> configuration element for the project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  remoteDevelopment {
    localServices = [{
      serviceName = "my-local-service" <i class="conum" data-value="1"></i><b>(1)</b>
      port = 8080 <i class="conum" data-value="2"></i><b>(2)</b>
    },{
    }]
    remoteServices = [{
      hostname = "postgresql" <i class="conum" data-value="3"></i><b>(3)</b>
      port = 5432 <i class="conum" data-value="4"></i><b>(4)</b>
    },{
      hostname = "rabbit-mq"
      port = 5672
      localPort = 15672 <i class="conum" data-value="5"></i><b>(5)</b>
    }]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the service to be exposed in the cluster, the local application will be able accessible in the cluster through this hostname/service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Port where the local application is listening for connections</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Name of a cluster service that will be forwarded and exposed locally</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Port where the cluster service listens for connections (by default, the same port will be used to expose the service locally)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional port where the cluster service will be exposed locally</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Starting the remote development session</div>
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ gradle k8sRemoteDev</code></pre>
</div>
</div>
<table id="remote-dev-remote-development" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Options available for the <code>remoteDevelopment</code> configuration element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#remote-dev-local-services">localServices</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of local services to expose in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#remote-dev-remote-services">remoteServices</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of cluster services to expose locally.</p></td>
</tr>
</tbody>
</table>
<table id="remote-dev-local-services" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Options available for the <code>localServices</code> configuration element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>serviceName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the service that will be created/hijacked in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of service to create (defaults to <code>ClusterIP</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service port, must match the port where the local application is listening for connections.</p></td>
</tr>
</tbody>
</table>
<table id="remote-dev-remote-services" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Options available for the <code>remoteServices</code> configuration element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hostname</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the cluster service whose port will be forwarded to the local machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port where the cluster service is listening for connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>localPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(Optional)</em> The port where the cluster service will be exposed locally. If not specified, the same port will be used.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jkube:watch">4.2.5. <strong>k8sWatch</strong></h4>
<div class="paragraph">
<p>This task is used to monitor the project workspace for changes and automatically trigger a redeploy of the application
running on Kubernetes. There are two kinds of watchers present at the moment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker Image Watcher(watches docker images)</p>
</li>
<li>
<p>Spring Boot Watcher(based on Spring Boot Devtools)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before entering the watch mode, this task must generate the docker image and the Kubernetes resources
(optionally including some development libraries/configuration),
and deploy the app on Kubernetes.</p>
</div>
<div class="paragraph">
<p>For any application having <code>k8sResource</code> and <code>k8sBuild</code> tasks bound to the lifecycle, the following
command can be used to run the watch task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gradle k8sWatch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This plugin supports different watcher providers, enabled automatically if the project satisfies certain conditions.</p>
</div>
<div class="paragraph">
<p>Watcher providers can also be configured manually. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    watcher {
        includes = ['docker-image']
        config {
            'spring-boot' {
                 serviceUrlWaitTimeSeconds = 10
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="watcher-spring-boot">Spring Boot</h5>
<div class="paragraph">
<p>This watcher is enabled by default for all Spring Boot projects. It performs the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploys your application with Spring Boot DevTools enabled</p>
</li>
<li>
<p>tails the log of the latest running pod for your application</p>
</li>
<li>
<p>watches the local development build of your Spring Boot based application and then triggers a reload of the application when there are changes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to make sure that <code>devtools</code> is included in the repacked archive, as shown in the following listing (taken from <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/gradle-plugin/reference/html/#packaging-executable-configuring-including-development-only-dependencies">Spring Docs</a>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">bootJar {
    classpath configurations.developmentOnly
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to set a <code>spring.devtools.remote.secret</code> in application.properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.devtools.remote.secret=mysecret</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Spring devtools automatically ignores projects named <code>spring-boot</code>, <code>spring-boot-devtools</code>,
         <code>spring-boot-autoconfigure</code>, <code>spring-boot-actuator</code>, <code>and spring-boot-starter</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can try it on any spring boot application via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sWatch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the task starts up the spring boot RemoteSpringApplication it will watch for local development changes.</p>
</div>
<div class="paragraph">
<p>e.g. if you edit the java code of your app and then build it via something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle build</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see your app reload on the fly in the shell running the <a href="#jkube:watch"><strong>k8sWatch</strong></a> task!</p>
</div>
<div class="paragraph">
<p>There is also support for LiveReload as well.</p>
</div>
</div>
<div class="sect4">
<h5 id="watcher-docker-image">Docker Image</h5>
<div class="paragraph">
<p>This is a generic watcher that can be used in Kubernetes mode only. Once activated, it listens for changes in the project workspace
 in order to trigger a redeploy of the application. This enables rebuilding of images and restarting of containers in case of updates.</p>
</div>
<div class="paragraph">
<p>There are five watch modes, which can be specified in multiple ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build</code>: Automatically rebuild one or more Docker images when one of the files selected by an assembly changes. This works for all files included in assembly.</p>
</li>
<li>
<p><code>run</code>: Automatically restart your application when their associated images change.</p>
</li>
<li>
<p><code>copy</code>:  Copy changed files into the running container. This is the fast way to update a container, however the target container must support hot deploy, too so that it makes sense. Most application servers like Tomcat supports this.</p>
</li>
<li>
<p><code>both</code>: Enables both <code>build</code> and <code>run</code>. <strong>This is the default</strong>.</p>
</li>
<li>
<p><code>none</code>:  Image is completely ignored for watching.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The watcher can be activated e.g. by running this command in another shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The watcher will detect that the binary artifact has changed and will first rebuild the docker image,
then start a redeploy of the Kubernetes pod.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="groovy-configuration">5. Gradle Groovy DSL Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="global-configuration">5.1. Global Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Global configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>authConfig</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication information when pulling from or pushing to Docker registry. There is a dedicated section
  <a href="#authentication">Authentication</a> for how to do security.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>access</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group of configuration parameters to connect to Kubernetes/OpenShift cluster.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>autoPull</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Decide how to pull missing base images or images to start:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>on</code> : Automatic download any missing images (default)</p>
</li>
<li>
<p><code>off</code> : Automatic pulling is switched off</p>
</li>
<li>
<p><code>always</code> : Pull images always even when they already exist locally</p>
</li>
<li>
<p><code>once</code> : For multi-module builds images are only checked once and pulled for the whole build.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.autoPull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildRecreate</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the effective build mode is <code>openshift</code> then this option decides how the OpenShift resource objects
associated with the build should be treated when they already exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>buildConfig</code> or <code>bc</code> : Only the BuildConfig is recreated</p>
</li>
<li>
<p><code>imageStream</code> or <code>is</code> : Only the ImageStream is recreated</p>
</li>
<li>
<p><code>all</code> : Both, BuildConfig and ImageStream are recreated</p>
</li>
<li>
<p><code>none</code> : Neither BuildConfig nor ImageStream is recreated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default is <code>none</code>. If you provide the property without value then <code>all</code> is assumed, so everything gets recreated.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.recreate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildSourceDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default directory that contains the assembly descriptor(s) used by the plugin. The default value is <code>src/main/docker</code>.
This option is only relevant for the <code>k8sBuild</code> task.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.source.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildStrategy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines what build strategy to choose while building container image.
Possible values are <code>docker</code> and <code>jib</code> out of which <code>docker</code> is default.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.strategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>certPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to SSL certificate when SSL is used for communicating with the Docker daemon. These certificates are normally
stored in <code>~/.docker/</code>. With this configuration the path can be set explicitly. If not set, the fallback is first
taken from the environment variable <code>DOCKER_CERT_PATH</code> and then as last resort <code>~/.docker/</code>. The keys in this are
expected with it standard names <code>ca.pem</code>, <code>cert.pem</code> and <code>key.pem</code>.
Please refer to the <a href="https://docs.docker.com/articles/https">Docker documentation</a> for more information about SSL
security with Docker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.certPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>createNewResources</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create new Kubernetes resources.</p>
<p class="tableblock">Defaults to <code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.create</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>debugSuspend</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables readiness probes in Kubernetes Deployment in order to start port forwarding during early phases of application startup.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.debug.suspend</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deletePodsOnReplicationControllerUpdate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete all the pods if we update a Replication Controller.</p>
<p class="tableblock">Defaults to <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.deletePods</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerHost</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The URL of the Docker Daemon. If this configuration option is not given, then the optional <code>&lt;machine&gt;</code> configuration
section is consulted. The scheme of the URL can be either given directly as <code>http</code> or <code>https</code>
depending on whether plain HTTP communication is enabled or SSL should
be used. Alternatively the scheme could be <code>tcp</code> in which case the
protocol is determined via the IANA assigned port: 2375 for <code>http</code>
and 2376 for <code>https</code>. Finally, Unix sockets are supported by using
the scheme <code>unix</code> together with the filesystem path to the unix socket.</p>
</div>
<div class="paragraph">
<p>The discovery sequence used by the docker-maven-plugin to determine
the URL is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Value of <strong>dockerHost</strong> (<code>jkube.docker.host</code>)</p>
</li>
<li>
<p>The Docker host associated with the docker-machine named in <code>&lt;machine&gt;</code>, i.e. the <code>DOCKER_HOST</code> from <code>docker-machine env</code>.</p>
</li>
<li>
<p>The value of the environment variable <code>DOCKER_HOST</code>.</p>
</li>
<li>
<p><code>unix:///var/run/docker.sock</code> if it is a readable socket.</p>
</li>
</ol>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.host</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>filter</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In order to temporarily restrict the operation of plugin tasks this configuration option can be used.
Typically this will be set via the system property <code>jkube.image.filter</code> when Gradle is called. The value can be a single
image name (either its alias or full name) or it can be a comma separated list with multiple image names. Any name
which doesn&#8217;t refer an image in the configuration will be ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.image.filter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failOnNoKubernetesJson</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail if there is no kubernetes json present.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.failOnNoKubernetesJson</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failOnValidationError</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then any validation error will block the plugin execution. A warning will be printed
otherwise.</p>
<p class="tableblock">  Default is <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.failOnValidationError</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignoreServices</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore Service resources while applying resources. This is particularly useful when in recreate mode to let you easily recreate all the ReplicationControllers and Pods but leave any service definitions alone to avoid changing the portalIP addresses and breaking existing pods using the service.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.ignoreServices</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="image-pull-policy"></a> <strong>imagePullPolicy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify whether images should be pull when looking for base images while building or images for starting.
This property can take the following values (case insensitive):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IfNotPresent</code>: Automatic download any missing images (default)</p>
</li>
<li>
<p><code>Never</code> : Automatic pulling is switched off always</p>
</li>
<li>
<p><code>Always</code> : Pull images always even when they already exist locally.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default a progress meter is printed out on the console, which is omitted when using Maven in batch mode (option <code>-B</code>). A very simplified progress meter is provided when using no color output (i.e. with <code>-Djkube.useColor=false</code>).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.imagePullPolicy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>interpolateTemplateParameters</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpolate parameter values from <code>*template.yml</code> fragments in the generated resource list (<code>kubernetes.yml</code>).</p>
<p class="tableblock">  This is useful when using JKube in combination with Helm.</p>
<p class="tableblock">  Placeholders for variables defined in template files can be used in the different resource fragments. Helm generated
  charts will contain these placeholders/parameters.</p>
<p class="tableblock">  For <code>resource</code> task, these placeholders are replaced in the
  aggregated resource list YAML file (not in the individual generated resources) if this option is enabled.</p>
<p class="tableblock">  Defaults to <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.interpolateTemplateParameters</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jsonLogDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The folder we should store any temporary json files or results</p>
<p class="tableblock">Defaults to <code>${project.rootDir}/build/jkube/applyJson</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.jsonLogDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>kubernetesManifest</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The generated kubernetes YAML file.</p>
<p class="tableblock">  Defaults to <code>${basedir}/build/META-INF/jkube/kubernetes.yml</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.kubernetesManifest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>kubernetesTemplate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File or directory containing the Kubernetes YAML files to be included as Chart templates.</p>
<p class="tableblock">Defaults to <code>${basedir}/build/classes/java/main/META-INF/jkube/kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.kubernetesTemplate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>localDebugPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default port available for debugging your application inside Kubernetes.</p>
<p class="tableblock">Defaults to <code>5005</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.debug.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>logFollow</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get follow logs for your application inside Kubernetes.</p>
<p class="tableblock">  Defaults to <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.log.follow</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>logContainerName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get logs of some specific container inside your application Deployment.</p>
<p class="tableblock">  Defaults to <code>null</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.log.container</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>logPodName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get logs of some specific pod inside your application Deployment.</p>
<p class="tableblock">  Defaults to <code>null</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.log.pod</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>machine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker machine configuration.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maxConnections</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of parallel connections are allowed to be opened to the Docker Host. For parsing log output, a connection needs
to be kept open (as well for the wait features), so don&#8217;t put that number to low. Default is 100 which should be
suitable for most of the cases.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.maxConnections</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mergeWithDekorate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When resource generation is delegated to Dekorate, should JKube resources be merged with Dekorate generated ones.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.mergeWithDekorate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default output directory to be used by this plugin.
The default value is <code>build/docker</code> and is only used for the task <code>k8sBuild</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.target.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>offline</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to try detecting Kubernetes Cluster or stay offline.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.offline</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pushRegistry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The registry to use when pushing the image. See <a href="#registry">Registry Handling</a> for
more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.push.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>recreate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update resources by deleting them first and then creating them again.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.recreate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify globally a registry to use for pulling and pushing images. See <a href="#registry">Registry handling</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pushRetries</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often should a push be retried before giving up. This useful for flaky registries which tend to return 500 error codes from time to time.</p>
<p class="tableblock">Defaults to 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.push.retries</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>resourceEnvironment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment name where resources are placed. For example, if you set this property to dev and resourceDir is the
default one, plugin will look at <code>src/main/jkube/dev</code>. Multiple environments can also be provided in form of comma separated strings.  Resource fragments in these directories will be combined while generating resources.</p>
<p class="tableblock">  Defaults to <code>null</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.environment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>resourceSourceDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where to find project specific files.</p>
<p class="tableblock">  Defaults to <code>${project.rootDir}/src/main/jkube</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.resourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>resourceTargetDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The generated Kubernetes manifests target directory.</p>
<p class="tableblock">  Defaults to <code>${basedir}/build/classes/java/main/META-INF/jkube</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.targetDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rollingUpgrades</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Rolling Upgrades to apply changes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.rolling</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>servicesOnly</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only process services so that those can be recursively created/updated first before creating/updating any pods and Replication Controllers.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.deploy.servicesOnly</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this parameter the execution of this plugin can be skipped completely.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipApply</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set no resource maniefst would be applied to connected Kubernetes cluster.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.apply</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipUndeploy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set no applied resources would be deleted from connected Kubernetes cluster.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.undeploy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipBuild</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set not images will be build (which implies also <em>skip.tag</em>) with <code>k8sBuild</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.build</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipResource</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not set resource manifests would be generated with <code>k8sResource</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.resource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t add any tags to images that have been built with <code>k8sBuild</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipMachine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip using docker machine in any case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.skip.machine</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipPush</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true the plugin won’t push any images that have been built.</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.push</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipResourceValidation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then resource validation is skipped. This may be useful if resource validation is failing
for some reason but you still want to continue the deployment.</p>
<p class="tableblock">  Default is <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skipResourceValidation</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true this plugin won’t push any tags</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useProjectClassPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should we use the project&#8217;s compile time classpath to scan for additional enrichers/generators.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.useProjectClassPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>verbose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean attribute for switching on verbose output like the build steps when doing a Docker build. Default is <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.docker.verbose</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchAutoCreateCustomNetworks</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to create the customs networks (user-defined bridge networks) before starting automatically</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.autoCreateCustomNetworks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchMode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>How to watch for image changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>copy</code>: Copy watched artifacts into container</p>
</li>
<li>
<p><code>build</code>: Build only images</p>
</li>
<li>
<p><code>run</code>: Run images</p>
</li>
<li>
<p><code>both</code>: Build and run images</p>
</li>
<li>
<p><code>none</code>: Neither build nor run</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Defaults to <code>both</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.mode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchInterval</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval in milliseconds (how often to check for changes).</p>
<p class="tableblock">  Defaults to <code>5000</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.interval</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchKeepRunning</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true all containers will be kept running after {goal-prefix}:watch has been stopped.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.keepRunning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchPostExec</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command which is executed within the container after files are copied into this container
when watchMode is copy. Note that this container must be running.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.postExec</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchKeepContainer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is set to <code>false</code> (and <code>watchKeepRunning</code> is disabled) then all containers will be removed after
they have been stopped.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.keepContainer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchRemoveVolumes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> remove any volumes associated with the container as well.</p>
<p class="tableblock">  This option will be ignored if either <code>watchKeepContainer</code> or <code>watchKeepRunning</code> is <code>true</code>.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.removeVolumes</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchShowLogs</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, logs will be shown for watched container.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.showLogs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>watchFollow</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>watchShowLogs</code> is set to <code>false</code>, and there is a run image configuration, logs are followed
if set to <code>true</code>.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.watch.follow</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>workDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JKube working directory. Defaults to <code>${project.build.directory}/jkube</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.workDir</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="image-configuration">5.2. Image Configuration</h3>
<div class="paragraph">
<p>The configuration how images should be created are defined in a dedicated <code>images</code> sections. These are specified for each image within the <code>images</code> element of the configuration with one <code>image</code> element per image to use.</p>
</div>
<div class="paragraph">
<p>The <code>image</code> element can contain the following sub elements:</p>
</div>
<table id="config-image" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Image Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#image-name"><strong>name</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each <code>image</code> configuration has a mandatory, unique docker
repository <em>name</em>. This can include registry and tag parts, but also placeholder parameters. See below for a detailed explanation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shortcut name for an image which can be used for
identifying the image within this configuration. This is used when
linking images together or for specifying it with the global <strong>image</strong> configuration element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#registry"><strong>registry</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry to use for this image. If the <code>name</code> already contains a registry this takes precedence. See <a href="#registry">Registry handling</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#config-image-build"><strong>build</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element which contains all the configuration aspects when doing a <a href="#jkubeBuild">k8sBuild</a>. This element can be omitted if the image is only pulled from a registry e.g. as support for integration tests like database images.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>build</code> section is mandatory and is explained in <a href="#build-configuration">below</a>.</p>
</div>
<div id="image-name" class="paragraph">
<p>When specifying the image name in the configuration with the <code>name</code> field you can use several placeholders which are replaced during runtime by this plugin. In addition you can use regular Gradle properties which are resolved by Gradle itself.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Image Names</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%g</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The last part of the Gradle group name, sanitized so that it can be used as username on GitHub. Only the part after the last dot is used. E.g. for a group id <code>org.eclipse.jkube</code> this placeholder would insert <code>jkube</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%a</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sanitized version of the artefact id so that it can be used as part of an Docker image name. I.e. it is converted to all lower case (as required by Docker)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%v</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The project version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%l</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the project version ends with <code>-SNAPSHOT</code> then this placeholder is <code>latest</code>, otherwise its the full version (same as <code>%v</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%t</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the project version ends with <code>-SNAPSHOT</code> this placeholder resolves to <code>snapshot-&lt;timestamp&gt;</code> where timestamp has the date format <code>yyMMdd-HHmmss-SSSS</code> (eg <code>snapshot-</code>). This feature is especially useful during development in oder to avoid conflicts when images are to be updated which are still in use. You need to take care yourself of cleaning up old images afterwards, though.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="build-configuration">5.2.1. Build Configuration</h4>
<div id="build-overview" class="paragraph">
<p>Here are different modes how images can be built:</p>
</div>
<div class="paragraph">
<p>When using this mode, the Dockerfile is created on the fly with all instructions extracted from the configuration given.</p>
</div>
<div id="external-dockerfile" class="paragraph">
<div class="title">External Dockerfile or Docker archive</div>
<p>Alternatively an external Dockerfile template or Docker archive can be used. This mode is switched on by using one of these three configuration options within</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>contextDir</strong> specifies docker build context if an external dockerfile is located outside of Docker build context. If not specified, Dockerfile&#8217;s parent directory is used as build context.</p>
</li>
<li>
<p><strong>dockerFile</strong> specifies a specific Dockerfile path. The Docker build context directory is set to <code>contextDir</code> if given. If not the directory by default is the directory in which the Dockerfile is stored.</p>
</li>
<li>
<p><strong>dockerArchive</strong> specifies a previously saved image archive to load directly. If a <code>dockerArchive</code> is provided, no <code>dockerFile</code> must be given.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All paths can be either absolute or relative paths. A relative path is looked up in <code>$projectDir/src/main/docker</code> by default. You can make it easily an absolute path by using <code>$projectDir</code> in your configuration.</p>
</div>
<div class="paragraph">
<p>However, you need to add the files on your own in the Dockerfile with an <code>ADD</code> or <code>COPY</code> command.
The files of the assembly are stored in a build context relative directory <code>maven/</code> but can be changed by changing the assembly name with the option <code>name</code> in the assembly configuration.</p>
</div>
<div class="paragraph">
<p>E.g. the files can be added with
.Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">COPY maven/ /my/target/directory</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that the assembly files will end up in <code>/my/target/directory</code> within the container.</p>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.jkube-dockerignore</code> (or alternatively, a <code>.jkube-dockerexclude</code> file), then it is used
for excluding files for the build. If the file doesn&#8217;t exist, or it&#8217;s empty, then there are no exclusions.</p>
</div>
<div class="paragraph">
<p>Each line in this file is treated as an entry in the <code>excludes</code> assembly <code>fileSet</code> <a href="#build-assembly-layer">configuration </a>.
Files can be referenced by using their relative path name.
Wildcards are also supported, patterns will be matched using
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/FileSystem.html#getPathMatcher(java.lang.String)">
FileSystem#getPathMatcher</a> <code>glob</code> syntax.</p>
</div>
<div class="paragraph">
<p>It is similar to <code>.dockerignore</code> when using Docker but has a slightly different syntax (hence the different name).</p>
</div>
<div class="paragraph">
<p><a href="#ex-build-dockerexclude">Example <code>.jkube-dockerexclude</code> or <code>.jkube-dockerignore</code></a> is an  example which excludes all compiled Java classes.</p>
</div>
<div id="ex-build-dockerexclude" class="exampleblock">
<div class="title">Example 1. Example <code>.jkube-dockerexclude</code> or <code>.jkube-dockerignore</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build/classes/**  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Exclude all compiled classes</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.jkube-dockerinclude</code> file, then it is used for including only those files for the build.
If the file doesn&#8217;t exist or it&#8217;s empty, then everything is included.</p>
</div>
<div class="paragraph">
<p>Each line in this file is treated as an entry in the <code>includes</code> assembly <code>fileSet</code> <a href="#build-assembly-layer">configuration </a>.
Files can be referenced by using their relative path name.
Wildcards are also supported, patterns will be matched using
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/FileSystem.html#getPathMatcher(java.lang.String)">
FileSystem#getPathMatcher</a> <code>glob</code> syntax.</p>
</div>
<div class="paragraph">
<p><a href="#ex-build-dockerinclude">Example <code>.jkube-dockerinclude</code></a> shows how to include only jar file that have build to the Docker build context.</p>
</div>
<div id="ex-build-dockerinclude" class="exampleblock">
<div class="title">Example 2. Example <code>.jkube-dockerinclude</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build/libs/*.jar <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only add jar file to you Docker build context.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Except for the <a href="#build-assembly">assembly configuration</a> all other configuration options are ignored for now.</p>
</div>
<div id="simple-dockerfile-build" class="paragraph">
<div class="title">Simple Dockerfile build</div>
<p>When only a single image should be built with a Dockerfile no Groovy DSL configuration is needed at all.
All what need to be done is to place a <code>Dockerfile</code> into the top-level module directory, alongside to <code>build.gradle</code>.
You can still configure <a href="#global-configuration">global aspects</a> in the plugin configuration, but as soon as you add an <code>image</code> in the Groovy DSL configuration, you need to configure also the build explicitly.</p>
</div>
<div class="paragraph">
<p>The image name is by default set from the gradle coordinates (<code>%g/%a:%l</code>, see <a href="#image-name">Image Name </a> for an explanation of the params which are essentially the Gradle&#8217;s group, project name and project version)
This name can be set with the property <code>jkube.image.name</code> in <code>gradle.properties</code>.</p>
</div>
<div id="build-filtering" class="paragraph">
<div class="title">Filtering</div>
<p>kubernetes-gradle-plugin filters given Dockerfile with gradle properties, much like the <code>maven-resource-plugin</code> does. Filtering is enabled by default and can be switched off with a build config <code>filter='false'</code>. Properties which we want to replace are specified with the <code>${..}</code> syntax.
Replacement includes properties set in the build, command-line properties, and system properties. Unresolved properties remain untouched.</p>
</div>
<div class="paragraph">
<p>This partial replacement means that you can easily mix it with Docker build arguments and environment variable reference, but you need to be careful.
If you want to be more explicit about the property delimiter to clearly separate Docker properties and gradle properties you can redefine the delimiter.
In general, the <code>filter</code> option can be specified the same way as delimiters in the resource plugin.
In particular,  if this configuration contains a * then the parts left, and right of the asterisks are used as delimiters.</p>
</div>
<div class="paragraph">
<p>For example, the default <code>filter='${*}'</code> parse gradle properties in the format that we know.
If you specify a single character for <code>filter</code> then this delimiter is taken for both, the start and the end.
E.g a <code>filter='@'</code> triggers on parameters in the format <code>@&#8230;&#8203;@</code>.
Use something like this if you want to clearly separate from Docker builds args.
This form of property replacement works for Dockerfile only.
For replacing other data in other files targeted for the Docker image, please use the <a href="#build-assembly">assembly configuration</a> with filtering to make them available in the docker build context.</p>
</div>
<div class="paragraph">
<div class="title">Example</div>
<p>The following example replaces all properties in the format <code>@property@</code> within the Dockerfile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = 'user/demo'
            build {
                filter = '@'
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All build relevant configuration is contained in the <code>build</code> section
of an image configuration. The following configuration options are supported:</p>
</div>
<table id="config-image-build" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Build configuration (<a href="#config-image">image</a>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#config-image-build-assembly"><strong>assembly</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the assembly configuration as described in <a href="#build-assembly">Build Assembly</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-buildargs"><strong>args</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the value of <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build args</a>
which should be used when building the image with an external Dockerfile which uses build arguments. The key-value syntax is the same as when defining gradle properties (or <code>labels</code> or <code>env</code>).
This argument is ignored when no external Dockerfile is used. Build args can also be specified as properties as
described in <a href="#build-buildargs">Build Args</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildOptions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the build options to provide to the docker daemon when building the image. These options map to the ones listed as query parameters in the
<a href="https://docs.docker.com/engine/reference/api/docker_remote_api_v1.24/#build-image-from-a-dockerfile">Docker Remote API</a> and are restricted to simple options
(e.g.: memory, shmsize). If you use the respective configuration options for build options natively supported by the build configuration (i.e. <code>noCache</code>, <code>cleanup=remove</code> for buildoption <code>forcerm=1</code> and <code>args</code> for build args) then these will override any corresponding options given here. The key-value syntax is the same as when defining environment variables or labels as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>createImageOptions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the create image options to provide to the docker daemon when pulling or
  importing an image.
  These options map to the ones listed as query parameters in the
  <a href="https://docs.docker.com/engine/api/v1.41/#operation/ImageCreate">Docker Remote API</a> and are
  restricted to simple options (e.g.: fromImage, fromSrc, platform).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cleanup</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cleanup dangling (untagged) images after each build (including any containers created from them). Default is <code>try</code> which tries to remove the old image, but doesn&#8217;t fail the build if this is not possible because e.g. the image is still used by a running container. Use <code>remove</code> if you want to fail the build and <code>none</code> if no cleanup is requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="context-dir"></a><strong>contextDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a directory used for the build&#8217;s context. You can specify the <code>Dockerfile</code> to use with <strong>dockerFile</strong>, which by default is the Dockerfile found in the <code>contextDir</code>. The Dockerfile can be also located outside of the <code>contextDir</code>, if provided with an absolute file path. See <a href="#external-dockerfile">External Dockerfile</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-startup"><strong>cmd</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command to execute by default (i.e. if no command is provided when a container for this image is started). See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>compression</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The compression mode how the build archive is transmitted to the docker daemon (<code>k8sBuild</code>) and how docker build archives are attached to this build as sources. The value can be <code>none</code> (default), <code>gzip</code> or <code>bzip2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a <code>Dockerfile</code> which also triggers <em>Dockerfile mode</em>. See <a href="#external-dockerfile">External Dockerfile</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerArchive</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a saved image archive which is then imported. See <a href="#external-dockerfile">Docker archive</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-startup"><strong>entryPoint</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entrypoint allows you to configure a container that will run as an executable. See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-env"><strong>env</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The environments as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>filter</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable and set the delimiters for property replacements. By default, properties in the format <code>${..}</code> are replaced with gradle properties. You can switch off property replacement by setting this property to <code>false</code>. When using a single char like <code>@</code> then this is used as a delimiter (e.g <code>@&#8230;&#8203;@</code>). See <a href="#build-filtering">Filtering</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-config-from"></a><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base image which should be used for this image. If not given this default to <code>busybox:latest</code> and is suitable for a pure data image.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-config-from-ext"></a><strong>fromExt</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Extended definition for a base image. This field holds a map of defined in <code>key = "value"</code> format. The known keys are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> : Name of the base image</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A provided <code>from</code> takes precedence over the name given here. This tag is useful for extensions of this plugin.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>imagePullPolicy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific pull policy for the base image. This overwrites any global pull policy.
See the global configuration option <a href="#image-pull-policy">imagePullPolicy</a> for the possible values and the default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-env"><strong>labels</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels  as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maintainer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The author (<code>MAINTAINER</code>) field for the generated image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>noCache</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t use Docker&#8217;s build cache. This can be overwritten by setting a system property <code>docker.noCache</code> when running gradle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cacheFrom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>image</code> elements specifying image names to use as cache sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optimise</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true then it will compress all the <code>runCmds</code> into a single <code>RUN</code> directive so that only one image layer is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The exposed ports which is a list of <code>port</code> elements, one for each port to expose. Whitespace is trimmed from each element and empty elements are ignored. The format can be either pure numerical ("8080") or with the protocol attached ("8080/tcp").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>shell</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell to be used for the <strong>runCmds</strong>. It contains <strong>arg</strong> elements which are defining the executable and its params.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runCmds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commands to be run during the build process. It contains <strong>run</strong> elements which are passed to the shell. Whitespace is trimmed from each element and empty elements are ignored. The run commands are inserted right after the assembly and after <strong>workdir</strong> into the Dockerfile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true disables building of the image. This config option is best used together with a gradle property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t add any tags to images.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tags</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of additional <code>tag</code> elements with which an image is to be tagged after the build. Whitespace is trimmed from each element and empty elements are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User to which the Dockerfile should switch to the end (corresponds to the <code>USER</code> Dockerfile directive).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>volumes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <code>volume</code> elements to create a container volume. Whitespace is trimmed from each element and empty elements are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>workdir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to change to when starting the container.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="build-assembly">5.2.2. Assembly</h4>
<div class="paragraph">
<p>The <code>assembly</code> element within <code>build</code> element defines how build artifacts and other files
can be added to the Docker image. The files which are supposed to be added via <code>assembly</code> should be
present in project directory. It&#8217;s also possible to add file from external source using your own custom
logic (see <a href="#jkube-plugin">JKube Plugin</a> for more details).</p>
</div>
<table id="config-image-build-assembly" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Assembly Configuration (<a href="#config-image">image </a> : <a href="#config-image-build">build </a>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly name, which is <code>maven</code> by default. This name is used for the archives and directories created during the build.
  This directory holds the files specified by the assembly. If an <a href="#external-dockerfile">external Dockerfile</a> is used then
  this name is also the relative directory which contains the assembly files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory under which the files and artifacts contained in the assembly will be copied within the container.
  The default value for this is <code>${assembly.name}</code>, so <code>/maven</code> if <strong>name</strong> is not set to a different value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-assembly-layer"><strong>inline</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use layers instead</em>
  Inlined assembly descriptor as described in <a href="#build-assembly-layer">Assembly - Inline</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-assembly-layer"><strong>layers</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each of the layers that the assembly will contain as described in
  <a href="#build-assembly-layer">Assembly - Layer</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exportTargetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification whether the <code>targetDir</code> should be exported as a volume. This value is <code>true</code> by default except in the
  case the <code>targetDir</code> is set to the container root (<code>/</code>). It is also <code>false</code> by default when a base image is used with
  <code>from</code> since exporting makes no sense in this case and will waste disk space unnecessarily.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>excludeFinalOutputArtifact</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the project&#8217;s final artifact will be included in the assembly, set this flag to true in case the
  artifact should be excluded from the assembly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode how the assembled files should be collected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dir</code> : Files are simply copied (default),</p>
</li>
<li>
<p><code>tar</code> : Transfer via tar archive</p>
</li>
<li>
<p><code>tgz</code> : Transfer via compressed tar archive</p>
</li>
<li>
<p><code>zip</code> : Transfer via ZIP archive</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archive formats have the advantage that file permission can be preserved better (since the copying is independent from the underlying files systems)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>permissions</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Permission of the files to add:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ignore</code> to use the permission as found on files regardless on any
assembly configuration</p>
</li>
<li>
<p><code>keep</code> to respect the assembly provided permissions</p>
</li>
<li>
<p><code>exec</code> for setting the executable bit on all files (required for Windows when using an assembly mode <code>dir</code>)</p>
</li>
<li>
<p><code>auto</code> to let the plugin select <code>exec</code> on Windows and <code>keep</code> on others.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>keep</code> is the default value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tarLongFileMode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the TarArchiver behaviour on file paths with more than 100 characters length. Valid values are: "warn"(default), "fail", "truncate", "gnu", "posix", "posix_warn" or "omit"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User and/or group under which the files should be added. The user must already exist in the base image.</p>
</div>
<div class="paragraph">
<p>It has the general format <code>user[:group[:run-user]]</code>. The user and group can be given either as numeric user- and group-id or as names. The group id is optional.</p>
</div>
<div class="paragraph">
<p>If a third part is given, then the build changes to user <code>root</code> before changing the ownerships, changes the ownerships and then change to user <code>run-user</code> which is then used for the final command to execute. This feature might be needed, if the base image already changed the user (e.g. to 'jboss') so that a <code>chown</code> from root to this user would fail.</p>
</div>
<div class="paragraph">
<p>For example, the image <code>jboss/wildfly</code> use a "jboss" user under which all commands are executed. Adding files in Docker always happens under the UID root. These files can only be changed to "jboss" is the <code>chown</code> command is executed as root. For the following commands to be run again as "jboss" (like the final <code>standalone.sh</code>), the plugin switches back to user <code>jboss</code> (this is this "run-user") after changing the file ownership. For this example a specification of
<code>jboss:jboss:jboss</code> would be required.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the event you do not need to include any artifacts with the image, you may safely omit this element from the configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-assembly-layer">5.2.3. Assembly - Inline/Layer</h4>
<div class="paragraph">
<p>Inlined assembly description with a format very similar to
<a href="https://maven.apache.org/plugins/maven-assembly-plugin/assembly.html">Maven Assembly Plugin</a>.</p>
</div>
<div class="listingblock">
<div class="title">Partial configuration example of an inline/layer element</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">assembly {
    targetDir = "/deployments"
    layers = [{
        fileSets = [{
            directory = file("${project.rootDir}/build/dependencies")
            outputDirectory = "static"
       }]
    }]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>layers</code> element within the <code>assembly</code> element can have one or more
<code>layer</code> elements with a Groovy DSL structure that supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Assembly - Inline/Layer (<a href="#config-image">image </a> : <a href="#config-image-build">build </a> : <a href="#config-image-build-assembly">assembly </a>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID for the layer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>files</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List of files for the layer.</p>
</div>
<div class="paragraph">
<p>Each file has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>source</code>: Absolute or relative path from the project&#8217;s directory of the file to be included in the assembly.</p>
</li>
<li>
<p><code>outputDirectory</code>: Output directory relative to the root of the root directory of the assembly.</p>
</li>
<li>
<p><code>destName</code>: Destination filename in the outputDirectory.</p>
</li>
<li>
<p><code>fileMode</code>: Similar to a UNIX permission, sets the file mode of the file included.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>fileSets</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List of filesets for the layer.</p>
</div>
<div class="paragraph">
<p>Each fileset has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>directory</code>: Absolute or relative location from the project&#8217;s directory.</p>
</li>
<li>
<p><code>outputDirectory</code>: Output directory relative to the root of the root directory of the assembly fileSet.</p>
</li>
<li>
<p><code>includes</code>:  A set of files and directories to include.</p>
<div class="ulist">
<ul>
<li>
<p>If none is present, then everything is included.</p>
</li>
<li>
<p>Files can be referenced by using their complete path name.</p>
</li>
<li>
<p>Wildcards are also supported, patterns will be matched using
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/FileSystem.html#getPathMatcher(java.lang.String)">
FileSystem#getPathMatcher</a> <code>glob</code> syntax.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>excludes</code>: A set of files and directory to exclude.</p>
<div class="ulist">
<ul>
<li>
<p>If none is present, then there are no exclusions.</p>
</li>
<li>
<p>Wildcards are also supported, patterns will be matched using
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/FileSystem.html#getPathMatcher(java.lang.String)">
FileSystem#getPathMatcher</a> <code>glob</code> syntax.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>fileMode</code>: Similar to a UNIX permission, sets the file mode of the files included.</p>
</li>
<li>
<p><code>directoryMode</code>: Similar to a UNIX permission, sets the directory mode of the directories included.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>baseDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base directory from which to resolve the Assembly&#8217;s layer files and filesets.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="build-buildargs">5.2.4. Build Args</h4>
<div id="property-buildargs" class="paragraph">
<p>As described in section <a href="#build-configuration">Configuration</a> for external Dockerfiles <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build arg</a> can be used. In addition to the
configuration within the plugin configuration you can also use properties to specify them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set a system property when running gradle, e.g: <code>docker.buildArg.http_proxy=http://proxy:8001</code>. This is especially useful when using predefined Docker arguments for setting proxies transparently.</p>
</li>
<li>
<p>Set a project property within the <code>build.gradle</code>, e.g:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">docker.buildArg.myBuildArg = myValue</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the system property setting will always override the project property. Also note that for all
properties which are not Docker <a href="https://docs.docker.com/engine/reference/builder/#arg">predefined</a> properties, the
external Dockerfile must contain an <code>ARGS</code> instruction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="misc-env">5.3. Environment and Labels</h3>
<div class="paragraph">
<p>When creating a container one or more environment variables can be set via configuration with the <code>env</code> parameter</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">env {
    JAVA_HOME = "/opt/jdk8"
    CATALINA_OPTS = "-Djava.security.egd=file:/dev/./urandom"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you put this configuration into profiles you can easily create various test variants with a single image (e.g. by switching the JDK or whatever).</p>
</div>
<div class="paragraph">
<p>It is also possible to set the environment variables from the outside of the plugin&#8217;s configuration with the parameter <code>envPropertyFile</code>. If given, this property file is used to set the environment variables where the keys and values specify the environment variable. Environment variables specified in this file override any environment variables specified in the configuration.</p>
</div>
<div class="paragraph">
<p>Labels can be set inline the same way as environment variables:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">labels {
     labelWithValue = "foo"
     version = "${project.version}"
     artifactId = "${project.name}"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="misc-startup">5.4. Startup Arguments</h3>
<div class="paragraph">
<p>Using <code>entryPoint</code> and <code>cmd</code> it is possible to specify the <a href="https://docs.docker.com/reference/builder/#entrypoint">entry point</a>
or <a href="https://docs.docker.com/reference/builder/#cmd">cmd</a> for a container.</p>
</div>
<div class="paragraph">
<p>The difference is, that an <code>entrypoint</code> is the command that always be executed, with the <code>cmd</code> as argument. If no <code>entryPoint</code> is provided, it defaults to <code>/bin/sh -c</code> so any <code>cmd</code> given is executed with a shell. The arguments given to <code>docker run</code> are always given as arguments to the
<code>entrypoint</code>, overriding any given <code>cmd</code> option. On the other hand if no extra arguments are given to <code>docker run</code> the default <code>cmd</code> is used as argument to <code>entrypoint</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>See this <a href="http://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile">stackoverflow question</a> for a detailed explanation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>An entry point or command can be specified in two alternative formats:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Entrypoint and Command Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>shell</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell form in which the whole line is given to <code>shell -c</code> for interpretation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exec</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of arguments (with inner <code>&lt;args&gt;</code>) arguments which will be given to the <code>exec</code> call directly without any shell interpretation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Either shell or params should be specified.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">entryPoint {
    // Shell Form
    shell = 'java -jar maven/hello-world-1.14-SNAPSHOT.jar'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">entryPoint {
    // exec form
    exec = ['java','-jar','maven/hello-world-1.14-SNAPSHOT.jar']
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">INFO</dt>
<dd>
<p>Startup arguments are not used in S2I builds</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes-resource-configuration">5.5. Kubernetes Resource Configuration</h3>
<div class="paragraph">
<p>This section includes Groovy DSL configuration options you can use to tweak generated Kubernetes manifests.</p>
</div>
<div class="sect3">
<h4 id="labels-annotation-configuration">5.5.1. Labels/Annotations</h4>
<div class="paragraph">
<p>Labels and annotations can be easily added to any resource object. This is best explained by an example.</p>
</div>
<div class="listingblock">
<div class="title">Example for label and annotations</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    resources {
        labels {   <i class="conum" data-value="1"></i><b>(1)</b>
            all {  <i class="conum" data-value="2"></i><b>(2)</b>
                organisation = 'unesco' <i class="conum" data-value="3"></i><b>(3)</b>
            }
            service { <i class="conum" data-value="4"></i><b>(4)</b>
                database = 'mysql',
                persistent = 'true'
            }
            replicaSet { <i class="conum" data-value="5"></i><b>(5)</b>
            }
            pod { <i class="conum" data-value="6"></i><b>(6)</b>
            }
            deployment { <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }
        annotations { <i class="conum" data-value="8"></i><b>(8)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>labels</code> section with <code>resources</code> contains labels which should be applied to objects of various kinds</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within <code>all</code> labels which should be applied to <strong>every</strong> object can be specified</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Within <code>property</code> you can specify key value pairs</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>service</code> labels are used to label services</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>replicaSet</code> labels are for replica set and replication controller</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>pod</code> holds labels for pod specifications in replication controller, replica sets and deployments</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>deployment</code> is for labels on deployments (kubernetes) and deployment configs (openshift)</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The subelements are also available for specifying annotations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Labels and annotations can be specified in free form as a map. In this map, the element name is the name of the label or annotation respectively, whereas the content is the value to set.</p>
</div>
<div class="paragraph">
<p>The following subelements are possible for <code>labels</code> and <code>annotations</code> :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Label and annotation configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All entries specified in the <code>all</code> sections are applied to all resource objects created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deployment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Deployment</code> (for Kubernetes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pod</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied pod specification as used in <code>ReplicationController</code>,  <code>ReplicaSets</code>, <code>Deployments</code> and <code>DeploymentConfigs</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>replicaSet</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>ReplicaSet</code> and <code>ReplicationController</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Service</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ingress</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Ingress</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>serviceAccount</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>ServiceAccount</code> objects.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="resource-controller-generation">5.5.2. Controller Generation</h4>
<div class="paragraph">
<p>In JKube terminology, a Controller resource is a Kubernetes resource which manages Pods created for your application. These can be one of the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/">ReplicationController</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSet</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Job</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">CronJob</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Deployment is generated in Kubernetes mode. You can easily configure different aspects of generated Controller resource using Groovy DSL configuration. Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Example of Controller Resource Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    resources {
        controller {
            env { <i class="conum" data-value="1"></i><b>(1)</b>
                organization = 'Eclipse Foundation'
                projectname = 'jkube'
            }
            controllerName = 'my-deploymentname' <i class="conum" data-value="2"></i><b>(2)</b>
            containerPrivileged = 'true' <i class="conum" data-value="3"></i><b>(3)</b>
            imagePullPolicy = 'Always' <i class="conum" data-value="4"></i><b>(4)</b>
            replicas = '3' <i class="conum" data-value="5"></i><b>(5)</b>
            liveness { <i class="conum" data-value="6"></i><b>(6)</b>
                getUrl = 'http://:8080/q/health'
                tcpPort = '8080'
                initialDelaySeconds = '3'
                timeoutSeconds = '3'
            }
            startup { <i class="conum" data-value="7"></i><b>(7)</b>
              periodSeconds = 30
              failureThreshold = 1
              getUrl = "http://:8080/actuator/health"
            }
            volumes = [{ <i class="conum" data-value="8"></i><b>(8)</b>
                name = 'scratch'
                type = 'emptyDir'
                medium = 'Memory'
                mounts = ['/var/scratch']
            }]
            containerResources {
                requests { <i class="conum" data-value="9"></i><b>(9)</b>
                    cpu = '250m'
                    memory = '32Mi'
                }
                limits { <i class="conum" data-value="10"></i><b>(10)</b>
                    cpu = '500m'
                    memory = '64Mi'
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Environment variables added to all of your application Pods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Name of Controller(<code>metadata.name</code> set in generated Deployment, Job, ReplicaSet etc)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod">Security Context</a> of all application Pods.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure how images would be updated. Can be one of <code>IfNotPresent</code>, <code>Always</code> or <code>Never</code>. Read <a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images">Kubernetes Images docs</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Number of replicas of pods we want to have in our application</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Define an HTTP liveness request, see <a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images">Kubernetes Liveness/Readiness probes</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define an HTTP startup request, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Kubernetes Startup probes</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Mounting an EmptyDir Volume to your application pods</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Requests describe the minimum amount of compute resources required. See <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes Resource Management Documentation</a> for more info.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Limits describe the maximum amount of compute resources allowed. See <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes Resource Management Documentation</a> for more info.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are the fields available in <code>resources</code> Groovy DSL configuration that would work with k8sResource:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. resources fields for configuring generated controllers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generated-controller-resource-configuration"><code>controller</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for changing various aspects of generated Controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServiceAccount name which will be used by pods created by controller resources(e.g. <code>Deployment</code>, <code>ReplicaSet</code> etc)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useLegacyJKubePrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use old <code>jkube.io/</code> annotation prefix instead of <code>jkube.eclipse.org/</code> annotation prefix</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="generated-controller-resource-configuration">Configuring generated Controller via Groovy DSL</h5>
<div class="paragraph">
<p>This configuration field is focused only on changing various elements of Controller (mainly fields specified in PodTemplateSpec). Here are available configuration fields within this object:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. controller fields for configuring generated controllers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables which will be added to containers in Pod template spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#volume-resource-configuration"><code>volumes</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding volume mounts to containers in Pod template spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controllerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the controller resource(i.e. <code>Deployment</code>, <code>ReplicaSet</code>, <code>StatefulSet</code> etc) generated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#probe-resources-configuration"><code>liveness</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding a liveness probe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#probe-resources-configuration"><code>readiness</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding readiness probe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#probe-resources-configuration"><code>startup</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding startup probe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>containerPrivileged</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run container in privileged mode. Sets <code>privileged: true</code> in generated Controller&#8217;s PodTemplateSpec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imagePullPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How images should be pulled (maps to ImagePullPolicy).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#initcontainer-configuration"><code>initContainers</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding <a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">InitContainers</a> to generated Controller resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replicas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of replicas to create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>restartPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pod&#8217;s restart policy.</p>
<p class="tableblock">For <code>Job</code>, this defaults to <code>OnFailure</code>. For others, it&#8217;s not provided (Kubernetes assumes it to be <code>Always</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#container-resources-configuration"><code>containerResources</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Controller&#8217;s compute resource requirements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schedule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schedule for <em>CronJob</em> written in <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> syntax.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="initcontainer-configuration">InitContainer Groovy DSL configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. initContainer fields for specifying initContainers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of InitContainer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image used for InitContainer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imagePullPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How images should be pulled (maps to ImagePullPolicy).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to be executed in InitContainer (maps to <code>.command</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>volumes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for adding volume mounts to InitContainers in Pod template spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variables that will be added to this InitContainer in Pod template spec.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="container-resources-configuration">Container Resource Groovy DSL configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. containerResources fields for specifying compute resource requirements</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requests</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum amount of compute resources required. See <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes Resource Management Documentation</a> for more info.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>limits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of compute resources allowed. See <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes Resource Management Documentation</a> for more info.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="probe-resources-configuration">5.5.3. Probe Configuration</h4>
<div class="paragraph">
<p>Probe configuration is used for configuring <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">liveness and readiness probes</a> for containers. Both <code>liveness</code> and <code>readiness</code> probes the following options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Groovy DSL Probe configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initialDelaySeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial delay in seconds before the probe is started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeoutSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in seconds how long the probe might take.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to execute for probing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe URL for HTTP Probe. Configures HTTP probe fields like <code>host</code>, <code>scheme</code>, <code>path</code> etc by parsing URL. For example, a <code>getUrl = "http://:8080/health"</code> would result in probe generated with fields set like this:</p>
<p class="tableblock">  host: ""</p>
<p class="tableblock">  path: /health</p>
<p class="tableblock">  port: 8080</p>
<p class="tableblock">  scheme: HTTP</p>
<p class="tableblock">Host name with empty value defaults to Pod IP. You probably want to set "Host" in httpHeaders instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcpPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP port to probe.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failureThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When a probe fails, Kubernetes will try failureThreshold times before giving up</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>successThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive successes for the probe to be considered successful after having failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httpHeaders</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom headers to set in the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>periodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often in seconds to perform the probe. Defaults to 10 seconds. Minimum value is 1.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="volume-resource-configuration">5.5.4. Volume Configuration</h4>
<div class="paragraph">
<p><code>volumes</code> field contains a list of <code>volume</code> configurations. Different configurations are supported in order to support different <a href="https://kubernetes.io/docs/concepts/storage/volumes/">Volumes in Kubernetes</a>.</p>
</div>
<div class="paragraph">
<p>Here are the options supported by a single <code>volume</code> :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Groovy DSL <code>volume</code> configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type of Volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of volume to be mounted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of mount paths of this volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path for volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>medium</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium ,applicable for Volume type <code>emptyDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository ,applicable for Volume type <code>gitRepo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>revision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">revision ,applicable for Volume type <code>gitRepo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret name ,applicable for Volume type <code>secret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server name, applicable for Volume type <code>nfsPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>readOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether it&#8217;s read only or not</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pdName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdName, applicable for Volume type <code>gcePdName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fsType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File system type for Volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">partition, applicable for Volume type <code>gcePdName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoints</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">endpoints, applicable for Volume type <code>glusterFsPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>claimRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Claim Reference, applicable for Volume type <code>persistentVolumeClaim</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>volumeId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">volume id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disk name, applicable for Volume type <code>azureDisk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskUri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disk uri, applicable for Volume type <code>azureDisk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kind, applicable for Volume type <code>azureDisk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cachingMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">caching mode, applicable for Volume type <code>azureDisk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hostPathType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host Path type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shareName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Share name,  applicable for Volume type <code>azureFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret File, applicable for Volume type <code>cephfs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret reference, applicable for Volume type <code>cephfs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LUN(Logical Unit Number)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>targetWwns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target WWNs, applicable for Volume type <code>fc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datasetName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data set name, applicable for Volume type <code>flocker</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>portals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list of portals, applicable for Volume type <code>iscsi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>targetPortal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target portal, applicable for Volume type <code>iscsi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registry, applicable for Volume type <code>quobyte</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>volume</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">volume, applicable for Volume type <code>quobyte</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group, applicable for Volume type <code>quobyte</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iqn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IQN, applicable for Volume type <code>iscsi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list of monitors, applicable for Volume type <code>rbd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pool, applicable for Volume type <code>rbd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyring</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyring, applicable for Volume type <code>rbd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">image, applicable for Volume type <code>rbd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gateway</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gateway, applicable for Volume type <code>scaleIO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system, applicable for Volume type <code>scaleIO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protectionDomain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">protection domain, applicable for Volume type <code>scaleIO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storagePool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage pool, applicable for Volume type <code>scaleIO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>volumeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">volume name, applicable for Volume type <code>scaleIO</code> and <code>storageOS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configMapName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConfigMap name, applicable for Volume type <code>configMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configMapItems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of ConfigMap items, applicable for Volume type <code>configMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>items</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of items, applicable for Volume type <code>downwardAPI</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="resource-secrets">5.5.5. Secrets</h4>
<div class="paragraph">
<p><strong>Groovy DSL configuration</strong></p>
</div>
<div class="paragraph">
<p>You can create a secret using Groovy DSL configuration in the <code>build.gradle</code> file. It should contain the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">required</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this will be used as name of the kubernetes secret resource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the secret resource will be applied to the specific
namespace, if provided</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This is best explained by an example.</p>
</div>
<div class="paragraph">
<p><strong>Yaml fragment with annotation</strong></p>
</div>
<div class="paragraph">
<p>You can create a secret using a yaml fragment. You can reference the docker server id with an annotation
<code>jkube.eclipse.org/dockerServerId</code>. The yaml fragment file should be put under
the <code>src/main/jkube/</code> folder.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: mydockerkey
  namespace: default
  annotations:
    jkube.eclipse.org/dockerServerId: ${docker.registry}
type: kubernetes.io/dockercfg</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ingress-generation">5.5.6. Ingress Generation</h4>
<div class="paragraph">
<p>When the <code>k8sResource</code> goal is run, an <code>Ingress</code> will be generated for each <code>Service</code> if the <code>jkube.createExternalUrls</code> property is enabled.</p>
</div>
<div class="paragraph">
<p>The generated <code>Ingress</code> can be further customized by using an Groovy DSL configuration, or by providing a YAML resource fragment.</p>
</div>
<div class="paragraph">
<p><strong>Groovy DSL Configuration</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Fields supported in <code>resources</code></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ingress-resource-top-level-configuration"><code>ingress</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for creating new Ingress</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routeDomain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set host for Ingress or OpenShift Route</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of configuring Ingress using Groovy DSL configuration:</p>
</div>
<div class="listingblock">
<div class="title">Enable Ingress Generation by enabling createExternalUrl property</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">jkube.createExternalUrls=true</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example for Ingress Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  resources {
    ingress {
      ingressTlsConfigs = [{ <i class="conum" data-value="1"></i><b>(1)</b>
        hosts = ["foo.bar.com"]
        secretName = "testsecret-tls"
      }]
      ingressRules = [{
        host = "foo.bar.com" <i class="conum" data-value="2"></i><b>(2)</b>
        paths = [{
          pathType = "Prefix" <i class="conum" data-value="3"></i><b>(3)</b>
          path = "/foo" <i class="conum" data-value="4"></i><b>(4)</b>
          serviceName = "service1" <i class="conum" data-value="5"></i><b>(5)</b>
          servicePort = "8080" <i class="conum" data-value="6"></i><b>(6)</b>
        }]
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#tls">Ingress TLS</a> Configuration to specify Secret that contains TLS private key and certificate</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Host names, can be precise matches or a wildcard. See <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#hostname-wildcards">Kubernetes Ingress Hostname</a> documentation for more details</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#path-types">Ingress Path Type</a>, Can be one of <code>ImplementationSpecific</code>, <code>Exact</code> or <code>Prefix</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Ingress path corresponding to provided <code>service.name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Service Name corresponding to path</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Service Port corresponding to path</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="ingress-resource-top-level-configuration">Ingress Groovy DSL Configuration</h5>
<div class="paragraph">
<p>Here are the supported options while providing <code>ingress</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. <code>ingress</code> configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ingress-rule-resource-configuration"><code>ingressRules</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IngressRule configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ingress-tls-configuration"><code>ingressTlsConfigs</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingress TLS configuration</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ingress-rule-resource-configuration">IngressRule Groovy DSL Configuration</h5>
<div class="paragraph">
<p>Here are the supported options while providing <code>ingressRules</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. <code>ingressRule</code> configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ingress-rule-path-configuration"><code>paths</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IngressRule path configuration</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ingress-rule-path-configuration">IngressRule Path Groovy DSL Configuration</h5>
<div class="paragraph">
<p>Here are the supported options while providing <code>paths</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. IngressRule <code>path</code> Groovy DSL configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pathType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type of Path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>servicePort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ingress-rule-path-resource-resource-configuration"><code>resource</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource reference in Ingress backend</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ingress-rule-path-resource-resource-configuration">IngressRule Path Resource Groovy DSL Configuration</h5>
<div class="paragraph">
<p>Here are the supported options while providing <code>resource</code> in IngressRule&#8217;s path Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. IngressRule Path <code>resource</code> Groovy DSL configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource kind</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource&#8217;s apiGroup</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ingress-tls-configuration">IngressRule Path Resource Groovy DSL Configuration</h5>
<div class="paragraph">
<p>Here are the supported options while providing <code>ingressTlsConfigs</code> in IngressRule&#8217;s path Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. IngressTls <code>ingressTlsConfig</code> Groovy DSL configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hosts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a list of string <code>host</code> objects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Ingress Yaml fragment</strong>:</p>
</div>
<div class="paragraph">
<p>You can create <code>Ingress</code> using YAML fragments too by placing the partial YAML file in the <code>src/main/jkube</code> directory. The following snippet contains an <code>Ingress</code> fragment example.</p>
</div>
<div class="listingblock">
<div class="title">Ingress fragment Example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: tls-example-ingress
spec:
  tls:
  - hosts:
    - https-example.foo.com
    secretName: testsecret-tls
  rules:
  - host: https-example.foo.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: service1
            port:
              number: 80</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serviceaccount-generation">5.5.7. ServiceAccount Generation</h4>
<div class="paragraph">
<p>You can configure <code>resource</code> configuration to generate a ServiceAccount or configure an already existing ServiceAccount into your generated Deployment.</p>
</div>
<div class="paragraph">
<p>Here is an example of Groovy DSL configuration to generate a ServiceAccount:</p>
</div>
<div class="listingblock">
<div class="title">Example for Creating ServiceAccount via Groovy DSL</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    resources {
        serviceAccounts = [{
            name = 'my-serviceaccount' <i class="conum" data-value="1"></i><b>(1)</b>
            deploymentRef = 'my-deployment-name' <i class="conum" data-value="2"></i><b>(2)</b>
        }]
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of ServiceAccount to be created</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Deployment which will be using this ServiceAccount</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to generate ServiceAccount but just use an existing ServiceAccount in your Deployment. You can configure it via <code>serviceAccount</code> field in resource configuration. Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Example for Configuring already existing ServiceAccount into generated Deployment</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    resources {
        serviceAccount = 'my-existing-serviceaccount'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Service Account Resource fragment</strong>:</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use Groovy DSL configuration, you can provide a resource fragment for ServiceAccount resource. Here is how it would look like:</p>
</div>
<div class="listingblock">
<div class="title">ServiceAccount resource fragment</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: build-robot</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resource-validation">5.5.8. Resource Validation</h4>
<div class="paragraph">
<p>Resource goal also validates the generated resource descriptors using API specification of <a href="https://raw.githubusercontent.com/kubernetes/kubernetes/master/api/openapi-spec/swagger.json">Kubernetes</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Validation Configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipResourceValidation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then resource validation is skipped. This may be useful if resource validation is failing
for some reason but you still want to continue the deployment.</p>
<p class="tableblock">  Default is <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skipResourceValidation</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failOnValidationError</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then any validation error will block the plugin execution. A warning will be printed
otherwise.</p>
<p class="tableblock">  Default is <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.failOnValidationError</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generators">6. Generators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usual way to define Docker images is with the plugin configuration as explained in <a href="#jkubeBuild"><strong>k8sBuild</strong></a>. This can either be done completely within the <code>build.gradle</code> or by referring to an external Dockerfile.</p>
</div>
<div class="paragraph">
<p>However, this plugin provides an additional route for defining image configurations. This is done by so called <em>Generators</em>. A generator is a Java component providing an auto-detection mechanism for certain build types like a Spring Boot build or a plain Java build. As soon as a <em>Generator</em> detects that it is applicable it will be called with the list of images configured in the <code>build.gradle</code>. Typically a generator only creates dynamically a new image configuration if this list is empty. But a generator is free to also add new images to an existing list or even change the current image list.</p>
</div>
<div class="paragraph">
<p>The included <em>Generators</em> are enabled by default, but you can easily disable them or only select a certain set of generators. Each generator has a <em>name</em>, which is unique for a generator.</p>
</div>
<div class="paragraph">
<p>The generator configuration is embedded in a <code>generator</code> configuration section:</p>
</div>
<div id="generator-example" class="listingblock">
<div class="title">Example for a generator configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  generator { <i class="conum" data-value="1"></i><b>(1)</b>
    includes = ['spring-boot'] <i class="conum" data-value="2"></i><b>(2)</b>
    config { <i class="conum" data-value="3"></i><b>(3)</b>
      'spring-boot' { <i class="conum" data-value="4"></i><b>(4)</b>
          alias = 'ping'
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start of generators' configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generators can be included and excluded. Includes have precedence, and the generators are called in the given order.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuration for individual generators.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The config is a map of supported config values. Each section is embedded in a tag named after the generator.
The following sub-elements are supported:</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Generator configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one or more <code>include</code> elements with generator names which should be included. If given only this list of generators are included in this given order. The order is important because by default only the first matching generator kicks in. The generators from every active profile are included, too. However the generators listed here are moved to the front of the list, so that they are called first. Use the profile <code>raw</code> if you want to explicitly set the complete list of generators.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>exclude</code> elements with generator names to exclude. If set then all detected generators are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all generators. Each generator support a specific set of configuration values as described in the documentation. The subelements of this section are generator names to configure. E.g. for generator <code>spring-boot</code>, the sub-element is called <code>spring-boot</code>. This element then holds the specific generator configuration like <code>name</code> for specifying the final image name. See above for an example. Configuration coming from profiles are merged into this config, but not overriding the configuration specified here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Beside specifying generator configuration in the plugin&#8217;s configuration it can be set directly with properties, too:</p>
</div>
<div class="listingblock">
<div class="title">Example generator property config</div>
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle k8sBuild -Pjkube.generator.java-exec.webPort=8082</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general scheme is a prefix <code>jkube.generator.</code> followed by the unique generator name and then the generator specific key.</p>
</div>
<div class="paragraph">
<p>In addition to the provided default <em>Generators</em> described in the next section <a href="#generators-default">Default Generators</a>, custom generators can be easily added. There are two ways to include generators:</p>
</div>
<div class="paragraph">
<div class="title">Plugin dependency</div>
<p>You can declare the generator holding jars as dependency to this plugin as shown in this example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">buildscript {
    repositories {
        mavenLocal()
    }
    dependencies {
        classpath('io.acme:mygenerator:1.0')
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Compile time dependency</div>
<p>Alternatively and if your application code comes with a custom generator you can set the global configuration option <code>useProjectClasspath</code> (property: <code>jkube.useProjectClasspath</code>) to true. In this case also the project artifact and its dependencies are looked up for <em>Generators</em>. See <a href="#generators-api">Generator API</a> for details how to write your own generators.</p>
</div>
<div class="sect2">
<h3 id="generators-default">6.1. Default Generators</h3>
<div class="paragraph">
<p>All default generators examine the build information for certain aspects and generate a Docker build configuration on the fly. They can be configured to a certain degree, where the configuration is generator specific.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Default Generators</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Generator</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-java-exec">Java Applications</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java-exec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic generator for flat classpath and fat-jar Java applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-spring-boot">Spring Boot</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring-boot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Boot specific generator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-thorntail-v2">Thorntail v2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thorntail-v2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Thorntail v2 apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-vertx">Vert.x</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Vert.x applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-webapp">Web applications</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>webapps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for WAR based applications supporting Tomcat, Jetty and Wildfly base images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-quarkus">Quarkus</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Quarkus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Quarkus based applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-openliberty">Open Liberty</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openliberty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Open Liberty applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-micronaut">Micronaut</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Micronaut based applications</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are some configuration options which are shared by all generators:</p>
</div>
<table id="generator-options-common" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Common generator options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>add</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, then the generator <em>adds</em> to an existing image configuration. By default this is disabled, so
  that a generator only kicks in when there are no other image configurations in the build, which are either configured directly for a
<code>k8sBuild</code>
or already added by a generator which has been run previously.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.add</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias name for referencing this image in various other parts of the configuration. This is also used in the log
  output. The default alias name is the name of the generator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.alias</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the base image from where to start when creating the images. By default, the generators make an opinionated
  decision for the base image which are described in the respective generator section.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.from</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>fromMode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whe using OpenShift S2I builds the base image can be either a plain docker image (mode: <code>jib</code>) or a reference to an
  <a href="https://docs.openshift.com/container-platform/3.3/architecture/core_concepts/builds_and_image_streams.html"> ImageStreamTag</a>
  (mode: <code>istag</code>). In the case of an ImageStreamTag, <code>from</code> has to be specified in the form <code>namespace/image-stream:tag</code>.
  The mode takes only effect when running in OpenShift mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.fromMode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Docker image name used when doing Docker builds. For OpenShift S2I builds its the name of the image stream. This
  can be a pattern as described in <a href="#image-name">Name Placeholders</a>. The default is <code>%g/%a:%l</code>. Note that this flag would only work
  when you&#8217;re using opinionated image configuration provided by generators. if generators are not applicable for your project configuration, this
  flag won&#8217;t work.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A optional Docker registry used when doing Docker builds. It has no effect for OpenShift S2I builds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tags</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of additional tags you want to tag your image with</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.tags</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When used as properties they can be directly referenced with the property names above.</p>
</div>
<div class="sect3">
<h4 id="generator-java-exec">6.1.1. Java Applications</h4>
<div class="paragraph">
<p>One of the most generic <em>Generators</em> is the <code>java-exec</code> generator.
It is responsible for starting up arbitrary Java application.
It knows how to deal with fat-jar applications where the application and all dependencies are included within a single jar and the <code>MANIFEST.MF</code> within the jar references a main class.
But also flat classpath applications, where the dependencies are separate jar files and a main class is given.</p>
</div>
<div class="paragraph">
<p>If no main class is explicitly configured, the plugin first attempts to locate a fat jar.
If the gradle build creates a JAR file with a <code>META-INF/MANIFEST.MF</code> containing a <code>Main-Class</code> entry, then this is considered to be the fat jar to use.
If there are more than one of such files then the largest one is used.</p>
</div>
<div class="paragraph">
<p>If a main class is configured (see below) then the image configuration will contain the application jar plus all dependency jars.
If no main class is configured as well as no fat jar being detected, then this <em>Generator</em> tries to detect a single main class by searching for <code>public static void main(String args[])</code> among the application classes. If exactly one class is found this is considered to be the main class. If no or more than one is found the <em>Generator</em> finally does nothing.</p>
</div>
<div class="paragraph">
<p>It will use the following base image by default, but as explained <a href="#generator-options-common">above</a> and can be changed with the <code>from</code> configuration.</p>
</div>
<table id="generator-java-exec-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Java Base Images</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 30.7692%;">
<col style="width: 30.7692%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
<th class="tableblock halign-left valign-top">ImageStream</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Community</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube-java</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These images always refer to the latest tag.</p>
</div>
<div class="paragraph">
<p>When a <code>fromMode</code> of <code>istag</code> is used to specify an <code>ImageStreamTag</code> and when no <code>from</code> is given, then as default the
<code>ImageStreamTag</code> <code>jkube-java</code> in the namespace <code>openshift</code> is chosen.
By default, <code>fromMode = "docker"</code> which use the a plain Docker image reference for the S2I builder image.</p>
</div>
<div class="paragraph">
<p>Beside the common configuration parameters described in the table <a href="#generator-options-common">common generator options</a>
the following additional configuration options are recognized:</p>
</div>
<table id="generator-java-exec-options" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Java Application configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory within the generated image where to put the detected artefacts into. Change this only if the base image is
  changed, too.</p>
<p class="tableblock">  Defaults to <code>/deployments</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.java-exec.targetDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jolokiaPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Jolokia agent exposed by the base image. Set this to 0 if you don&#8217;t want to expose the Jolokia port.</p>
<p class="tableblock">  Defaults to <code>8778</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.java-exec.jolokiaPort</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mainClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main class to call. If not given first a check is performed to detect a fat-jar (see above).</p>
<p class="tableblock">Next a class is looked up by scanning <code>build/classes</code> for a single class with a main method.</p>
<p class="tableblock">If no such class is found or if more than one is
  found, then this generator does nothing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.java-exec.mainClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>prometheusPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Prometheus jmx_exporter exposed by the base image. Set this to 0 if you don&#8217;t want to expose the Prometheus
  port.</p>
<p class="tableblock">  Defaults to <code>9779</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.java-exec.prometheusPort</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>webPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose as service, which is supposed to be the port of a web application. Set this to 0 if you don&#8217;t want to
  expose a port.</p>
<p class="tableblock">  Defaults to <code>8080</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.java-exec.webPort</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The exposed ports are typically later on use by <a href="#enrichers">Enrichers</a> to create default Kubernetes or OpenShift services.</p>
</div>
<div class="paragraph">
<p>You can add additional files to the target image within <code>baseDir</code> by placing files into <code>src/main/jkube-includes</code>.
These will be added with mode <code>0644</code>, while everything in <code>src/main/jkube-includes/bin</code> will be added with <code>0755</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-spring-boot">6.1.2. Spring Boot</h4>
<div class="paragraph">
<p>This generator is called <code>spring-boot</code> and gets activated when it finds a plugin with id <code>org.springframework.boot</code> in the <code>build.gradle</code>.</p>
</div>
<div class="paragraph">
<p>This generator is based on the <a href="#generator-java-exec">Java Application</a> Generator and inherits all of its configuration values. The generated container port is read from the <code>server.port</code> property <code>application.properties</code>, defaulting to <code>8080</code> if it is not found. It also uses the same default images as the <a href="#generator-java-exec-from">java-exec Generator</a>.</p>
</div>
<div class="paragraph">
<p>Beside the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options">java-exec options</a> the following additional configuration is recognized:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Spring-Boot configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>color</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, force the use of color in the Spring Boot console output.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.spring-boot.color</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The generator adds Kubernetes liveness and readiness probes pointing to either the management or server port as read from the <code>application.properties</code>.
If the <code>management.port</code> (for Spring Boot 1) or <code>management.server.port</code> (for Spring Boot 2) and <code>management.ssl.key-store</code> (for Spring Boot 1) or <code>management.server.ssl.key-store</code> (for Spring Boot 2) properties are set in <code>application.properties</code> otherwise or <code>server.ssl.key-store</code> property is set in <code>application.properties</code> then the probes are automatically set to use <code>https</code>.</p>
</div>
<div class="paragraph">
<p>The generator works differently when called together with <code>k8sWatch</code>.
In that case it enables support for <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html">Spring Boot Developer Tools</a> which allows for hot reloading of the Spring Boot app.
In particular, the following steps are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a secret token is not provided within the Spring Boot application configuration <code>application.properties</code> or <code>application.yml</code> with the key <code>spring.devtools.remote.secret</code> then a custom secret token is created and added to <code>application.properties</code></p>
</li>
<li>
<p>Add <code>spring-boot-devtools.jar</code> as <code>BOOT-INF/lib/spring-devtools.jar</code> to the spring-boot fat jar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since during <code>k8sWatch</code> the application itself within the <code>build/</code> directory is modified for allowing easy reloading you must ensure that you do a <code>gradle clean</code> before building an artifact which should be put into production.</p>
</div>
<div class="paragraph">
<p>Since the released version are typically generated with a CI system which does a clean build anyway this should be only a theoretical problem.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-thorntail-v2">6.1.3. Thorntail v2</h4>
<div class="paragraph">
<p>The Thorntail v2 generator detects a Thorntail v2 build and disables the Prometheus Java agent because of this <a href="https://issues.jboss.org/browse/THORN-1859">issue</a>.</p>
</div>
<div class="paragraph">
<p>Otherwise, this generator is identical to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-vertx">6.1.4. Vert.x</h4>
<div class="paragraph">
<p>The Vert.x generator detects an application using Eclipse Vert.x. It generates the metadata to start the application as a fat jar.</p>
</div>
<div class="paragraph">
<p>Currently, this generator is enabled if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you are using the Vert.x Gradle Plugin (<a href="https://github.com/jponge/vertx-gradle-plugin" class="bare">https://github.com/jponge/vertx-gradle-plugin</a>)</p>
</li>
<li>
<p>you are depending on <code>io.vertx:vertx-core</code> and uses the <a href="https://github.com/johnrengelman/shadow">Shadow Jar plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Otherwise, this generator is identical to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
<div class="paragraph">
<p>The generator automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enable metrics and JMX publishing of the metrics when <code>io.vertx:vertx-dropwizard-metrics</code> is in the project&#8217;s classpath / dependencies.</p>
</li>
<li>
<p>enable clustering when a Vert.x cluster manager is available in the project&#8217;s classpath / dependencies. this is done by appending <code>-cluster</code> to the command line.</p>
</li>
<li>
<p>Force IPv4 stack when <code>vertx-infinispan</code> is used.</p>
</li>
<li>
<p>Disable the async DNS resolver to fall back to the regular JVM DNS resolver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can pass application parameter by setting the <code>JAVA_ARGS</code> env variable. You can pass system properties either using the same variable or using <code>JAVA_OPTIONS</code>. For instance, create <code>src/main/jkube/deployment.yml</code> with the following content to configure <code>JAVA_ARGS</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
 template:
   spec:
     containers:
       - env:
         - name: JAVA_ARGS
           value: "-Dfoo=bar -cluster -instances=2"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generator-webapp">6.1.5. Web Applications</h4>
<div class="paragraph">
<p>The <code>webapp</code> generator tries to detect WAR builds and selects a base servlet container image based on the configuration found in the <code>build.gradle</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>Tomcat</strong> base image is selected by default.</p>
</li>
<li>
<p>A <strong>Jetty</strong> base image is selected when one of the files <code>WEB-INF/jetty-web.xml</code> or <code>WEB-INF/jetty-logging.properties</code> is found.</p>
</li>
<li>
<p>A <strong>Wildfly</strong> base image is chosen when a Wildfly specific deployment descriptor like <code>jboss-web.xml</code> is found.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The base images chosen are:</p>
</div>
<table id="generator-webapp-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Webapp Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tomcat</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-tomcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-tomcat</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Jetty</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-jetty9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-jetty9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Wildfly</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss/wildfly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/wildfly/wildfly-s2i"><code>quay.io/wildfly/wildfly-centos7</code></a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the  <a href="#generator-options-common">common generator options</a> this generator can be configured with the following options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Webapp configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>server</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix server to use in the base image. Can be either <strong>tomcat</strong>, <strong>jetty</strong> or <strong>wildfly</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.server</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to put the war file into the target image. By default, it&#8217;s selected by the base image chosen but can be
  overwritten with this option.</p>
<p class="tableblock">  Defaults to <code>/deployments</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.targetDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User and/or group under which the files should be added. The syntax of this options is described in
  <a href="#config-image-build-assembly">Assembly Configuration</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.user</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>path</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context path with which the application can be reached by default.</p>
<p class="tableblock">  Defaults to <code>/</code> (root context).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.path</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cmd</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to use to start the container. By default, the base images startup command is used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.cmd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of ports to expose in the image and which eventually are translated later to Kubernetes services.
  The ports depend on the base image and are selected automatically. But they can be overridden here.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.ports</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>env</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment variable to be set to the image builder environment. Should be set in the format <code>ENV_NAME=environment value</code>. You can inject multiple env variables by adding a new line for each variable.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.webapp.env</code></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="jakartaee-and-retrocompatibility-with-javaee-in-tomcat">JakartaEE and retrocompatibility with JavaEE in Tomcat</h5>
<div class="paragraph">
<p>From Tomcat 10, only JakartaEE compliant projects are supported. However, legacy JavaEE projects can automatically be migrated by deploying the war in <code>${CATALINA_HOME}/webapps-javaee</code>. By default, the webapp generator is based on a Tomcat 10+ image and will copy the war file to <code>${CATALINA_HOME}/webapps-javaee</code>.</p>
</div>
<div class="paragraph">
<p>If the project is already JakartaEE compliant, it is recommanded to set the webapp directory to <code>${CATALINA_HOME}/webapps</code>. This can be done by setting the property <code>jkube.generator.webapp.env</code> to <code>TOMCAT_WEBAPPS_DIR=webapps</code>.</p>
</div>
<div class="paragraph">
<p>To keep using Tomcat 9, set the properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jkube.generator.webapp.from</code> to <code>quay.io/jkube/jkube-tomcat9:0.0.16</code></p>
</li>
<li>
<p><code>jkube.generator.webapp.cmd</code> to <code>/usr/local/s2i/run</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generator-quarkus">6.1.6. Quarkus</h4>
<div class="paragraph">
<p>The <code>Quarkus</code> generator detects Quarkus based projects looking at project <code>build.gradle</code>:</p>
</div>
<div class="paragraph">
<p>The base images chosen are:</p>
</div>
<table id="generator-quarkus-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. Webapp Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Native</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.access.redhat.com/ubi8/ubi-minimal:8.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/quarkus/ubi-quarkus-native-binary-s2i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Normal Build</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="generator-openliberty">6.1.7. Open Liberty</h4>
<div class="paragraph">
<p>The Open Liberty generator runs when the Open Liberty plugin is enabled in the gradle build.</p>
</div>
<div class="paragraph">
<p>It can done via two ways as specified in <a href="https://github.com/OpenLiberty/ci.gradle#usage">OpenLiberty Gradle Plugin docs</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Within <code>apply plugin:</code> section as <code>liberty</code></p>
</li>
<li>
<p>Within <code>plugins</code> section as <code>io.openliberty.tools.gradle.Liberty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generator is similar to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
<div class="paragraph">
<p>For Open Liberty, the default value of webPort is 9080.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-micronaut">6.1.8. Micronaut Generator</h4>
<div class="paragraph">
<p>The Micronaut generator (named <code>micronaut</code>) detects a Micronaut project by analyzing the plugin</p>
</div>
<div class="paragraph">
<p>dependencies searching for <code>io.micronaut.application:io.micronaut.application.gradle.plugin</code>.</p>
</div>
<div class="paragraph">
<p>This generator is based on the <a href="#generator-java-exec">Java Application</a> Generator and inherits all
of its configuration values.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-helidon">6.1.9. Helidon</h4>
<div class="paragraph">
<p>The <code>Helidon</code> generator detects Helidon based projects looking at project <code>build.gradle</code>:</p>
</div>
<div class="paragraph">
<p>The base images chosen are the following, however, these can be overridden using <code>jkube.generator.from</code> property:</p>
</div>
<table id="generator-helidon-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Webapp Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Native</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.access.redhat.com/ubi8/ubi-minimal:8.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.access.redhat.com/ubi8/ubi-minimal:8.7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Normal Build</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quay.io/jkube/jkube-java</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="generators-api">6.2. Generator API</h3>
<div class="paragraph">
<p>It&#8217;s possible to extend Eclipse JKube&#8217;s Generator API to define your own custom Generators as per use case. Please refer to the <a href="https://github.com/eclipse/jkube/blob/master/jkube-kit/generator/api/src/main/java/org/eclipse/jkube/generator/api/Generator.java">Generator</a>
Interface; You can create new generators by implementing this interface. Please check out <a href="https://github.com/eclipse/jkube/blob/master/quickstarts/kit/custom-foo-generator/foo-generator">Custom Foo generator</a> quickstart for detailed example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enrichers">7. Enrichers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enriching is the complementary concept to <a href="#generators">Generators</a>. Whereas Generators are used to create and customize Docker images, Enrichers are use to create and customize Kubernetes resource objects.</p>
</div>
<div class="paragraph">
<p>There are a lot of similarities to Generators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Enricher has a unique name.</p>
</li>
<li>
<p>Enrichers are looked up automatically from the plugin dependencies and there is a set of default enrichers delivered with this plugin.</p>
</li>
<li>
<p>Enrichers are configured the same ways as generators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#generator-example">Generator example</a> is a good blueprint, simply replace <code>generator</code> with <code>enricher</code>. The configuration is structural identical:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. Enricher configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one ore more <code>include</code> elements with enricher names which should be included. If given, only this list of enrichers are included in this order. The enrichers from every active profile are included, too. However the enrichers listed here are moved to the front of the list, so that they are called first. Use the profile <code>raw</code> if you want to explicitly set the complete list of enrichers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>exclude</code> elements with enricher names to exclude. This means all the detected enrichers are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all enrichers. Each enricher supports a specific set of configuration values as described in its documentation. The subelements of this section are enricher names. E.g. for enricher <code>jkube-service</code>, the sub-element is called <code>jkube-service</code>. This element then holds the specific enricher configuration like <code>name</code> for the service name. Configuration coming from profiles are merged into this config, but not overriding the configuration specified here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This plugin comes with a set of default enrichers.</p>
</div>
<div class="sect2">
<h3 id="enrichers-default">7.1. Default Enrichers</h3>
<div class="paragraph">
<p>kubernetes-gradle-plugin comes with a set of enrichers which are enabled by default. There are two categories of default enrichers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enrichers-generic"><strong>Generic Enrichers</strong></a> are used to add default resource object when they are missing or add common
metadata extracted from the given build information.</p>
</li>
<li>
<p><a href="#enrichers-specific"><strong>Specific Enrichers</strong></a> are enrichers which are focused on a certain tech stack that they detect.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Default Enrichers Overview</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enricher</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-configmap-file">jkube-configmap-file</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ConfigMap elements defined as Groovy DSL or as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-controller">jkube-controller</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create default controller (replication controller, replica set or deployment <a href="https://kubernetes.io/docs/concepts/workloads/controllers/">Kubernetes doc</a>) if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-container-env-java-options">jkube-container-env-java-options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merges <code>JAVA_OPTIONS</code> environment variable defined in <a href="#config-image-build">Build configuration (<a href="#config-image">image</a>)</a>
environment (<code>env</code>) with <code>Container</code> <code>JAVA_OPTIONS</code> environment variable added
by other enrichers, Groovy DSL configuration or fragment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-debug">jkube-debug</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables debug mode via a property or Groovy DSL configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-dependency">jkube-dependency</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Examine build dependencies for <code>kubernetes.yml</code>/<code>openshift.yml</code> and add the objects found therein.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-git">jkube-git</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check local <code>.git</code> directory and add build information as annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-image">jkube-image</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add the image name into a <code>PodSpec</code> of replication controller, replication sets and deployments, if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-ingress">jkube-ingress</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a default Ingress if missing or configured from Groovy DSL configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-imagepullpolicy">jkube-imagepullpolicy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides ImagePullPolicy in controller resources provided <code>jkube.imagePullPolicy</code> property is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-metadata">jkube-metadata</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add labels/annotations to generated Kubernetes resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-namespace">jkube-namespace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the <em>Namespace</em> of the generated and processed Kubernetes resources metadata and optionally create a new Namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-name">jkube-name</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a default name to every object which misses a name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-persistentvolumeclaim-storageclass">jkube-persistentvolumeclaim-storageclass</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add name of StorageClass required by PersistentVolumeClaim either in metadata or in spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-pod-annotation">jkube-pod-annotation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy over annotations from a <code>Deployment</code> to a <code>Pod</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-portname">jkube-portname</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a default portname for commonly known service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-project-label">jkube-project-label</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add gradle coordinates as labels to all objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-replicas">jkube-replicas</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override number of replicas for any controller processed by JKube.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-revision-history-enricher">jkube-revision-history</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add revision history limit (<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#revision-history-limit">Kubernetes doc</a>) as a deployment spec property to the Kubernetes/OpenShift resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-secret-file">jkube-secret-file</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Secret elements defined as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-security-hardening">jkube-security-hardening</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforces best practice and recommended security rules for Kubernetes and OpenShift resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-service">jkube-service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a default service if missing and extract ports from the Docker image configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-serviceaccount">jkube-serviceaccount</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a ServiceAccount defined as Groovy DSL or mentioned in resource fragment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-triggers-annotation">jkube-triggers-annotation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ImageStreamTag change triggers on Kubernetes resources such as StatefulSets, ReplicaSets and DaemonSets using the <code>image.openshift.io/triggers</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-volume-permission">jkube-volume-permission</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixes the permission of persistent volume mount with the help of an init container.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="enrichers-generic">7.1.1. Generic Enrichers</h4>
<div class="paragraph">
<p>Default generic enrichers are used for adding missing resources or adding metadata to given resource objects.
The following default enhancers are available out of the box.</p>
</div>
<div class="sect4">
<h5 id="jkube-configmap-file">jkube-configmap-file</h5>
<div class="paragraph">
<p>This enricher adds ConfigMap defined as <code>resources</code> in plugin configuration and/or resolves file content from an annotation.</p>
</div>
<div class="paragraph">
<p>As Groovy you can define:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  resources {
    configMap {
      name = 'myconfigmap'
      entries = [{
        name = 'A'
        value = 'B'
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a ConfigMap data with key <code>A</code> and value <code>B</code>.</p>
</div>
<div class="paragraph">
<p>You can also use <code>file</code> tag to refer to the content of a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  resources {
    configMap {
      name = 'configmap-test'
      entries = [{
        file = 'src/test/resources/test-application.properties'
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a ConfigMap with key <code>test-application.properties</code> and value the content of the <code>src/test/resources/test-application.properties</code> file.
If you set <code>name</code> tag then this is used as key instead of the filename.</p>
</div>
<div class="sect5">
<h6 id="configmap-configuration">ConfigMap Groovy DSL Configuration</h6>
<div class="paragraph">
<p>Here are the supported options while providing <code>configMap</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. Groovy DSL configmap configuration <code>configMap</code></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configmap-entry-configuration"><code>entries</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data for ConfigMap</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the ConfigMap</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="configmap-entry-configuration">ConfigMap Entry Groovy DSL Configuration</h6>
<div class="paragraph">
<p><code>entries</code> is a list of <code>entry</code> configuration objects. Here are the supported options while providing <code>entry</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. Groovy DSL configmap entry configuration <code>entry</code></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entry value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path to a file or directory. If it&#8217;s a single file then file contents would be read as value. If it&#8217;s a directory then each file&#8217;s content is stored as value with file name as key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entry name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you are defining a custom <code>ConfigMap</code> file, you can use an annotation to define a file name as key and its content as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">metadata:
  name: ${name}
  annotations:
    jkube.eclipse.org/cm/application.properties: src/test/resources/test-application.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>ConfigMap</code> data with key <code>application.properties</code> (part defined after <code>cm</code>) and value the content of <code>src/test/resources/test-application.properties</code> file.</p>
</div>
<div class="paragraph">
<p>You can specify a directory instead of a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">metadata:
  name: ${name}
  annotations:
    jkube.eclipse.org/cm/application.properties: src/test/resources/test-dir</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>ConfigMap</code> named <code>application.properties</code> (part defined after <code>cm</code>) and for each file under the directory <code>test-dir</code> one entry with file name as key and its content as the value; subdirectories are ignored.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-controller">jkube-controller</h5>
<div class="paragraph">
<p>This enricher is used to ensure that a controller is present.
This can be either directly configured with fragments or with the Groovy DSL configuration.
An explicit configuration always takes precedence over auto detection.
See <a href="https://kubernetes.io/docs/concepts/workloads/controllers/">Kubernetes doc</a> for more information on types of controllers.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table id="enricher-jkube-controller" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. Default controller enricher</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Controller. Kubernetes Controller names must start with a letter. If the maven artifactId starts with a
  digit, <code>s</code> will be prefixed.</p>
<p class="tableblock">  Defaults to project name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-controller.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pullPolicy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Deprecated</strong>: use <code>jkube.imagePullPolicy</code> instead.</p>
<p class="tableblock">Image pull policy to use for the container. One of: <em>IfNotPresent</em>, <em>Always</em>.</p>
<p class="tableblock">  Defaults to <code>IfNotPresent</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-controller.pullPolicy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of Controller to create. One of: <em>ReplicationController</em>, <em>ReplicaSet</em>, <em>Deployment</em>, <em>DeploymentConfig</em>,
  <em>StatefulSet</em>, <em>DaemonSet</em>, <em>Job</em>, <em>CronJob</em>.</p>
<p class="tableblock">  Defaults to <code>Deployment</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-controller.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>replicaCount</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of replicas for the container.</p>
<p class="tableblock">  Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-controller.replicaCount</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>schedule</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schedule for <em>CronJob</em> written in <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-controller.schedule</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image pull policy to use for the container. One of: <em>IfNotPresent</em>, <em>Always</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.imagePullPolicy</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-container-env-java-options">jkube-container-env-java-options</h5>
<div class="paragraph">
<p>Merges <code>JAVA_OPTIONS</code> environment variable defined in <a href="#config-image-build">Build configuration (<a href="#config-image">image</a>)</a>
environment (<code>env</code>) with <code>Container</code> <code>JAVA_OPTIONS</code> environment variable added
by other enrichers, Groovy DSL configuration or fragment.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>disable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled the enricher, any <code>JAVA_OPTIONS</code> environment variable defined by an enricher,
Groovy DSL configuration or YAML fragment will override the one defined by the generator
  or Image Build configuration.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-container-env-java-options.disable</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-debug">jkube-debug</h5>
<div class="paragraph">
<p>This enricher enables debug mode via a property <code>jkube.debug.enabled</code> or via enabling debug mode in enricher configuration.</p>
</div>
<div class="paragraph">
<p>You can either set this property in <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">jkube.debug.enabled = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or provide Groovy DSL configuration for enricher</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    enricher {
        config {
            'jkube-debug' {
                enabled = true
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would do the following things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add environment variable <code>JAVA_ENABLE_DEBUG</code> with value set to <code>true</code> in your application container</p>
</li>
<li>
<p>Add a container port named <code>debug</code> to your existing list of container ports with value set via <code>JAVA_DEBUG_PORT</code> environment variable. If not present, it defaults to <code>5005</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jkube-dependency">jkube-dependency</h5>
<div class="paragraph">
<p>This enricher is used for embedding Kubernetes configuration manifests (YAML) to single package. It looks for the following files in compile scope dependencies and adds Kubernetes resources inside to final generated Kubernetes manifests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/jkube/kubernetes.yml</code></p>
</li>
<li>
<p><code>META-INF/jkube/k8s-template.yml</code></p>
</li>
<li>
<p><code>META-INF/jkube/openshift.yml</code> (in case of OpenShift)</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. Configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>includeTransitive</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to look for kubernetes manifest files in transitive dependencies.</p>
<p class="tableblock">  Defaults to <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-dependency.includeTransitive</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>includePlugin</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to look on the current plugin classpath too.</p>
<p class="tableblock">  Defaults to <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-dependency.includePlugin</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-git">jkube-git</h5>
<div class="paragraph">
<p>Enricher that adds info from <code>.git</code> directory as annotations. These are explained in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. Annotations added via Git enricher</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.eclipse.org/git-branch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current Git Branch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.eclipse.org/git-commit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest commit of current branch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.eclipse.org/git-url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of your configured git remote</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.io/git-branch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use <code>jkube.eclipse.org/</code> annotation prefix.</em></p>
<p class="tableblock">Current Git Branch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.io/git-commit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use <code>jkube.eclipse.org/</code> annotation prefix.</em></p>
<p class="tableblock">Latest commit of current branch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.io/git-url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use <code>jkube.eclipse.org/</code> annotation prefix.</em></p>
<p class="tableblock">URL of your configured git remote</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. Supported Configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>gitRemote</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the git remote name, whose URL you want to annotate as 'git-url'.</p>
<p class="tableblock">  Defaults to <code>origin</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.remoteName</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-image">jkube-image</h5>
<div class="paragraph">
<p>This enricher merges in container image related fields into specified controller (e.g <code>Deployment</code>, <code>ReplicaSet</code>, <code>ReplicationController</code> etc.) Pod specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The full image name is set as <code>image</code>.</p>
</li>
<li>
<p>An image alias is set as <code>name</code>. If alias isn&#8217;t provided, then opinionated name using image user and project name is used.</p>
</li>
<li>
<p>The pull policy <code>imagePullPolicy</code> is set according to the given configuration. If no
configuration is set, the default is <code>IfNotPresent</code> for release versions, and <code>Always</code> for snapshot versions.</p>
</li>
<li>
<p>Environment variables as configured via Groovy DSL configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any already configured container in the pod spec is updated if the property is not set.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. Configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pullPolicy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What pull policy to use when fetching images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-image.pullPolicy</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-ingress">jkube-ingress</h5>
<div class="paragraph">
<p>Enricher responsible for creation of Ingress either using opinionated defaults or as per provided Groovy DSL configuration.
This enricher gets activated when <code>jkube.createExternalUrls</code> is set to <code>true</code>.
JKube generates Ingress only for Services which have either <code>expose=true</code> or <code>exposeUrl=true</code> labels set.</p>
</div>
<div class="paragraph">
<p>For more information, check out <a href="#ingress-generation">Ingress Generation</a> section.</p>
</div>
<table id="enricher-jkube-ingress" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. Ingress enricher</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host is the fully qualified domain name of a network host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-ingress.host</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetApiVersion</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to generate <code>extensions/v1beta1</code> Ingress or <code>networking.k8s.io/v1</code> Ingress.</p>
<p class="tableblock">  Defaults to <code>networking.k8s.io/v1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-ingress.targetApiVersion</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-imagepullpolicy">jkube-imagepullpolicy</h5>
<div class="paragraph">
<p>This enricher fixes ImagePullPolicy for Kubernetes/Openshift resources whenever a <code>-Djkube.imagePullPolicy</code> parameter is provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-metadata">jkube-metadata</h5>
<div class="paragraph">
<p>This enricher is responsible for adding labels and annotations to your resources. It reads <code>labels</code> and <code>annotations</code> fields provided in <code>resources</code> and adds respective labels/annotations to Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>You can also configure whether you want to add these labels/annotations to some specific resource or all resources.</p>
</div>
<div class="paragraph">
<p>You can see an example if it&#8217;s usage in k8sResource <a href="#labels-annotation-configuration">Labels And Annotations</a> section.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-namespace">jkube-namespace</h5>
<div class="paragraph">
<p>This enricher adds a <code>Namespace</code>/<code>Project</code> resource to the Kubernetes Resources list in case the namespace
configuration (<code>jkube.enricher.jkube-namespace.namespace</code>) is provided.</p>
</div>
<div class="paragraph">
<p>In addition, this enricher sets the namespace (<code>.metadata.namespace</code> ) of the JKube generated and processed Kubernetes
resources in case they don&#8217;t already have one configured (see the <code>force</code> configuration).</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table id="enricher-jkube-namespace" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 55. Default namespace enricher</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace as string which we want to create. A new <code>Namespace</code> object will be created and added to the list of Kubernetes resources generated during the enrichment phase.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-namespace.namespace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether we want to generate a <code>Namespace</code> or an OpenShift specific <code>Project</code> resource. One of: <em>Namespace</em>, <em>Project</em>.</p>
<p class="tableblock">  Defaults to <code>Namespace</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-namespace.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>force</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the <code>.metadata.namespace</code> field must be forced even if the resource has already one configured.</p>
<p class="tableblock">  Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-namespace.force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This enricher also configures generated Namespace in <code>.metadata.namespace</code> field for Kubernetes resources as per provided Groovy DSL configuration too. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  resources {
    namespace = 'mynamespace'
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-name">jkube-name</h5>
<div class="paragraph">
<p>Enricher for adding a "name" to the metadata to various objects we create.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 56. Supported Configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <code>.metadata.name</code> of all generated Kubernetes manifests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-name.name</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-pod-annotation">jkube-pod-annotation</h5>
<div class="paragraph">
<p>This enricher copies the annotations from a Controller (Deployment/ReplicaSet/StatefulSet) metadata to the annotations of
container Pod template spec&#8217;s metadata.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-portname">jkube-portname</h5>
<div class="paragraph">
<p>This enricher uses a given set of well known ports:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Default Port Mappings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8443</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8778</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jolokia</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9779</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheus</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If not found, it creates container ports with names of IANA registered services.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-project-label">jkube-project-label</h5>
<div class="paragraph">
<p>Enricher that adds standard labels and selectors to generated resources (e.g. <code>app</code>, <code>group</code>, <code>provider</code>, <code>version</code>).</p>
</div>
<div class="paragraph">
<p>The <code>jkube-project-label</code> enricher supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useProjectLabel</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable this flag to turn on the generation of the old <code>project</code> label in Kubernetes resources. The <code>project</code> label has
been replaced by the <code>app</code> label in newer versions of the plugin.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-project-label.useProjectLabel</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>app</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes it possible to define a custom <code>app</code> label used in the generated resource files used for deployment.</p>
<p class="tableblock">Defaults to the Gradle Project <code>name</code> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-project-label.app</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>provider</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes it possible to define a custom <code>provider</code> label used in the generated resource files used for deployment.</p>
<p class="tableblock">Defaults to <code>jkube</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-project-label.provider</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>group</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes it possible to define a custom <code>group</code> label used in the generated resource files used for deployment.</p>
<p class="tableblock">Defaults to the Gradle Project <code>group</code> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-project-label.group</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes it possible to define a custom <code>version</code> label used in the generated resource files used for deployment.</p>
<p class="tableblock">Defaults to the Gradle Project <code>version</code> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-project-label.version</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The project labels which are already specified in the input fragments are not overridden by the enricher.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-persistentvolumeclaim-storageclass">jkube-persistentvolumeclaim-storageclass</h5>
<div class="paragraph">
<p>Enricher which fixes adds name of StorageClass required by PersistentVolumeClaim either in metadata or in spec.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. Supported properties</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>defaultStorageClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolume storage class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.defaultStorageClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useStorageClassAnnotation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, storage class would be added to PersistentVolumeClaim metadata as <code>volume.beta.kubernetes.io/storage-class=&lt;storageClassName&gt;</code> annotation rather than <code>.spec.storageClassName</code></p>
<p class="tableblock">Defaults to <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.useStorageClassAnnotation</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-replicas">jkube-replicas</h5>
<div class="paragraph">
<p>This enricher overrides the number of replicas for <strong>every</strong> controller
(<em>DaemonSet</em>, <em>Deployment</em>, <em>DeploymentConfig</em>, <em>Job</em>, <em>CronJob</em>, <em>ReplicationController</em>, <em>ReplicaSet</em>, <em>StatefulSet</em>)
generated or processed by JKube (including those from <a href="#jkube-dependency">dependencies</a>).</p>
</div>
<div class="paragraph">
<p>In order to use this enricher you need to configure the <code>jkube.replicas</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle -Pjkube.replicas=42 k8sResource</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">jkube.replicas = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this Enricher at runtime to temporarily force the number of replicas to a given value.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-revision-history-enricher">jkube-revision-history</h5>
<div class="paragraph">
<p>This enricher adds <code>spec.revisionHistoryLimit</code> property to deployment spec of Kubernetes/OpenShift resources.
A deployment’s revision history is stored in the replica sets, that specifies the number of old ReplicaSets to retain in order to allow rollback.
For more information read <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#revision-history-limit">Kubernetes documentation</a>.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. Default revision history enricher</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>limit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of revision histories to retain.</p>
<p class="tableblock">  Defaults to <code>2</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-revision-history.limit</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Just as any other enricher you can specify required properties with in the enricher&#8217;s configuration as below,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-revision-history' {
         limit = 8
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This information will be enriched as spec property in the generated manifest like,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
kind: Deployment
spec:
  revisionHistoryLimit: 8
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-secret-file">jkube-secret-file</h5>
<div class="paragraph">
<p>This enricher adds Secret defined as file content from an annotation.</p>
</div>
<div class="paragraph">
<p>If you are defining a custom <code>Secret</code> file, you can use an annotation to define a file name as key and its content as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">metadata:
  name: ${name}
  annotations:
    jkube.eclipse.org/secret/application.properties: src/test/resources/test-application.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>Secret</code> data with the key <code>application.properties</code> (part defined after <code>secret</code>) and value content of
<code>src/test/resources/test-application.properties</code> file (base64 encoded).</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-security-hardening">jkube-security-hardening</h5>
<div class="paragraph">
<p>This enricher enforces security best practices and recommendations for Kubernetes objects
such as Deployments, ReplicaSets, Jobs, CronJobs, and so on.</p>
</div>
<div class="paragraph">
<p>The enricher is not included in the <code>default</code> <a href="#profiles">profile</a>.
However, you can easily enable it by <a href="#profiles-using">leveraging</a> the <code>security-hardening</code>
profile.</p>
</div>
<div class="paragraph">
<p>These are <strong>some</strong> of the rules enforces by this enricher:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disables the auto-mounting of the service account token.</p>
</li>
<li>
<p>Prevents containers from running in privileged mode.</p>
</li>
<li>
<p>Ensures containers do not allow privilege escalation.</p>
</li>
<li>
<p>Prevents containers from running as the root user.</p>
</li>
<li>
<p>Configures the container to run as a user with a high UID to avoid host conflict.</p>
</li>
<li>
<p>Ensures the container&#8217;s seccomp is set to Runtime/Default.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jkube-service">jkube-service</h5>
<div class="paragraph">
<p>This enricher is used to ensure that a service is present.
This can be either directly configured with fragments or with the Groovy DSL configuration, but it can be also automatically inferred by looking at the ports exposed by an image configuration.
An explicit configuration always takes precedence over auto detection. For enriching an existing service this enricher actually works only on a configured service which matches with the configured (or inferred) service name.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table id="enricher-jkube-service" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. Default service enricher</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name to enrich by default. If not given here or configured elsewhere, the artifactId/project name is used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>headless</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether a headless service without a port should be configured. A headless service has the <code>ClusterIP</code> set to <code>None</code>
  and will be only used if no ports are exposed by the image configuration or by the configuration <code>port</code>.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.headless</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>expose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a label <code>expose</code> with value <code>true</code> is added which can be picked up by the jkube.
  <a href="https://github.com/jenkins-x/exposecontroller">expose-controller</a> to expose the service to the outside by various means.
  See the documentation of expose-controller for more details.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.expose</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes / OpenShift service type to set like <em>LoadBalancer</em>, <em>NodePort</em> or <em>ClusterIP</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service port to use. By default the same port as the ports exposed in the image configuration is used, but can be
  changed with this parameter. See <a href="#jkube-service-ports">below</a> for a detailed description of the format which can be
  put into this variable.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>multiPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to <code>true</code> if you want all ports to be exposed from an image configuration. Otherwise only the first port is
  used as a service port.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.multiPort</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>protocol</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default protocol to use for the services. Must be <code>tcp</code> or <code>udp</code>.</p>
<p class="tableblock">  Defaults to <code>tcp</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.protocol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>normalizePort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize the port numbering of the service to common and conventional port numbers.</p>
<p class="tableblock">  Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-service.normalizePort</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Following is the Port mapping that comes in effect, when normalizePort option is set true.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Original Port</th>
<th class="tableblock halign-left valign-top">Normalized Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8081</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8181</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You specify the properties like for any enricher within the enrichers configuration like in</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-service' {
         name = 'my-service'
         type = 'NodePort'
         multiPort = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div id="jkube-service-ports" class="paragraph">
<div class="title">Port specification</div>
<p>With the option <code>port</code> you can influence the mapping how ports are mapped from the pod to the service.
By default, and if this option is not given the ports exposed are dictated by the ports exposed from the Docker images contained in the pods.
Remember, each image configured can be part of the pod.
However, you can expose also completely different ports as the images meta data declare.</p>
</div>
<div class="paragraph">
<p>The property <code>port</code> can contain a comma separated list of mappings of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&lt;servicePort1&gt;:&lt;targetPort1&gt;/&lt;protocol&gt;,&lt;servicePort2&gt;:&lt;targetPort2&gt;/&lt;protocol&gt;,....</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>targetPort</code> and <code>protocol</code> specification is optional. These ports are overlayed over the ports exposed by the images, in the given order.</p>
</div>
<div class="paragraph">
<p>This is best explained by some examples.</p>
</div>
<div class="paragraph">
<p>For example if you have a pod which exposes a Microservice on port 8080 and you want to expose it as a service on port 80 (so that it can be accessed with <code><a href="http://myservice" class="bare">http://myservice</a></code>)  you can simply use the following enricher configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-service' {
         name = 'myservice'
         port = '80:8080' <i class="conum" data-value="1"></i><b>(1)</b>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>80 is the service port, 8080 the port opened in from the pod&#8217;s images</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your pod <em>exposes</em> their ports (which e.g. all generator do), then you can even omit the 8080 here (i.e. <code>port = 80</code>).
In this case the <em>first</em> port exposed will be mapped to port 80, all other exposed ports will be omitted.</p>
</div>
<div class="paragraph">
<p>By default, an automatically generated service only exposes the first port, even when more ports are exposed.
When you want to map multiple ports you need to set the config option <code>multiPort</code> to <code>true</code>.
In this case you can also provide multiple mappings as a comma separated list in the <code>port</code> specification where each element of the list are the mapping for the first, second, &#8230;&#8203; port.</p>
</div>
<div class="paragraph">
<p>A more (and bit artificially constructed) specification could be <code>port = '80,9779:9779/udp,443'</code>.
Assuming that the image exposes ports <code>8080</code> and <code>8778</code> (either directly or via <a href="#generators">generators</a>) and we have switched on multiport mode, then the following service port mappings will be performed for the automatically generated service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod port 8080 is mapped to service port 80.</p>
</li>
<li>
<p>Pod port 9779 is mapped to service port 9779 with protocol UDP. Note how this second entry overrides the pod exposed port 8778.</p>
</li>
<li>
<p>Pod port 443 is mapped to service port 443.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example shows also the mapping rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Port specification in <code>port</code> always override the port metadata of the contained Docker images (i.e. the ports exposed)</p>
</li>
<li>
<p>You can always provide a complete mapping with <code>port</code> on your own</p>
</li>
<li>
<p>The ports exposed by the images serve as <em>default values</em> which are used if not specified by this configuration option.</p>
</li>
<li>
<p>You can map ports which are <em>not</em> exposed by the images by specifying them as target ports.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Multiple ports are <strong>only</strong> mapped when <em>multiPort</em> mode is enabled (which is switched off by default). If <em>multiPort</em> mode is disabled, only the first port from the list of mapped ports calculated as above is taken.</p>
</div>
<div class="paragraph">
<p>When you set <code>legacyPortMapping</code> to true then ports 8080 to 9090 are mapped to port 80 automatically if not explicitly mapped via <code><em>port</em></code>. I.e. when an image exposes port 8080 with a legacy mapping this mapped to a service port 80, not 8080. You <em>should not</em> switch this on for any good reason. In fact, it might be that this option can vanish anytime.</p>
</div>
<div class="paragraph">
<p>This enricher is also used by <code>resources</code> Groovy DSL configuration to generate Service configured via Groovy DSL. Here are the fields supported in <code>resources</code> which work with this enricher:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. Fields supported in <code>resources</code></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#service-resource-configuration"><code>services</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration element for generating Service resource</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="service-resource-configuration">Service Groovy DSL Configuration</h6>
<div class="paragraph">
<p><code>services</code> is a list of <code>service</code> configuration objects. Here are the supported options while providing <code>service</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. Groovy DSL <code>service</code> configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>headless</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether this is a headless service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normalizePort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to normalize service port numbering.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#service-port-resource-configuration"><code>ports</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ports to expose</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="service-port-resource-configuration">Service <code>port</code> Configuration</h6>
<div class="paragraph">
<p><code>ports</code> is a list of <code>port</code> configuration objects. Here are the supported options while providing <code>port</code> in Groovy DSL configuration</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Groovy DSL service port configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol to use. Can be either "tcp" or "udp".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container port to expose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>targetPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target port to expose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodePort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose from the port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the port</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jkube-serviceaccount">jkube-serviceaccount</h5>
<div class="paragraph">
<p>This enricher is responsible for creating ServiceAccount resource. See <a href="#serviceaccount-generation">ServiceAccount Generation</a> for more details.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table id="enricher-jkube-serviceaccount" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. ServiceAccountEnricher configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipCreate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip creating ServiceAccount objects</p>
<p class="tableblock">Defaults to <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-serviceaccount.skipCreate</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-triggers-annotation">jkube-triggers-annotation</h5>
<div class="paragraph">
<p>OpenShift resources like BuildConfig and DeploymentConfig can be automatically triggered by changes to ImageStreamTags. However, plain Kubernetes resources don&#8217;t have a way to support this kind of triggering. You can use <code>image.openshift.io/triggers</code> annotation in OpenShift to request triggering. Read OpenShift docs for more details : <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/images/triggering-updates-on-imagestream-changes">Triggering updates on ImageStream changes</a></p>
</div>
<div class="paragraph">
<p>This enricher adds ImageStreamTag change triggers on Kubernetes resources that support the <code>image.openshift.io/triggers</code> annotation, such as StatefulSets, ReplicaSets and DaemonSets.</p>
</div>
<div class="paragraph">
<p>The trigger is added to all containers that apply, but can be restricted to a limited set of containers using the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    enricher {
        config {
            'jkube-triggers-annotation' {
                containers = 'container-name-1,c2'
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-volume-permission">jkube-volume-permission</h5>
<div class="paragraph">
<p>Enricher which fixes the permission of persistent volume mount with the help of an init container.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. Supported properties</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>imageName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image name for PersistentVolume init container</p>
<p class="tableblock">  Defaults to <code>busybox</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.imageName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>permission</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolume init container access mode</p>
<p class="tableblock">Defaults to <code>777</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.permission</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>defaultStorageClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use <a href="#jkube-persistentvolumeclaim-storageclass">PersistentVolumeClaimStorageClassEnricher</a>'s defaultStorageClass field</em></p>
<p class="tableblock">PersistentVolume storage class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.defaultStorageClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useStorageClassAnnotation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Deprecated: Use <a href="#jkube-persistentvolumeclaim-storageclass">PersistentVolumeClaimStorageClassEnricher</a>'s defaultStorageClass field</em></p>
<p class="tableblock">If enabled, storage class would be added to PersistentVolumeClaim metadata as <code>volume.beta.kubernetes.io/storage-class=&lt;storageClassName&gt;</code> annotation rather than <code>.spec.storageClassName</code></p>
<p class="tableblock">Defaults to <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.useStorageClassAnnotation</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cpuLimit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set PersistentVolume <strong>initContainer</strong>'s <code>.resources</code> CPU limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.cpuLimit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>memoryLimit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set PersistentVolume <strong>initContainer</strong>'s <code>.resources</code> memory limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.memoryLimit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cpuRequest</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set PersistentVolume <strong>initContainer</strong>'s <code>.resources</code> CPU request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.cpuRequest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>memoryRequest</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set PersistentVolume <strong>initContainer</strong>'s <code>.resources</code> memory request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-volume-permission.memoryRequest</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="enrichers-specific">7.1.2. Specific Enrichers</h4>
<div class="paragraph">
<p>Specific enrichers provide resource manifest enhancement for a certain tech stack that they detect.</p>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-openliberty">jkube-healthcheck-openliberty</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness and startup probes for OpenLiberty based projects. Note that Kubernetes startup probes are only added in projects using MicroProfile 3.1 and later.</p>
</div>
<div class="paragraph">
<p>The application should be configured as follows to enable the enricher (i.e. Either <code>microProfile</code> or <code>mpHealth</code> should be enabled in Liberty Server Configuration file as pointed out in <a href="https://www.openliberty.io/docs/latest/reference/feature/mpHealth-4.0.html">OpenLiberty Health Docs</a>)</p>
</div>
<div class="listingblock">
<div class="title">server.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;featureManager&gt;
    &lt;feature&gt;mpHealth-4.1&lt;/feature&gt;
&lt;/featureManager&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="probe-configuration">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspects of the probes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. OpenLiberty HealthCheck Enricher probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheme</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p>
<p class="tableblock">  Defaults to <code>HTTP</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.scheme</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container.</p>
<p class="tableblock">  Defaults to <code>9080</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.livenessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.livenessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.livenessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">  Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.livenessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.livenessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.livenessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.livenessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.livenessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/live</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.livenessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.readinessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.readinessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.readinessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.readinessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.readinessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.readinessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.readinessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.readinessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/ready</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.readinessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.startupProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.startupFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.startupProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.startupSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.startupProbe</code>. Number of seconds after the container has started before liveness or startup probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.startupInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.startupProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.startupPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/started</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-openliberty.startupPath</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-spring-boot">jkube-healthcheck-spring-boot</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Spring Boot. This requires the following dependency
has been enabled in Spring Boot</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">implementation 'org.springframework.boot:spring-boot-starter-actuator'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will try to discover the settings from the <code>application.properties</code> / <code>application.yaml</code> Spring Boot configuration file.</p>
</div>
<div class="paragraph">
<p>The port number is read from the <code>management.port</code> option, and will use the default value of <code>8080</code>
The scheme will use HTTPS if <code>server.ssl.key-store</code> option is in use, and fallback to use <code>HTTP</code> otherwise.</p>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readinessProbeInitialDelaySeconds</code> : <code>10</code></p>
</li>
<li>
<p><code>readinessProbePeriodSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>livenessProbeInitialDelaySeconds</code> : <code>180</code></p>
</li>
<li>
<p><code>livenessProbePeriodSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>timeoutSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>failureThreshold</code>: <code>3</code></p>
</li>
<li>
<p><code>successThreshold</code>: <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-gradle-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-spring-boot' {
         timeoutSeconds = '5'
         readinessProbeInitialDelaySeconds = '30'
         failureThreshold = '3'
         successThreshold = '1'
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-thorntail-v2">jkube-healthcheck-thorntail-v2</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Thorntail v2. This requires the following fraction
has been enabled in Thorntail</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">implementation 'io.thorntail:microprofile-health:2.7.0.Final'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code></p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = <code>/health</code></p>
</li>
<li>
<p>failureThreshold = <code>3</code></p>
</li>
<li>
<p>successThreshold = <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-gradle-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-thorntail' {
         port = '4444'
         scheme = 'HTTPS'
         path = 'health/myapp'
         failureThreshold = '3'
         successThreshold = '1'
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-quarkus">jkube-healthcheck-quarkus</h5>
<div class="paragraph">
<p>This enricher adds kubernetes <em>readiness</em>, <em>liveness</em> and <em>startup</em> probes with Quarkus. This requires the following dependency
to be added to your Quarkus project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">implementation 'io.quarkus:quarkus-smallrye-health'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will try to discover the settings from the <code>application.properties</code> / <code>application.yaml</code>
configuration file. JKube uses the following properties to resolve the health check URLs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.http.root-path</code>: Quarkus Application root path.</p>
</li>
<li>
<p><code>quarkus.http.non-application-root-path</code>: This property got introduced in recent versions of Quarkus(2.x) for non application endpoints.</p>
</li>
<li>
<p><code>quarkus.smallrye-health.root-path</code>: The location of the all-encompassing health endpoint.</p>
</li>
<li>
<p><code>quarkus.smallrye-health.readiness-path</code>: The location of the readiness endpoint.</p>
</li>
<li>
<p><code>quarkus.smallrye-health.liveness-path</code>: The location of the liveness endpoint.</p>
</li>
<li>
<p><code>quarkus.smallrye-health.startup-path</code>: The location of the startup endpoint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Please note that behavior of these properties seem to have changed since Quarkus 1.11.x versions (e.g for health and liveness paths leading slashes are now being considered). <code>kubernetes-gradle-plugin</code> would also check quarkus version along with value of these properties in order to resolve effective health endpoints.</p>
</div>
<div class="paragraph">
<p>You can read more about these flags in <a href="https://quarkus.io/guides/smallrye-health">Quarkus Documentation</a>.</p>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scheme</code> : <code>HTTP</code></p>
</li>
<li>
<p><code>port</code> : <code>8080</code></p>
</li>
<li>
<p><code>failureThreshold</code> : <code>3</code></p>
</li>
<li>
<p><code>successThreshold</code> : <code>1</code></p>
</li>
<li>
<p><code>livenessInitialDelay</code> : <code>10</code></p>
</li>
<li>
<p><code>readinessInitialDelay</code> : <code>5</code></p>
</li>
<li>
<p><code>startupInitialDelay</code> : <code>5</code></p>
</li>
<li>
<p><code>livenessPath</code> : <code>q/health/live</code></p>
</li>
<li>
<p><code>readinessPath</code> : <code>q/health/ready</code></p>
</li>
<li>
<p><code>startupPath</code> : <code>q/health/started</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-gradle-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-quarkus' {
         livenessInitialDelay = '5'
         failureThreshold = '3'
         successThreshold = '1'
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-micronaut">jkube-healthcheck-micronaut</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes for Micronaut based projects.</p>
</div>
<div class="paragraph">
<p>The application should be configured as follows to enable the enricher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">endpoints:
  health:
    enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will try to discover the settings from the <code>application.properties</code> / <code>application.yaml</code> Micronaut configuration file.</p>
</div>
<div class="sect5">
<h6 id="probe-configuration-2">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspects of the probes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. Micronaut HealthCheck Enricher probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessProbeInitialDelaySeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after the container has started before the readiness probe is initialized.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.readinessProbeInitialDelaySeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessProbePeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often (in seconds) to perform the readiness probe.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.readinessProbePeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessProbeInitialDelaySeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after the container has started before the liveness probe is initialized.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.livenessProbeInitialDelaySeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessProbePeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often (in seconds) to perform the liveness probe.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.livenessProbePeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">  Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.failureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>successThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">  Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.successThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>timeoutSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after which the probes timeout.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.timeoutSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheme</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p>
<p class="tableblock">  Defaults to <code>HTTP</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.scheme</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container.</p>
<p class="tableblock">  Defaults to the one provided in the Image configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>path</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the HTTP server.</p>
<p class="tableblock">  Defaults to <code>/health</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-micronaut.path</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-vertx">jkube-healthcheck-vertx</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Eclipse Vert.x applications.
The readiness probe lets Kubernetes detect when the application is ready, while the liveness probe allows Kubernetes to
verify that the application is still alive.</p>
</div>
<div class="paragraph">
<p>This enricher allows configuring the readiness and liveness probes. The following probe types are supported:
<code>http</code> (emit HTTP requests), <code>tcp</code> (open a socket), <code>exec</code> (execute a command).</p>
</div>
<div class="paragraph">
<p>By default, this enricher uses the same configuration for liveness and readiness probes. But specific configurations can
be provided too. The configurations can be overridden using project&#8217;s properties.</p>
</div>
<div class="sect5">
<h6 id="using-the-jkube-healthcheck-vertx-enricher">Using the jkube-healthcheck-vertx enricher</h6>
<div class="paragraph">
<p>The enricher is automatically executed if your project uses the <code>io.vertx.vertx-plugin</code> or depends on <code>io.vertx:vertx-core</code>.
However, by default, no health check will be added to your deployment unless configured explicitly.</p>
</div>
</div>
<div class="sect5">
<h6 id="minimal-configuration">Minimal configuration</h6>
<div class="paragraph">
<p>The minimal configuration to add health checks is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
        path = "/health"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It configures the readiness and liveness health checks using HTTP requests on the port <code>8080</code> (default port) and on the
path <code>/health</code>. The defaults are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code> (for HTTP)</p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = <em>none</em> (disabled)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>the previous configuration can also be given use project&#8217;s properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">vertx.health.path = /health</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuring-differently-the-readiness-and-liveness-health-checks">Configuring differently the readiness and liveness health checks</h6>
<div class="paragraph">
<p>You can provide two different configuration for the readiness and liveness checks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
        readiness {
          path = '/ready'
        }
        liveness {
          path = '/health'
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>readiness</code> and <code>liveness</code> chunks in user properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">vertx.health.readiness.path = /ready
vertx.health.liveness.path = /ready</code></pre>
</div>
</div>
<div class="paragraph">
<p>Shared (generic) configuration can be set outside of the specific configuration. For instance, to use the port 8081:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
          port = '8081'
          readiness {
              path = '/ready'
          }
          liveness {
              path = '/health'
          }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">vertx.health.port = 8081
vertx.health.readiness.path = /ready
vertx.health.liveness.path = /ready</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuration-structure">Configuration Structure</h6>
<div class="paragraph">
<p>The configuration is structured as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
          // Generic configuration, applied to both liveness and readiness
          path = '/both'
          readiness = [
              // Specific configuration for the liveness probe
              'port-name': 'ping'
          ]
          liveness = [
              // Specific configuration for the readiness probe
              'port-name': 'ready'
          ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same structure is used in project&#8217;s properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># Generic configuration given as vertx.health.$attribute
vertx.health.path = /both
# Specific liveness configuration given as vertx.health.liveness.$attribute
vertx.health.liveness.port-name = ping
# Specific readiness configuration given as vertx.health.readiness.$attribute
vertx.health.readiness.port-name = ready</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Important</strong>: Project&#8217;s plugin configuration override the project&#8217;s properties.
The overriding rules are:
<em>specific configuration</em> &gt; <em>specific properties</em> &gt; <em>generic configuration</em> &gt; <em>generic properties</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="probe-configuration-3">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspects of the probes. These attributes can be configured for both the readiness and
liveness probes or be specific to one.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. Vert.x HealthCheck Enricher probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The probe type among <code>http</code> (default), <code>tcp</code> and <code>exec</code>.</p>
<p class="tableblock"> Defaults to <code>http</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.type</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>initial-delay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after the container has started before probes are initiated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.initial-delay</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.initial-delay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>period</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often (in seconds) to perform the probe.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.period</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.period</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>timeout</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after which the probe times out.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.timeout</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.timeout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>success-threshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive successes for the probe to be considered successful after having failed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.success-threshold</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.success-threshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failure-threshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive failures for the probe to be considered failed after having succeeded.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.failure-threshold</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.failure-threshold</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>More details about probes are available on <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" class="bare">https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="http-specific-probe-configuration">HTTP specific probe configuration</h6>
<div class="paragraph">
<p>When using HTTP <code>GET</code> requests to determine readiness or liveness, several aspects can be configured. HTTP probes are used by default. To be more specific set the <code>type</code> attribute to <code>http</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. Vert.x HealthCheck Enricher HTTP probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheme</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p>
<p class="tableblock">  Defaults to <code>HTTP</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.scheme</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.scheme</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>path</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the HTTP server. An empty path disable the check.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.path</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.path</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>headers</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom headers to set in the request. HTTP allows repeated headers. It cannot be configured using project&#8217;s properties.
  An example is available below.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.headers</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.headers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container. A 0 or negative number disables the check.</p>
<p class="tableblock">  Defaults to <code>8080</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.port</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port-name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the port to access on the container. If neither the <code>port</code> nor the <code>port-name</code> is set, the check is disabled.
  If both are set the configuration is considered invalid.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.port-name</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.port-name</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of HTTP probe configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
         liveness {
           port = '8081'
           path = '/ping'
           scheme = 'HTTPS'
           headers = [
             'X-Custom-Header': 'Awesome'
           ]
         }
         readiness {
             port = '-1'
         }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="tcp-specific-probe-configuration">TCP specific probe configuration</h6>
<div class="paragraph">
<p>You can also configure the probes to just open a socket on a specific port. The <code>type</code> attribute must be set to <code>tcp</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. Vert.x HealthCheck Enricher TCP probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container. A 0 or negative number disables the check.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.port</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the port to access on the container. If neither the <code>port</code> nor the <code>port-name</code> is set, the check is disabled.
  If both are set the configuration is considered invalid.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx.health.port-name</code></p>
<p class="tableblock">  <code>jkube.enricher.jkube-healthcheck-vertx.port-name</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
         liveness {
           type = 'tcp'
           port = '8081'
         }
         readiness {
           // Use HTTP Get probe
           path = '/ping'
           port = '8080'
         }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="exec-probe-configuration">Exec probe configuration</h6>
<div class="paragraph">
<p>You can also configure the probes to execute a command. If the command succeeds, it returns 0, and Kubernetes consider the pod to be alive and healthy. If the command returns a non-zero value, Kubernetes kills the pod and restarts it. To use a command, you must set the <code>type</code> attribute to <code>exec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  enricher {
    config {
      'jkube-healthcheck-vertx' {
         liveness {
             type = 'exec'
             command = [
               'cmd': ['cat', '/tmp/healthy']
             ]
         }
         readiness {
             // Use HTTP Get probe
             path = '/ping'
             port = '8080'
         }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the snippet above the command is passed using the <code>command</code> attribute. This attribute cannot be
configured using project&#8217;s properties. An empty command disables the check.</p>
</div>
</div>
<div class="sect5">
<h6 id="disabling-health-checks">Disabling health checks</h6>
<div class="paragraph">
<p>You can disable the checks by setting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>port</code> to 0 or to a negative number for <code>http</code> and <code>tcp</code> probes</p>
</li>
<li>
<p>the <code>command</code> to an empty list for <code>exec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first case, you can use project&#8217;s properties to disable them:</p>
</div>
<div class="listingblock">
<div class="title">Disables <code>tcp</code> and <code>http</code> probes</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">vertx.health.port = -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>http</code> probes, an empty or not set <code>path</code> also disable the probe.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-smallrye">jkube-healthcheck-smallrye</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness and startup probes for projects which have <code>io.smallrye:smallrye-health</code> dependency added for Health management. Note that Kubernetes startup probes are only added in projects using MicroProfile 3.1 and later.</p>
</div>
<div class="sect5">
<h6 id="probe-configuration-4">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspects of the probes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. SmallRye HealthCheck Enricher probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheme</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p>
<p class="tableblock">  Defaults to <code>HTTP</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.scheme</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container.</p>
<p class="tableblock">  Defaults to <code>9080</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.livenessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.livenessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.livenessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">  Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.livenessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.livenessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.livenessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.livenessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.livenessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/live</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.livenessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.readinessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.readinessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.readinessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.readinessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.readinessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.readinessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.readinessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.readinessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/ready</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.readinessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.startupProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.startupFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.startupProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.startupSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.startupProbe</code>. Number of seconds after the container has started before liveness or startup probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.startupInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.startupProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.startupPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/started</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-smallrye.startupPath</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-helidon">jkube-healthcheck-helidon</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness and startup probes for Helidon based projects. Note that Kubernetes startup probes are only added in projects using MicroProfile 3.1 and later.</p>
</div>
<div class="paragraph">
<p>The application should be configured as follows to enable the enricher (i.e. <code>io.helidon.health:helidon-health</code> dependency is found in project dependencies)</p>
</div>
<div class="sect5">
<h6 id="probe-configuration-5">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspects of the probes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. Helidon HealthCheck Enricher probe configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 62.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheme</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p>
<p class="tableblock">  Defaults to <code>HTTP</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.scheme</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port number to access the container.</p>
<p class="tableblock">  Defaults to <code>8080</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.port</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.livenessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.livenessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.livenessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">  Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.livenessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.livenessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.livenessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.livenessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.livenessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>livenessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/live</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.livenessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.readinessProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.readinessFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.readinessProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.readinessSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.readinessProbe</code>. Number of seconds after the container has started before liveness or readiness probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.readinessInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.readinessProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.readinessPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>readinessPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/ready</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.readinessPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupFailureThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>failureThreshold</code> field in <code>.startupProbe</code> . Minimum consecutive failures for the probes to be considered failed after having succeeded.</p>
<p class="tableblock">Defaults to <code>3</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.startupFailureThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupSuccessThreshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>successThreshold</code> field in <code>.startupProbe</code>. Minimum consecutive successes for the probes to be considered successful after having failed.</p>
<p class="tableblock">Defaults to <code>1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.startupSuccessThreshold</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupInitialDelay</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>initialDelaySeconds</code> field in <code>.startupProbe</code>. Number of seconds after the container has started before liveness or startup probes are initiated.</p>
<p class="tableblock">Defaults to <code>0</code> seconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.startupInitialDelay</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPeriodSeconds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <code>periodSeconds</code> field in <code>.startupProbe</code>. How often (in seconds) to perform the liveness probe.</p>
<p class="tableblock">Defaults to <code>10</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.startupPeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startupPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the application server.</p>
<p class="tableblock">Defaults to <code>/health/started</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.enricher.jkube-healthcheck-helidon.startupPath</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enricher-api">7.2. Enricher API</h3>
<div class="paragraph">
<p><em>How to write your own enrichers and install them.</em></p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to extend Eclipse JKube&#8217;s Enricher API to define your own custom Enrichers as per use case. Please refer to the <a href="https://github.com/eclipse/jkube/blob/master/jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/Enricher.java">Enricher</a>
Interface; You can create new enrichers by implementing this interface.</p>
</div>
<div class="paragraph">
<p>Please check out <a href="https://github.com/eclipse/jkube/blob/master/quickstarts/kit/custom-istio-enricher-gradle/istio-enricher/">Custom Istio Enricher Gradle</a> quickstart for detailed example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profiles">8. Profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Profiles can be used to combine a set of enrichers and generators and to give this combination a referable name.</p>
</div>
<div class="paragraph">
<p>Profiles are defined in YAML. The following example shows a simple profile which uses only the
<a href="#generator-spring-boot">Spring Boot generator</a> and a few enrichers to add a Kubernetes
Deployment and a Service:</p>
</div>
<div class="listingblock">
<div class="title">Profile Definition</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- name: my-spring-boot-apps <i class="conum" data-value="1"></i><b>(1)</b>
  generator: <i class="conum" data-value="2"></i><b>(2)</b>
    includes:
      - spring-boot
  enricher: <i class="conum" data-value="3"></i><b>(3)</b>
    includes: <i class="conum" data-value="4"></i><b>(4)</b>
      # Default Deployment object
      - jkube-controller
      # Add a default service
      - jkube-service
    excludes: <i class="conum" data-value="5"></i><b>(5)</b>
      - jkube-icon
    config: <i class="conum" data-value="6"></i><b>(6)</b>
      jkube-service:
        # Expose service as NodePort
        type: NodePort
  order: 10 <i class="conum" data-value="7"></i><b>(7)</b>
- name: another-profile
# ....</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Profile&#8217;s name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#generators">Generators</a> to use</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#enrichers">Enrichers</a> to use</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>List of enrichers to <strong>include</strong> in that given order</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>List of enrichers to <strong>exclude</strong> (especially useful when extending profiles)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Configuration for services an enrichers</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>An order which influences the way how profiles with the same name are merged</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <code>profiles.yml</code> has a list of profiles which are defined with these elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. Profile elements</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>extends</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This plugin comes with a set of <a href="#profiles-predefined">predefined profiles</a>.
  These profiles can be extended by defining a custom profile that references the name of the
  profile to extend in the <code>extends</code> field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>generator</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generator definitions. See <a href="#generator-enricher-definition">below</a> for the format of these definitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>enricher</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of enrichers definitions. See <a href="#generator-enricher-definition">below</a> for the format of these definitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>order</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order of the profile which is used when profiles of the same name are merged.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="generator-enricher-definition">8.1. Generator and Enricher definitions</h3>
<div class="paragraph">
<p>The definition of generators and enrichers in the profile follows the same format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. Generator and Enricher definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>includes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generators or enrichers to include. The order in the list determines the order in which the processors are applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>excludes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generators or enrichers. These have precedences over <em>includes</em> and will exclude a processor even when referenced in an <em>includes</em> sections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>config</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for generators or enrichers. This is a map where the keys are the name of the processor to configure and the value is again a map with configuration keys and values specific to the processor. See the documentation of the respective generator or enricher for the available configuration keys.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="profiles-lookup-order">8.2. Lookup order</h3>
<div class="paragraph">
<p>Profiles can be defined externally either directly as a build resource in <code>src/main/jkube/profiles.yml</code> or provided as part of a plugin&#8217;s dependency where it is supposed to be included as <code>META-INF/jkube/profiles.yml</code>. Multiple profiles can be included in these <code>profiles.yml</code> descriptors as a list:</p>
</div>
<div class="paragraph">
<p>If a profile is <a href="#profiles-using">used</a> then it is looked up from various places in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the compile and plugin classpath from <code>META-INF/jkube/profiles-default.yml</code>. These files are reserved for profiles defined by this plugin</p>
</li>
<li>
<p>From the compile and plugin classpath from <code>META-INF/jkube/profiles.yml</code>. Use this location for defining your custom profiles which you want to include via dependencies.</p>
</li>
<li>
<p>From the project in <code>src/main/jkube/profiles.yml</code>. The directory can be tuned with the plugin option <code>resourceDir</code> (property: <code>jkube.resourceDir</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When multiple profiles of the same name are found, then these profiles are merged.
If the profiles have an order number, then the profile with <em>higher</em> order takes precedence
when merging.</p>
</div>
<div class="paragraph">
<p>For <em>includes</em> of the same processors, the processor is moved to the earliest position.
e.g. consider the following two profiles with the name <code>my-profile</code></p>
</div>
<div class="listingblock">
<div class="title">Profile A</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">name: my-profile
enricher:
  includes: [ e1, e2 ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Profile B</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">name: my-profile
enricher:
  includes: [ e3, e1 ]
order: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>then when merged results in the following profile (when no order is given, it defaults to 0):</p>
</div>
<div class="listingblock">
<div class="title">Profile merged</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">name: my-profile
enricher:
  includes: [ e1, e2, e3 ]
order: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Profile with the same order number are merged according to the lookup order described above, where the latter profile is supposed to have a higher order.</p>
</div>
<div class="paragraph">
<p>The configuration for enrichers and generators are merged, too, where higher order profiles override configuration values with the same key of lower order profile configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="profiles-using">8.3. Using Profiles</h3>
<div class="paragraph">
<p>Profiles can be selected by defining them in the plugin configuration, by giving a system property or by using
<a href="#profiles-resource-fragments">special directories</a> in the directory holding the resource fragments.</p>
</div>
<div class="paragraph">
<div class="title">Profile used in plugin configuration</div>
<p>Here is an example how the profile can be used in a plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
  profile = 'my-spring-boot-apps' // (1)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name which selects the profile from the <code>profiles.yml</code> or <code>profiles-default.yml</code> file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Profile as property</div>
<p>Alternatively a profile can be also specified on the command line or as a project property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle -Pjkube.profile=my-spring-boot-apps k8sBuild k8sApply</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration for enrichers and generators is provided as part of the project plugin&#8217;s configuration then this takes precedence and overrides any of the defaults provided by the selected profile.</p>
</div>
<div id="profiles-resource-fragments" class="paragraph">
<div class="title">Profiles for resource fragments</div>
<p>Profiles are also very useful when used together with resource fragments in <code>src/main/jkube</code>.
By default, the resource objects defined here are enriched with the configured profile (if any).
A different profile can be selected easily by using a subdirectory within <code>src/main/jkube</code>.
The name of each subdirectory is interpreted as a profile name and all resource definition files found in this subdirectory are enhanced with the enhancers defined in this profile.</p>
</div>
<div class="paragraph">
<p>For example, consider the following directory layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>.
├── src/main/jkube
  ├── app-rc.yml
  ├── app-svc.yml
  └── raw
    ├── couchbase-rc.yml
    └── couchbase-svc.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the resource descriptors <code>app-rc.yml</code> and <code>app-svc.yml</code> are enhanced with the enrichers defined in the main configuration.
The two  files <code>couchbase-rc.yml</code> and <code>couchbase-svc.yml</code> in the subdirectory <code>raw/</code> are enriched with the profile <strong>raw</strong> instead.
This is a predefined profile which includes no enricher at all, so the couchbase resource objects are not enriched and taken over literally.
This is an easy way how you can fine tune enrichment for different object set.</p>
</div>
</div>
<div class="sect2">
<h3 id="profiles-predefined">8.4. Predefined Profiles</h3>
<div class="paragraph">
<p>This plugin comes with the following predefined profiles:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. Predefined Profiles</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Profile</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>default</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default profile which is active if no profile is specified. It consists of a curated set of generator and enrichers. See <a href="#profiles-default">below</a> for the current definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>minimal</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This profile contains no generators and only enrichers for adding default objects (controller and services). No other enrichment is included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>explicit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like default but without adding default objects like controllers and services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>aggregate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes no generators and only the <a href="#jkube-dependency">jkube-dependency</a> enricher for picking up and combining resources from the compile time dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>internal-microservice</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>default</em> profile extension that prevents services from being externally exposed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>security-hardening</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>default</em> profile extension that enables the <a href="#jkube-security-hardening">security-hardening</a>
  enricher.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="profiles-extended">8.5. Extending Profiles</h3>
<div class="paragraph">
<p>A profile can also extend another profile to avoid repetition.
This is useful to add optional enrichers/generators to a given profile or to partially exclude enrichers/generators from another.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- name: security-hardening
  extends: default
  enricher:
    includes:
      - jkube-security-hardening</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, this profiles includes the optional <code>jkube-security-hardening</code> enricher to the default profile.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jkube-plugin">9. JKube Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin supports so call <strong>jkube-plugins</strong> which have entry points that can be bound to the different JKube operation phases.
jkube-plugins are enabled by just declaring a dependency in the plugin declaration:</p>
</div>
<div class="paragraph">
<p>The following example is from <a href="https://github.com/eclipse/jkube/tree/master/quickstarts/gradle/plugin">quickstarts/gradle/plugin</a></p>
</div>
<div class="paragraph">
<p>JKube Plugin is defined under Gradle&#8217;s <code>buildSrc</code> directory which is automatically added to build script classpath by Gradle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>.
├── app
├── buildSrc
  ├── build.gradle
  └── src
      └── main
          ├── java
          │ └── org
          │     └── eclipse
          │         └── jkube
          │             └── quickstart
          │                 └── plugin
          │                     └── SimpleJKubePlugin.java
          └── resources
              └── META-INF
                  └── jkube
                      └── plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>JKubePlugins are automatically loaded by JKube by declaring a dependency to a module that contains a descriptor file at
<code>META-INF/jkube/plugin</code> with class names line by line, for example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jkube/plugin</div>
<div class="content">
<pre class="highlight"><code>org.eclipse.jkube.quickstart.plugin.SimpleJKubePlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the moment descriptor files are looked up in these locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/maven/io.fabric8/dmp-plugin</code> (Deprecated, kept for backward compatibility)</p>
</li>
<li>
<p><code>META-INF/jkube/plugin</code></p>
</li>
<li>
<p><code>META-INF/jkube-plugin</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>During a build with <code>k8sBuild</code>, those classes are loaded and certain fixed method are called.</p>
</div>
<div class="paragraph">
<p>JKube plugin would need to implement <code>org.eclipse.jkube.api.JKubePlugin</code> interface. At the moment, The following methods are supported:</p>
</div>
<table id="build-plugin-methods" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>addExtraFiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A method called by kubernetes-gradle-plugin with a single <code>File</code> argument. This will point to a directory <code>jkube-extra</code> which can be referenced easily by a Dockerfile or an assembly. A kubernetes-gradle-plugin plugin typically will create an own subdirectory to avoid a clash with other jkube-plugins.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Check out <a href="https://github.com/eclipse/jkube/tree/master/quickstarts/gradle/plugin"><code>quickstarts/gradle/plugin</code></a> for a fully working example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry">10. Registry handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker uses registries to store images. The registry is typically
specified as part of the name. I.e. if the first part (everything
before the first <code>/</code>) contains a dot (<code>.</code>) or colon (<code>:</code>) this part is
interpreted as an address (with an optionally port) of a remote
registry. This registry (or the default <code>docker.io</code> if no
registry is given) is used during push and pull operations. This
plugin follows the same semantics, so if an image name is specified
with a registry part, this registry is contacted. Authentication is
explained in the next <a href="#authentication">section</a>.</p>
</div>
<div class="paragraph">
<p>There are some situations however where you want to have more
flexibility for specifying a remote registry. This might be because
you do not want to hard code a registry into <code>build.gradle</code> but
provide it from the outside with an environment variable or a system
property.</p>
</div>
<div class="paragraph">
<p>This plugin supports various ways of specifying a registry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the image name contains a registry part, this registry is used
unconditionally and can not be overwritten from the outside.</p>
</li>
<li>
<p>If an image name doesn&#8217;t contain a registry, then by default the
default Docker registry <code>docker.io</code> is used for push and pull
operations. But this can be overwritten through various means:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>image</code> configuration contains a <code>registry</code> subelement
this registry is used.</p>
</li>
<li>
<p>Otherwise, a global configuration element <code>registry</code> is
evaluated which can be also provided as system property via
<code>-Djkube.docker.registry</code>.</p>
</li>
<li>
<p>Finally an environment variable <code>DOCKER_REGISTRY</code> is looked up for
detecting a registry.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This registry is used for pulling (i.e. for autopull the base image
when doing a <code>k8sBuild</code>) and pushing with <code>k8sPush</code>. However,
when these two tasks are combined on the command line like in <code>mvn
-Djkube.docker.registry=myregistry:5000 package k8sBuild k8sPush</code>
the same registry is used for both operation. For a more fine grained
control, separate registries for <em>pull</em> and <em>push</em> can be specified.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the plugin&#8217;s configuration with the parameters <code>pullRegistry</code> and
<code>pushRegistry</code>, respectively.</p>
</li>
<li>
<p>With the system properties <code>jkube.docker.pull.registry</code> and
<code>jkube.docker.push.registry</code>, respectively.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    registry = "docker.jolokia.org:443"
    images {
        image1 {
            // Without an explicit registry
            name = "jolokia/jolokia-java"
            // Hence use this registry
            registry = "docker.ro14nd.de"
        }
        image2 {
            name ="postgresql"
            // No registry in the name, hence use this globally
            // configured docker.jolokia.org:443 as registry
        }
        image3 {
            // Explicitly specified always wins
            name = "docker.example.com:5000/another/server"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is some special behaviour when using an externally provided
registry like described above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When <em>pulling</em>, the image pulled will be also tagged with a repository
name <strong>without</strong> registry. The reasoning behind this is that this
image then can be referenced also by the configuration when the
registry is not specified anymore explicitly.</p>
</li>
<li>
<p>When <em>pushing</em> a local image, temporarily a tag including the
registry is added and removed after the push. This is required
because Docker can only push registry-named images.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication">11. Registry Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When pulling (via the <code>autoPull</code> mode of <code>k8sBuild</code>) or pushing image, it
might be necessary to authenticate against a Docker registry.</p>
</div>
<div class="paragraph">
<p>There are five different locations searched for credentials.  In order, these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Providing system properties <code>jkube.docker.username</code> and <code>jkube.docker.password</code> from the outside.</p>
</li>
<li>
<p>Using a <code>authConfig</code> section in the plugin configuration with <code>username</code> and <code>password</code> elements.</p>
</li>
<li>
<p>Using OpenShift configuration in <code>~/.config/kube</code></p>
</li>
<li>
<p>Login into a registry with <code>docker login</code> (credentials in a credential helper or in <code>~/.docker/config.json</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the username and password directly in the <code>build.gradle</code> is not
recommended since this is widely visible. This is the easiest and
transparent way, though. Using an <code>authConfig</code> is straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = "consol/tomcat-7.0"
        }
    }
    authConfig {
        username = "jolokia"
        password = "s!cr!t"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The system property provided credentials are a good compromise when
using CI servers like Jenkins. You simply provide the credentials from
the outside:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gradle -Djkube.docker.username=jolokia -Djkube.docker.password=s!cr!t k8sPush</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most <em>secure</em> way is to rely on docker&#8217;s credential store or credential helper and read confidential information
from an external credentials store, such as the native keychain of the operating system. Follow the instruction on
<a href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">the docker login documentation</a>.</p>
</div>
<div class="paragraph">
<p>As a final fallback, this plugin consults <code>$DOCKER_CONFIG/config.json</code> if <code>DOCKER_CONFIG</code> is set, or <code>~/.docker/config.json</code> if not, and reads credentials stored directly within this
file. This unsafe behavior happened when connecting to a registry with the command <code>docker login</code> from the command line
with older versions of docker (pre 1.13.0) or when docker is not configured to use a
<a href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">credential store</a>.</p>
</div>
<div class="sect2">
<h3 id="pull-vs-push-authentication">11.1. Pull vs. Push Authentication</h3>
<div class="paragraph">
<p>The credentials lookup described above is valid for both push and
pull operations. In order to narrow things down, credentials can be
provided for pull or push operations alone:</p>
</div>
<div class="paragraph">
<p>In an <code>authConfig</code> section a sub-section <code>pull</code> and/or <code>push</code>
can be added. In the example below the credentials provider are only
used for image push operations:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    images {
        image {
            name = "consol/tomcat-7.0"
        }
    }
    authConfig {
        push {
            username = "jolokia"
            password = "secret"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the credentials are given on the command line as system
properties, then the properties <code>jkube.docker.pull.username</code> /
<code>jkube.docker.pull.password</code> and <code>jkube.docker.push.username</code> /
<code>jkube.docker.push.password</code> are used for pull and push operations,
respectively (when given). Either way, the standard lookup algorithm
as described in the previous section is used as fallback.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kind-filename-mapping">12. Kind/Filename Mapping</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="default-kind-filename-mapping">12.1. Default Kind/Filename Mapping</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kind</th>
<th class="tableblock halign-left valign-top">Filename Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BuildConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc</code>, <code>buildconfig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterRole</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cr</code>, <code>crole</code>, <code>clusterrole</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConfigMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cm</code>, <code>configmap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterRoleBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>crb</code>, <code>clusterrb</code>, <code>clusterrolebinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CronJob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cj</code>, <code>cronjob</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CustomResourceDefinition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>crd</code>, <code>customerresourcedefinition</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DaemonSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ds</code>, <code>daemonset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DeploymentConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dc</code>, <code>deploymentconfig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImageStream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is</code>, <code>imagestream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImageStreamTag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>istag</code>, <code>imagestreamtag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ingress</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>job</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LimitRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lr</code>, <code>limitrange</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ns</code>, <code>namespace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>np</code>, <code>networkpolicy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuthClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oauthclient</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PolicyBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pb</code>, <code>policybinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pv</code>, <code>persistentvolume</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pvc</code>, <code>persistentvolumeclaim</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProjectRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pr</code>, <code>projectrequest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicaSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rs</code>, <code>replicaset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicationController</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rc</code>, <code>replicationcontroller</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResourceQuota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rq</code>, <code>resourcequota</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rb</code>, <code>rolebinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleBindingRestriction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rbr</code>, <code>rolebindingrestriction</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>route</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>svc</code>, <code>service</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServiceAccount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sa</code>, <code>serviceaccount</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StatefulSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statefulset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>template</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pd</code>, <code>pod</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="custom-kind-mapping">12.2. Custom Kind/Filename Mapping</h3>
<div class="paragraph">
<p>You can add your custom <code>Kind/Filename</code> mappings.
To do it you have two approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting an environment variable or system property called <code>jkube.mapping</code> pointing out to a <code>.properties</code> files with pairs <code>&lt;kind&gt;&#8658;&lt;filename1&gt;, &lt;filename2&gt;</code>
By default if no environment variable nor system property is set, JKube looks for a file located at classpath <code>/META-INF/jkube.kind-filename-type-mapping-default.properties</code>.</p>
</li>
<li>
<p>By defining the Mapping in the plugin&#8217;s configuration</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">kubernetes {
    mappings {
        mapping {
            kind = "Var" <i class="conum" data-value="1"></i><b>(1)</b>
            filenameTypes = "foo, bar" <i class="conum" data-value="2"></i><b>(2)</b>
            apiVersion = "api.example.com/v1" <i class="conum" data-value="3"></i><b>(3)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The kind name (mandatory)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The filename types (mandatory), a comma-separated list of filenames to map to the specified kind</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The apiVersion (optional)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.14-SNAPSHOT<br>
Last updated 2023-07-20 23:23:34 +0530
</div>
</div>
</body>
</html>