<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Roland Huß, James Strachan">
<title>org.eclipse.jkube/kubernetes-maven-plugin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>org.eclipse.jkube/kubernetes-maven-plugin</h1>
<div class="details">
<span id="author" class="author">Roland Huß, James Strachan</span><br>
<span id="revnumber">version 0.1.0,</span>
<span id="revdate">2019-12-23</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">kubernetes-maven-plugin</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#building-images">1.1. Building Images</a></li>
<li><a href="#resource-descriptors">1.2. Kubernetes Resources</a></li>
<li><a href="#configuration">1.3. Configuration</a></li>
<li><a href="#examples">1.4. Examples</a>
<ul class="sectlevel3">
<li><a href="#zero-config">1.4.1. Zero-Config</a></li>
<li><a href="#xml-configuration">1.4.2. XML Configuration</a></li>
<li><a href="#resource-fragments">1.4.3. Resource Fragments</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compatibility-with-Kubernetes">2. Compatibility with Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#kubernetes-compatibility">2.1. Kubernetes Compatibility</a></li>
</ul>
</li>
<li><a href="#installation">3. Installation</a></li>
<li><a href="#goals">4. Goals Overview</a></li>
<li><a href="#goals-overview-build">5. Build Goals</a>
<ul class="sectlevel2">
<li><a href="#k8s:resource">5.1. <strong>k8s:resource</strong></a>
<ul class="sectlevel3">
<li><a href="#resource-labels-annotations">5.1.1. Labels and Annotations</a></li>
<li><a href="#resource-secrets">5.1.2. Secrets</a></li>
<li><a href="#resource-validation">5.1.3. Resource Validation</a></li>
<li><a href="#resource-route-generation">5.1.4. Route Generation</a></li>
<li><a href="#Other-flags">5.1.5. Other flags</a></li>
</ul>
</li>
<li><a href="#k8s:build">5.2. <strong>k8s:build</strong></a>
<ul class="sectlevel3">
<li><a href="#build-kubernetes">5.2.1. Kubernetes Build</a></li>
<li><a href="#build-openshift">5.2.2. OpenShift Build</a></li>
<li><a href="#build-goal-configuration">5.2.3. Configuration</a></li>
<li><a href="#kubernetes-access-configuration">5.2.4. Kubernetes Access Configuration</a></li>
<li><a href="#image-configuration">5.2.5. Image Configuration</a></li>
<li><a href="#build-configuration">5.2.6. Build Configuration</a></li>
<li><a href="#build-assembly">5.2.7. Assembly</a></li>
<li><a href="#misc-env">5.2.8. Environment and Labels</a></li>
<li><a href="#misc-startup">5.2.9. Startup Arguments</a></li>
<li><a href="#build-buildargs">5.2.10. Build Args</a></li>
</ul>
</li>
<li><a href="#k8s:push">5.3. <strong>k8s:push</strong></a></li>
<li><a href="#k8s:apply">5.4. <strong>k8s:apply</strong></a></li>
<li><a href="#k8s:helm">5.5. <strong>k8s:helm</strong></a></li>
</ul>
</li>
<li><a href="#goals-overview-develop">6. Development Goals</a>
<ul class="sectlevel2">
<li><a href="#k8s:deploy">6.1. <strong>k8s:deploy</strong></a></li>
<li><a href="#k8s:undeploy">6.2. <strong>k8s:undeploy</strong></a></li>
<li><a href="#k8s:log">6.3. <strong>k8s:log</strong></a></li>
<li><a href="#k8s:debug">6.4. <strong>k8s:debug</strong></a>
<ul class="sectlevel3">
<li><a href="#speeding-up-debugging">6.4.1. Speeding up debugging</a></li>
<li><a href="#debugging-with-suspension">6.4.2. Debugging with suspension</a></li>
</ul>
</li>
<li><a href="#k8s:watch">6.5. <strong>k8s:watch</strong></a>
<ul class="sectlevel3">
<li><a href="#watcher-spring-boot">6.5.1. Spring Boot</a></li>
<li><a href="#watcher-docker-image">6.5.2. Docker Image</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#generators">7. Generators</a>
<ul class="sectlevel2">
<li><a href="#generators-default">7.1. Default Generators</a>
<ul class="sectlevel3">
<li><a href="#generator-java-exec">7.1.1. Java Applications</a></li>
<li><a href="#generator-spring-boot">7.1.2. Spring Boot</a></li>
<li><a href="#generator-wildfly-swarm">7.1.3. Wildfly Swarm</a></li>
<li><a href="#generator-thorntail-v2">7.1.4. Thorntail v2</a></li>
<li><a href="#generator-vertx">7.1.5. Vert.x</a></li>
<li><a href="#generator-karaf">7.1.6. Karaf</a></li>
<li><a href="#generator-webapp">7.1.7. Web Applications</a></li>
<li><a href="#generator-quarkus">7.1.8. Quarkus</a></li>
</ul>
</li>
<li><a href="#generators-api">7.2. Generator API</a></li>
</ul>
</li>
<li><a href="#enrichers">8. Enrichers</a>
<ul class="sectlevel2">
<li><a href="#enrichers-default">8.1. Default Enrichers</a>
<ul class="sectlevel3">
<li><a href="#enrichers-standard">8.1.1. Standard Enrichers</a></li>
</ul>
</li>
<li><a href="#enricher-api">8.2. Enricher API</a></li>
</ul>
</li>
<li><a href="#profiles">9. Profiles</a>
<ul class="sectlevel2">
<li><a href="#generator-enricher-definition">9.1. Generator and Enricher definitions</a></li>
<li><a href="#profiles-lookup-order">9.2. Lookup order</a></li>
<li><a href="#profiles-using">9.3. Using Profiles</a></li>
<li><a href="#profiles-predefined">9.4. Predefined Profiles</a></li>
<li><a href="#profiles-extended">9.5. Extending Profiles</a></li>
</ul>
</li>
<li><a href="#access-configuration">10. Access configuration</a>
<ul class="sectlevel2">
<li><a href="#docker-access">10.1. Docker Access</a></li>
<li><a href="#openshift-and-kubernetes-access">10.2. OpenShift and Kubernetes Access</a></li>
</ul>
</li>
<li><a href="#registry">11. Registry handling</a></li>
<li><a href="#authentication">12. Authentication</a>
<ul class="sectlevel2">
<li><a href="#pull-vs-push-authentication">12.1. Pull vs. Push Authentication</a></li>
<li><a href="#openshift-authentication">12.2. OpenShift Authentication</a></li>
<li><a href="#password-encryption">12.3. Password encryption</a></li>
<li><a href="#extended-authentication">12.4. Extended Authentication</a></li>
</ul>
</li>
<li><a href="#volume-configuration">13. Volume Configuration</a></li>
<li><a href="#faq">14. FAQ</a>
<ul class="sectlevel2">
<li><a href="#general-questions">14.1. General questions</a>
<ul class="sectlevel3">
<li><a href="#how-do-i-define-an-environment-variable">14.1.1. How do I define an environment variable?</a></li>
<li><a href="#how-do-i-define-a-system-property">14.1.2. How do I define a system property?</a></li>
<li><a href="#how-do-i-mount-a-config-file-from-a-configmap">14.1.3. How do I mount a config file from a ConfigMap?</a></li>
<li><a href="#how-do-i-use-a-persistent-volume">14.1.4. How do I use a Persistent Volume?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appendix">15. Appendix</a>
<ul class="sectlevel2">
<li><a href="#kindfilename-type-mapping">15.1. Kind/Filename Type Mapping</a></li>
<li><a href="#custom-kindfilename-mapping">15.2. Custom Kind/Filename Mapping</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2016 The original authors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>kubernetes-maven-plugin</strong> (k8-m-p) brings your Java applications on to <a href="http://kubernetes.io/">Kubernetes</a>.
It provides a tight integration into <a href="http://maven.apache.org">Maven</a> and benefits from the build configuration already provided.
This plugin focus on two tasks: <em>Building Docker images</em> and <em>creating Kubernetes resource descriptors</em>.
It can be configured very flexibly and supports multiple configuration models for creating: A <em>Zero-Config</em> setup allows for a quick ramp-up with some opinionated defaults.
For more advanced requirements, an <em>XML configuration</em> provides additional configuration options which can be added to the <code>pom.xml</code>.
For the full power, in order to tune all facets of the creation, external <em>resource fragments</em> and <em>Dockerfiles</em> can be used.</p>
</div>
<div class="sect2">
<h3 id="building-images">1.1. Building Images</h3>
<div class="paragraph">
<p>The <a href="#k8s:build"><strong>k8s:build</strong></a> goal is for creating Docker images containing the actual application. These then can be deployed later on Kubernetes or OpenShift.
It is easy to include build artifacts and their dependencies into these images.
This plugin uses the assembly descriptor format from the <a href="http://maven.apache.org/plugins/maven-assembly-plugin/">maven-assembly-plugin</a> to specify the content which will be added to the image.
That images can then be pushed to public or private Docker registries with <a href="#k8s:push"><strong>k8s:push</strong></a>.</p>
</div>
<div class="paragraph">
<p>Depending on the operational mode, for building the actual image either a Docker daemon is used directly or an <a href="https://docs.openshift.com/enterprise/3.0/architecture/core_concepts/builds_and_image_streams.html#docker-build">OpenShift Docker Build</a> is performed.</p>
</div>
<div class="paragraph">
<p>A special <a href="#k8s:watch"><strong>k8s:watch</strong></a> goal allows for reacting to code changes to automatically recreate images or copy new artifacts into running containers.</p>
</div>
<div class="paragraph">
<p>These image related features are inherited from the <a href="https://github.com/jkubeio/docker-maven-plugin">jkubeio/docker-maven-plugin</a> which is part of this plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="resource-descriptors">1.2. Kubernetes Resources</h3>
<div class="paragraph">
<p>Kubernetes resource descriptors can be created or generated from <a href="#k8s:resource"><strong>k8s:resource</strong></a>.
These files are packaged within the Maven artifacts and can be deployed to a running orchestration platform with <a href="#k8s:apply"><strong>k8s:apply</strong></a>.</p>
</div>
<div class="paragraph">
<p>Typically you only specify a small part of the real resource descriptors which will be enriched by this plugin with various extra information taken from the <code>pom.xml</code>.
This drastically reduces boilerplate code for common scenarios.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration">1.3. Configuration</h3>
<div class="paragraph">
<p>As mentioned already there are three levels of configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Zero-Config</strong> mode makes some very opinionated decisions based on what is present in the pom.xml like what base image to use or which ports to expose.
This is great for starting up things and for keeping quickstart applications small and tidy.</p>
</li>
<li>
<p><strong>XML plugin configuration</strong> mode is similar to what <a href="https://jkubeio.github.io/docker-maven-plugin/#example">docker-maven-plugin</a> provides.
This allows for type-safe configuration with IDE support, but only a subset of possible resource descriptor features is provided.</p>
</li>
<li>
<p><strong>Kubernetes &amp; OpenShift resource fragments</strong> are user provided YAML files that can be <em>enriched</em> by the plugin. This allows expert users to use a plain configuration file with all their capabilities, but also to add project specific build information and avoid boilerplate code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table gives an overview of the different models</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Models</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Docker Images</th>
<th class="tableblock halign-left valign-top">Resource Descriptors</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zero-Config</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generators">Generators</a> are used to create Docker image configurations. Generators can detect certain aspects of the build (e.g. whether Spring Boot is used) and then choose some default like the base image, which ports to expose and the startup command. They can be configured, but offer only a few options.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default <a href="#enrichers">Enrichers</a> will create a default <em>Service</em> and <em>Deployment</em> (<em>DeploymentConfig</em> for OpenShift) when no other resource objects are provided. Depending on the image they can detect which port to expose in the service. As with Generators, Enrichers support a limited set of configuration options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XML configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube-m-p inherits the XML based configuration for building images from the <a href="https://jkubeio.github.io/docker-maven-plugin/#docker:build">docker-maven-plugin</a> and provides the same functionality. It supports an <a href="http://maven.apache.org/components/plugins/maven-assembly-plugin/assembly.html">assembly descriptor</a> for specifying the content of the Docker image.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A subset of possible resource objects can be configured with a dedicated XML syntax. With a decent IDE you get autocompletion on most object and inline documentation for the available configuration elements. The provided configuration can be still enhanced by Enhancers which is useful for adding e.g. labels and annotations containing build or other information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Fragments</strong> and <strong>Dockerfiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similarly to the docker-maven-plugin, jkube-m-p supports <a href="#external-dockerfile">external Dockerfiles</a> too, which are referenced from the plugin configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource descriptors can be provided as external YAML files which specify a skeleton. This skeleton is then filled by Enrichers which add labels and more. Maven properties within these files are resolved to thier values. With this model you can use every Kubernetes / OpenShift resource object with all their flexibility, but still get the benefit of adding build information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="examples">1.4. Examples</h3>
<div class="paragraph">
<p>Let&#8217;s have a look at some code. The following examples will demonstrate all three configurations variants:</p>
</div>
<div class="sect3">
<h4 id="zero-config">1.4.1. Zero-Config</h4>
<div class="paragraph">
<p>This minimal but full working example <code>pom.xml</code> shows how a simple spring boot application can be dockerized and prepared for Kubernetes. The full example can be found in directory <a href="https://github.com/jkubeio/kubernetes-maven-plugin/tree/master/samples/zero-config">samples/zero-config</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
  <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jkube-maven-sample-zero-config<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;packaging&gt;</span>jar<span class="tag">&lt;/packaging&gt;</span>

  <span class="tag">&lt;parent&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;version&gt;</span>1.5.5.RELEASE<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/parent&gt;</span>

  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>

  <span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;/plugin&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This minimalistic spring boot application uses the spring-boot parent POM for setting up dependencies and plugins</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Spring Boot web starter dependency enables a simple embedded Tomcat for serving Spring MVC apps</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>spring-boot-maven-plugin</code> is responsible for repackaging the application into a fat jar, including all dependencies and the embedded Tomcat</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>kubernetes-maven-plugin</code> enables the automatic generation of a Docker image and Kubernetes / OpenShift descriptors including this Spring application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This setup make some opinionated decisions for you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As base image <a href="https://github.com/jkubeio-images/java/tree/master/images/jboss/openjdk8/jdk">jkube.java-jboss-openjdk8-jdk</a> is chosen which enables <a href="https://www.jolokia.org">Jolokia</a> and <a href="https://github.com/prometheus/jmx_exporter">jmx_exporter</a>. It also comes with a sophisticated <a href="https://github.com/jkubeio-images/run-java-sh">startup script</a>.</p>
</li>
<li>
<p>It will create a Kubernetes <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> and a <a href="http://kubernetes.io/docs/user-guide/services/">Service</a> as resource objects</p>
</li>
<li>
<p>It exports port 8080 as the application service port (and 8778 and 9779 for Jolokia and jmx_exporter access, respectively)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These choices can be influenced by configuration options as decribed in <a href="#generator-spring-boot">Spring Boot Generator</a>.</p>
</div>
<div class="paragraph">
<p>To start the Docker image build, you simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn package k8s:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create the Docker image against a running Docker daemon (which must be accessible either via Unix Socket or with the URL set in <code>DOCKER_HOST</code>). Alternatively, when connected to an OpenShift cluster (or using the <code>openshift</code> <a href="#build-mode">mode</a> explicitly), then a Docker build will be performed on OpenShift which at the end creates an <a href="https://docs.openshift.com/enterprise/3.1/architecture/core_concepts/builds_and_image_streams.html">ImageStream</a>.</p>
</div>
<div class="paragraph">
<p>To deploy the resources to the cluster call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn k8s:resource k8s:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default a <em>Service</em> and a <em>Deployment</em> object pointing to the created Docker image is created. When running in OpenShift mode, a <em>Service</em> and <em>DeploymentConfig</em> which refers the <em>ImageStream</em> created with <code>k8s:build</code> will be installed.</p>
</div>
<div class="paragraph">
<p>Of course you can bind all those jkube.goals to execution phases as well, so that they are called along with standard lifecycle goals like <code>install</code>. For example, to bind the building of the Kubernetes resource files and the Docker images, add the following goals to the execution of the f-m-p:</p>
</div>
<div class="listingblock">
<div class="title">Example for lifecycle bindings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;d also like to automatically deploy to Kubernetes each time you do a <code>mvn install</code> you can add the <code>deploy</code> goal:</p>
</div>
<div class="listingblock">
<div class="title">Example for lifecycle bindings with automatic deploys for mvn install</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>deploy<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xml-configuration">1.4.2. XML Configuration</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
XML based configuration is only partially implemented and is not recommended for use right now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although the Zero-config mode and its generators can be tweaked with options up to a certain degree, many cases require more flexibility. For such instances, an XML-based plugin configuration can be used, in a way similar to the
<a href="https://jkubeio.github.io/docker-maven-plugin/#configuration">XML configuration</a> used by <code>docker-maven-plugin</code>.</p>
</div>
<div class="paragraph">
<p>The plugin configuration can be roughly divided into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global configuration options are responsible for tuning the behaviour of plugin goals</p>
</li>
<li>
<p><code>&lt;images&gt;</code> defines which Docker <a href="#image-configuration">images</a> are used and configured. This section is similar to the <a href="https://jkubeio.github.io/docker-maven-plugin/#image-configuration">image configuration</a> of the <code>docker-maven-plugin</code>, except that <code>&lt;run&gt;</code> and <code>&lt;external&gt;</code> sub-elements are ignored)</p>
</li>
<li>
<p><code>&lt;resource&gt;</code> defines the resource descriptors for deploying on an OpenShift or Kuberneres cluster.</p>
</li>
<li>
<p><code>&lt;generator&gt;</code> configures <a href="#generators">generators</a> which are responsible for creating images. Generators are used as an alternative to a dedicated <code>&lt;images&gt;</code> section.</p>
</li>
<li>
<p><code>&lt;enricher&gt;</code> configures various aspects of <a href="#enrichers">enrichers</a> for creating or enhancing resource descriptors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A working example can be found in the  <a href="https://github.com/jkubeio/kubernetes-maven-plugin/tree/master/samples/xml-config">samples/xml-config</a> directory. An extract of the plugin configuration is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example for an XML configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;namespace&gt;</span>test-ns<span class="tag">&lt;/namespace&gt;</span>
  <span class="tag">&lt;images&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;image&gt;</span>
      <span class="tag">&lt;name&gt;</span>xml-config-demo:1.0.0<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- &quot;alias&quot; is used to correlate to the containers in the pod spec --&gt;</span>
      <span class="tag">&lt;alias&gt;</span>camel-app<span class="tag">&lt;/alias&gt;</span>
      <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;from&gt;</span>jkube.java<span class="tag">&lt;/from&gt;</span>
        <span class="tag">&lt;assembly&gt;</span>
          <span class="tag">&lt;basedir&gt;</span>/deployments<span class="tag">&lt;/basedir&gt;</span>
          <span class="tag">&lt;descriptorRef&gt;</span>artifact-with-dependencies<span class="tag">&lt;/descriptorRef&gt;</span>
        <span class="tag">&lt;/assembly&gt;</span>
        <span class="tag">&lt;env&gt;</span>
          <span class="tag">&lt;JAVA_LIB_DIR&gt;</span>/deployments<span class="tag">&lt;/JAVA_LIB_DIR&gt;</span>
          <span class="tag">&lt;JAVA_MAIN_CLASS&gt;</span>org.apache.camel.cdi.Main<span class="tag">&lt;/JAVA_MAIN_CLASS&gt;</span>
        <span class="tag">&lt;/env&gt;</span>
      <span class="tag">&lt;/build&gt;</span>
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>

  <span class="tag">&lt;resources&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;labels&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;all&gt;</span>
        <span class="tag">&lt;group&gt;</span>quickstarts<span class="tag">&lt;/group&gt;</span>
      <span class="tag">&lt;/all&gt;</span>
    <span class="tag">&lt;/labels&gt;</span>

    <span class="tag">&lt;deployment&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="tag">&lt;name&gt;</span>${project.artifactId}<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;replicas&gt;</span>1<span class="tag">&lt;/replicas&gt;</span>

      <span class="tag">&lt;containers&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="tag">&lt;container&gt;</span>
          <span class="tag">&lt;alias&gt;</span>camel-app<span class="tag">&lt;/alias&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
          <span class="tag">&lt;ports&gt;</span>
            <span class="tag">&lt;port&gt;</span>8778<span class="tag">&lt;/port&gt;</span>
          <span class="tag">&lt;/ports&gt;</span>
          <span class="tag">&lt;mounts&gt;</span>
            <span class="tag">&lt;scratch&gt;</span>/var/scratch<span class="tag">&lt;/scratch&gt;</span>
          <span class="tag">&lt;/mounts&gt;</span>
        <span class="tag">&lt;/container&gt;</span>
      <span class="tag">&lt;/containers&gt;</span>

      <span class="tag">&lt;volumes&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="tag">&lt;volume&gt;</span>
          <span class="tag">&lt;name&gt;</span>scratch<span class="tag">&lt;/name&gt;</span>
          <span class="tag">&lt;type&gt;</span>emptyDir<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/volume&gt;</span>
      <span class="tag">&lt;/volumes&gt;</span>
    <span class="tag">&lt;/deployment&gt;</span>

    <span class="tag">&lt;services&gt;</span> <i class="conum" data-value="8"></i><b>(8)</b>
      <span class="tag">&lt;service&gt;</span>
        <span class="tag">&lt;name&gt;</span>camel-service<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;headless&gt;</span>true<span class="tag">&lt;/headless&gt;</span>
      <span class="tag">&lt;/service&gt;</span>
    <span class="tag">&lt;/services&gt;</span>

    <span class="tag">&lt;serviceAccounts&gt;</span>
      <span class="tag">&lt;serviceAccount&gt;</span>
        <span class="tag">&lt;name&gt;</span>build-robot<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;/serviceAccount&gt;</span>
    <span class="tag">&lt;/serviceAccounts&gt;</span>
  <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Standard docker-maven-plugin configuration for building one single Docker image</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kubernetes / OpenShift resources to create</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Labels which should be applied globally to all resource objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Definition of a <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> to create</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Containers to include in the deployment</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An <em>alias</em> is used to correlate a container&#8217;s image with the image definition in the <code>&lt;images&gt;</code> section where each image carry an alias. Can be omitted if only a single image is used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><a href="http://kubernetes.io/docs/user-guide/volumes/">Volume</a> definitions used in a Deployment&#8217;s <em>ReplicaSet</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>One or more <a href="http://kubernetes.io/docs/user-guide/services/">Service</a> definitions.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The XML resource configuration is based on plain Kubernetes resource objects. When targeting OpenShift, Kubernetes resource descriptors will be automatically converted to their OpenShift counterparts, e.g. a Kubernetes <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> will be converted to an OpenShift <a href="https://docs.openshift.org/latest/architecture/core_concepts/deployments.html#deployments-and-deployment-configurations">DeploymentConfig</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resource-fragments">1.4.3. Resource Fragments</h4>
<div class="paragraph">
<p>The third configuration option is to use an external configuration in form of YAML resource descriptors which are located in the  <code>src/main/jkube</code> directory. Each resource get its own file, which contains a skeleton of a resource descriptor. The plugin will pick up the resource, enrich it and then combine all to a single <code>kubernetes.yml</code> and <code>openshift.yml</code> file. Within these descriptor files you are can freely use any Kubernetes feature.</p>
</div>
<div class="paragraph">
<p>Note: In order to support simultaneously both OpenShift and Kubernetes, there is currently no way to specify OpenShift-only features this way, though this might change in future releases.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at an example from <a href="https://github.com/rhuss/kubernetes-maven-plugin/tree/master/samples/external-resources">samples/external-resources</a>. This is a plain Spring Boot application, whose images are auto generated like in the <a href="#zero-config">Zero-Config</a> case. The resource fragments are in <code>src/main/jkube</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment "deployment.yml"</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">spec</span>:
      <span class="key">volumes</span>:
        - <span class="string"><span class="content">name: config</span></span>
          <span class="key">gitRepo</span>:
            <span class="key">repository</span>: <span class="string"><span class="content">'https://github.com/jstrachan/sample-springboot-config.git'</span></span>
            <span class="key">revision</span>: <span class="string"><span class="content">667ee4db6bc842b127825351e5c9bae5a4fb2147</span></span>
            <span class="key">directory</span>: <span class="string"><span class="content">.</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">volumeMounts:</span><span class="content">
            - name: config
              mountPath: /app/config</span></span>
          <span class="key">env</span>:
            - <span class="string"><span class="content">name: KUBERNETES_NAMESPACE</span></span>
              <span class="key">valueFrom</span>:
                <span class="key">fieldRef</span>:
                  <span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
                  <span class="key">fieldPath</span>: <span class="string"><span class="content">metadata.namespace</span></span>
      <span class="key">serviceAccount</span>: <span class="string"><span class="content">ribbon</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there is no <code>metadata</code> section as would be expected for Kubernetes resources because it will be automatically added by the <code>kubernetes-maven-plugin</code>. The object&#8217;s <code>Kind</code>, if not given, is automatically derived from the
filename. In this case, the <code>kubernetes-maven-plugin</code> will create a <code>Deployment</code> because the file is called <code>deployment.yml</code>. Similar mappings between file names and resource type exist for each supported resource kind, the
complete list of which (along with associated abbreviations) can be found in the <a href="#appendix-kind-mapping">Appendix</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Now that sidecar containers are supported in this plugin(if <code>jkube.sidecar</code> is enabled), be careful whenever you&#8217;re supplying container name in the resource fragment. If container specified in resource fragment doesn&#8217;t have a name or it&#8217;s name is equal to default fmp generated application&#8217;s container name; it would not be treated as sidecar and it would be merged into main container. However, You can override plugin&#8217;s default name for main container via <code>jkube.generator.alias</code> property.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Additionally, if you name your fragment using a name prefix followed by a dash and the mapped file name, the plugin will automatically use that name for your resource. So, for example, if you name your deployment fragment
<code>myapp-deployment.yml</code>, the plugin will name your resource <code>myapp</code>. In the absence of such provided name for your resource, a name will be automatically derived from your project&#8217;s metadata (in particular, its <code>artifactId</code> as specified in your POM).</p>
</div>
<div class="paragraph">
<p>No image is also referenced in this example because the plugin also fills in the image details based on the configured image you are building with (either from a generator or from a dedicated image plugin configuration, as seen before).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For building images there is also an alternative mode using external Dockerfiles, in addition to the XML based configuration. Refer to <a href="#build-overview">k8s:build</a> for details.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Enrichment of resource fragments can be fine-tuned by using profile sub-directories. For more details see <a href="#profiles">Profiles</a>.</p>
</div>
<div class="paragraph">
<p>Now that we have seen some examples for the various ways how this plugin can be used, the following sections will describe the plugin goals and extension points in detail.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compatibility-with-Kubernetes">2. Compatibility with Kubernetes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="kubernetes-compatibility">2.1. Kubernetes Compatibility</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Kubernetes Compatibility</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">KMP</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.14.2</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.12.2</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.11.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.10.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.9.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.8.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.7.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.6.0</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.5.1</th>
<th class="tableblock halign-left valign-top">Kubernetes 1.4.0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KMP 0.1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">3. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin is available from Maven central and can be connected to
pre- and post-integration phase as seen below. The configuration and
available goals are described below.</p>
</div>
<div class="paragraph">
<p>By default, Maven will only search for plugins in the <code>org.apache.maven.plugins</code> and <code>org.codehaus.mojo</code> packages. In order to resolve the provider for the Jkube plugin goals, you need to edit <code>~/.m2/settings.xml</code> and add the <code>org.eclipse.jkube</code> namespace so the <code>&lt;pluginGroups&gt;</code> configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;settings&gt;</span>
      ...

      <span class="tag">&lt;pluginGroups&gt;</span>
        <span class="tag">&lt;pluginGroup&gt;</span>org.eclipse.jkube<span class="tag">&lt;/pluginGroup&gt;</span>
      <span class="tag">&lt;/pluginGroups&gt;</span>

      ...
<span class="tag">&lt;/settings&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>

  <span class="tag">&lt;configuration&gt;</span>
     ....
     <span class="tag">&lt;images&gt;</span>
        <span class="comment">&lt;!-- A single's image configuration --&gt;</span>
        <span class="tag">&lt;image&gt;</span>
          ...
          <span class="tag">&lt;build&gt;</span>
           ....
          <span class="tag">&lt;/build&gt;</span>
        <span class="tag">&lt;/image&gt;</span>
        ....
     <span class="tag">&lt;/images&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>

  <span class="comment">&lt;!-- Connect k8s:resource, k8s:build and k8s:helm to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>jkube<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goals">4. Goals Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin supports a rich set for providing a smooth Java developer experience. These goals can be categorized in multiple groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#goals-build">Build goals</a> are all about creating and managing Kubernetes build artifacts like Docker images or S2I builds.</p>
</li>
<li>
<p><a href="#goals-develop">Development goals</a> target help not only in deploying resource descriptors to the development cluster but also to manage the lifecycle of the development cluster as well.</p>
</li>
</ul>
</div>
<table id="goals-build" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Build Goals</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Goal</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:build"><strong>k8s:build</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:push"><strong>k8s:push</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Push images to a registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:resource"><strong>k8s:resource</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create Kubernetes or OpenShift resource descriptors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:apply"><strong>k8s:apply</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply resources to a running cluster</p></td>
</tr>
</tbody>
</table>
<table id="goals-develop" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Development Goals</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Goal</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:deploy"><strong>k8s:deploy</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy resources decriptors to a cluster after creating them and building the app. Same as <a href="#k8s:run">[k8s:run]</a> except that it runs in the backgorund.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:undeploy"><strong>k8s:undeploy</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undeploy and remove resources decriptors from a cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:watch"><strong>k8s:watch</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watch for file changes and perform rebuilds and redeployments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:log"><strong>k8s:log</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the logs of the running application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#k8s:debug"><strong>k8s:debug</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable remote debugging</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Depending on whether the OpenShift or Kubernetes operational mode is used, the workflow and the performed actions differs :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Workflows</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Use Case</th>
<th class="tableblock halign-left valign-top">Kubernetes</th>
<th class="tableblock halign-left valign-top">OpenShift</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>k8s:build</code> <code>k8s:push</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates a image against an exposed Docker daemon (with a <code>docker.tar</code>)</p>
</li>
<li>
<p>Pushes the image to a registry which is then referenced from the configuration</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>k8s:build</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates or uses a <code>BuildConfig</code></p>
</li>
<li>
<p>Creates or uses an <code>ImageStream</code> which can be referenced by the deployment descriptors in a <code>DeploymenConfig</code></p>
</li>
<li>
<p>Starts an OpenShift build with a <code>docker.tar</code> as input</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>k8s:deploy</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies a Kubernetes resource descriptor to cluster</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>k8s:deploy</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies an OpenShift resource descriptor to a cluster</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="goals-overview-build">5. Build Goals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="k8s:resource">5.1. <strong>k8s:resource</strong></h3>
<div class="paragraph">
<p>This goal generates kubernetes resources based upon your project. It can either be opinionated defaults or
based upon the configuration provided in XML config or resource fragments in <code>src/main/jkube</code>. Generated
resources are in <code>target/classes/META-INF/jkube/kubernetes</code> directory.</p>
</div>
<div class="sect3">
<h4 id="resource-labels-annotations">5.1.1. Labels and Annotations</h4>
<div class="paragraph">
<p>Labels and annotations can be easily added to any resource object. This is best explained by an example.</p>
</div>
<div class="listingblock">
<div class="title">Example for label and annotations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  ...
  <span class="tag">&lt;configuration&gt;</span>
    ...
    <span class="tag">&lt;resources&gt;</span>
      <span class="tag">&lt;labels&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;all&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="tag">&lt;property&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="tag">&lt;name&gt;</span>organisation<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;value&gt;</span>unesco<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/all&gt;</span>
        <span class="tag">&lt;service&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
          <span class="tag">&lt;property&gt;</span>
            <span class="tag">&lt;name&gt;</span>database<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;value&gt;</span>mysql<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/property&gt;</span>
          <span class="tag">&lt;property&gt;</span>
            <span class="tag">&lt;name&gt;</span>persistent<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;value&gt;</span>true<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/service&gt;</span>
        <span class="tag">&lt;replicaSet&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
          ...
        <span class="tag">&lt;/replicaSet&gt;</span>
        <span class="tag">&lt;pod&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
          ...
        <span class="tag">&lt;/pod&gt;</span>
        <span class="tag">&lt;deployment&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
          ...
        <span class="tag">&lt;/deployment&gt;</span>
      <span class="tag">&lt;/labels&gt;</span>

      <span class="tag">&lt;annotations&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
         ...
      <span class="tag">&lt;/annotations&gt;</span>
      <span class="tag">&lt;remotes&gt;</span> <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="tag">&lt;remote&gt;</span>https://gist.githubusercontent.com/lordofthejars/ac2823cec7831697d09444bbaa76cd50/raw/e4b43f1b6494766dfc635b5959af7730c1a58a93/deployment.yaml<span class="tag">&lt;/remote&gt;</span>
      <span class="tag">&lt;/remotes&gt;</span>
    <span class="tag">&lt;/resource&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>&lt;labels&gt;</code> section with <code>&lt;resources&gt;</code> contains labels which should be applied to objects of various kinds</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within <code>&lt;all&gt;</code> labels which should be applied to <strong>every</strong> object can be specified</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>&lt;service&gt;</code> labels are used to label services</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>&lt;replicaSet&gt;</code> labels are for replica set and replication controller</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>&lt;pod&gt;</code> holds labels for pod specifications in replication controller, replica sets and deployments</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>&lt;deployment&gt;</code> is for labels on deployments (kubernetes) and deployment configs (openshift)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The subelements are also available for specifying annotations.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>&lt;remotes&gt;</code> you can set location of fragments as <code>URL</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Labels and annotations can be specified in free form as a map. In this map the element name is the name of the label or annotation respectively, whereas the content is the value to set.</p>
</div>
<div class="paragraph">
<p>The following subelements are possible for <code>&lt;labels&gt;</code> and <code>&lt;annotations&gt;</code> :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Label and annotation configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All entries specified in the <code>&lt;all&gt;</code> sections are applied to all resource objects created. This also implies build object like image stream and build configs which are create implicitely for an <a href="#build-openshift">OpenShift build</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deployment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Deployment</code> (for Kubernetes) and <code>DeploymentConfig</code> (for OpenShift) objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pod</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied pod specification as used in <code>ReplicationController</code>,  <code>ReplicaSets</code>, <code>Deployments</code> and <code>DeploymentConfigs</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>replicaSet</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>ReplicaSet</code> and <code>ReplicationController</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Service</code> objects.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="resource-secrets">5.1.2. Secrets</h4>
<div class="paragraph">
<p>Once you&#8217;ve configured some docker registry credentials into <code>~/.m2/setting.xml</code>, as explained in the
<a href="#authentication">Authentication</a> section, you can create Kubernetes secrets from a server declaration.</p>
</div>
<div class="paragraph">
<p><strong>XML configuration</strong></p>
</div>
<div class="paragraph">
<p>You can create a secret using xml configuration in the <code>pom.xml</code> file. It should contain the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">required</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerServerId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the server id which is configured in
<code>~/.m2/setting.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this will be used as name of the kubernetes secret resource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the secret resource will be applied to the specific
namespace, if provided</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This is best explained by an example.</p>
</div>
<div class="listingblock">
<div class="title">Example for XML configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;docker.registry&gt;</span>docker.io<span class="tag">&lt;/docker.registry&gt;</span>
<span class="tag">&lt;/properties&gt;</span>
...
<span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;resources&gt;</span>
        <span class="tag">&lt;secrets&gt;</span>
            <span class="tag">&lt;secret&gt;</span>
                <span class="tag">&lt;dockerServerId&gt;</span>${docker.registry}<span class="tag">&lt;/dockerServerId&gt;</span>
                <span class="tag">&lt;name&gt;</span>mydockerkey<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;/secret&gt;</span>
        <span class="tag">&lt;/secrets&gt;</span>
    <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Yaml fragment with annotation</strong></p>
</div>
<div class="paragraph">
<p>You can create a secret using a yaml fragment. You can reference the docker server id with an annotation
<code>maven.jkube.io/dockerServerId</code>. The yaml fragment file should be put under
the <code>src/main/jkube/</code> folder.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Secret</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">mydockerkey</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">default</span></span>
  <span class="key">annotations</span>:
    <span class="key">maven.jkube.io/dockerServerId</span>: <span class="string"><span class="content">${docker.registry}</span></span>
<span class="key">type</span>: <span class="string"><span class="content">kubernetes.io/dockercfg</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resource-validation">5.1.3. Resource Validation</h4>
<div class="paragraph">
<p>Resource goal also validates the generated resource descriptors using API specification of <a href="https://raw.githubusercontent.com/kubernetes/kubernetes/master/api/openapi-spec/swagger.json">Kubernetes</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Validation Configuration</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.skipResourceValidation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then resource validation is skipped. This may be useful if resource validation is failing for some reason but you still want to continue the deployment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.failOnValidationError</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>true</code> then any validation error will block the plugin execution. A warning will be printed otherwise.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="resource-route-generation">5.1.4. Route Generation</h4>
<div class="paragraph">
<p>When the <code>k8s:resource</code> goal is run, an OpenShift <a href="https://docs.openshift.org/latest/architecture/networking/routes.html">Route</a> descriptor (<code>route.yml</code>) will also be generated along the service if an OpenShift cluster is targeted.
If you do not want to generate a Route descriptor, you can set the <code>jkube.openshift.generateRoute</code> property to <code>false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Route Generation Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.openshift.generateRoute</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If value is set to <code>false</code> then no Route descriptor will be generated. By default it is set to <code>true</code>, which will create a <code>route.yml</code> descriptor and also add Route resource to <code>openshift.yml</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you do not want to generate a Route descriptor, you can also specify so in the plugin configuration in your POM as seen below.</p>
</div>
<div class="listingblock">
<div class="title">Example for not generating route resource by configuring it in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;generateRoute&gt;</span>false<span class="tag">&lt;/generateRoute&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using resource fragments, then also you can configure it in your Service resource fragment (e.g. <code>service.yml</code>). You need to add an <code>expose</code> label to the <code>metadata</code> section of your service and set it to <code>false</code>.</p>
</div>
<div class="listingblock yaml">
<div class="title">Example for not generating route resource by configuring it in resource fragments</div>
<div class="content">
<pre class="CodeRay highlight"><code>metadata:
  annotations:
    api.service.kubernetes.io/path: /hello
  labels:
    expose: "false"
spec:
  type: LoadBalancer</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case both the label and the property have been set with conflicting values, precedence will be given to the property value, so if you set the label to <code>true</code> but set the property to <code>false</code> then no Route descriptor will be generated because precedence will be given to the property value.</p>
</div>
</div>
<div class="sect3">
<h4 id="Other-flags">5.1.5. Other flags</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Other options available with resource goal</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to use. A profile contains the enrichers and generators to use as well as their configuration. Profiles are looked up in the classpath and can be provided as yaml files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.sidecar</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable sidecar behavior or not. By default pod specs are merged into main application container.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.skipHealthCheck</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to skip health checks addition in generated resources or not.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.workDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Jkube working directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.build.directory}/jkube</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.environment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment name where resources are placed. For example, if you set this property to dev and resourceDir is the default one, plugin will look at <code>src/main/jkube/dev</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NULL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.useProjectClassPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should we use the project&#8217;s compile time classpath to scan for additional enrichers/generators?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.resourceDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where to find project specific files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${basedir}/src/main/jkube</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jkube.targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The generated Kubernetes manifests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.build.outputDirectory}/META-INF/jkube</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="k8s:build">5.2. <strong>k8s:build</strong></h3>
<div class="paragraph">
<p>This goal is for building Docker images. Images can be built in two different ways depending on the <code>mode</code> configuration (controlled by the <code>jkube.mode</code> property).
By default the mode is set to <code>auto</code>. In this case the plugin tries to detect which kind of build should be performed by contacting the API server. If this fails or if no cluster access is configured e.g. with <code>oc login</code> then the mode is set to <code>kubernetes</code> in which case a standard Docker build is performed. It can also be forced to <code>openshift</code> to perform an OpenShift build.</p>
</div>
<div class="sect3">
<h4 id="build-kubernetes">5.2.1. Kubernetes Build</h4>
<div class="paragraph">
<p>If the mode is set to <code>kubernetes</code> then a normal Docker build is performed. The connection configuration to access the Docker daemon is described in <a href="#access-configuration">Access Configuration</a>.</p>
</div>
<div class="paragraph">
<p>In order to make the generated images available to the Kubernetes cluster the generated images need to be pushed to a registry with the goal <a href="#k8s:push"><strong>k8s:push</strong></a>. This is not necessary for single node clusters, though as there is no need to distribute images.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-openshift">5.2.2. OpenShift Build</h4>
<div class="paragraph">
<p>For the <code>openshift</code> mode, OpenShift specific <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html">builds</a> will be performed. These are so called <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html">Binary Source</a> builds ("binary builds" in short), where the data specified with the <a href="#build-configuration">build configuration</a>  is sent directly to OpenShift as a binary archive.</p>
</div>
<div class="paragraph">
<p>There are two kind of binary builds supported by this plugin, which can be selected with the <code>buildStrategy</code> configuration option (<code>jkube.build.strategy</code> property)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Build Strategies</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>buildStrategy</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s2i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#source-build">Source-to-Image</a> (S2I) build strategy uses so called builder images for creating new application images from binary build data. The builder image to use is taken from the base image configuration specified with <a href="#build-config-from">from</a> in the image build configuration. See below for a list of builder images which can be used with this plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#docker-build">Docker Build</a> is similar to a normal Docker build except that it is done by the OpenShift cluster and not by a Docker daemon. In addition this build pushes the generated image to the OpenShift internal registry so that it is accessbile in the whole cluster.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Both build strategies update an <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#image-streams">Image Stream</a> after the image creation.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.openshift.com/enterprise/latest/dev_guide/builds.html#defining-a-buildconfig">Build Config</a> and <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#image-streams">Image streams</a> can be managed by this plugin. If they do not exist, they will be automatically created by <code>k8s:build</code>. If they do already exist, they are reused, except when the <code>buildRecreate</code> configuration option (property <code>jkube.build.recreate</code>) is set to a value as described in <a href="#build-goal-configuration">Configuration</a>. Also if the provided build strategy is different than the one defined in the existing build configuration, the Build Config is edited to reflect the new type (which in turn removes all build associated with the previous build).</p>
</div>
<div class="paragraph">
<p>This image stream created can then be directly referenced from <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/deployments.html#deployments-and-deployment-configurations">Deployment Configuration</a> objects created by <a href="#k8s:resource"><strong>k8s:resource</strong></a>.
By default, image streams are created with a local lookup policy, so that they can be used also by other resources such as Deployments or StatefulSets.
This behavior can be turned off by setting the <code>jkube.s2i.imageStreamLookupPolicyLocal</code> property to <code>false</code> when building the project.</p>
</div>
<div class="paragraph">
<p>In order to be able to to create these OpenShift resource objects access to an OpenShift installation is required. The access parameters are described in <a href="#access-configuration">Access Configuration</a>.</p>
</div>
<div class="paragraph">
<p>Regardless of which build mode is used, the images are configured in the same way.</p>
</div>
<div class="paragraph">
<p>The configuration consists of two parts:
* a global section which defines the overall behaviour of this plugin
* and an <code>&lt;images&gt;</code> section which defines how the images should be build</p>
</div>
<div class="paragraph">
<p>Many of the options below are relevant for the <a href="#build-kubernetes">Kubernetes Workflow</a> or the <a href="#build-openshift">OpenShift Workflow</a> with Docker builds as they influence how the Docker image is build.</p>
</div>
<div class="paragraph">
<p>For an S2I binary build, on the other hand, the most relevant section is the <a href="#build-assembly">Assembly</a> one because the build depends on which buider/base image is used and how it interprets the content of the uploaded <code>docker.tar</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-goal-configuration">5.2.3. Configuration</h4>
<div class="paragraph">
<p>The following sections describe the usual configuration, which is similar to the build configuration used in the <a href="https://dmp.jkube.io">docker-maven-plugin</a>.</p>
</div>
<div class="paragraph">
<p>In addition a more automatic way for creating predefined build configuration can be performed with so called <a href="#generators">Generators</a>. Generators are very flexible and can be easily created. These are described in an extra <a href="#generators">section</a>.</p>
</div>
<div class="paragraph">
<p>Global configuration parameters specify overall behavior common for all images to build. Some of the configuration options are shared with other goals.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Global configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>apiVersion</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this variable if you are using an older version of docker not compatible with the current default use to communicate with the server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.apiVersion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>authConfig</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication information when pulling from or pushing to Docker registry. There is a dedicated section <a href="#authentication">Authentication</a> for how doing security.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>autoPull</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Decide how to pull missing base images or images to start:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>on</code> : Automatic download any missing images (default)</p>
</li>
<li>
<p><code>off</code> : Automatic pulling is switched off</p>
</li>
<li>
<p><code>always</code> : Pull images always even when they are already exist locally</p>
</li>
<li>
<p><code>once</code> : For multi-module builds images are only checked once and pulled for the whole build.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.autoPull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildRecreate</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the effective <a href="#build-mode">mode</a> is <code>openshift</code> then this option decides how the OpenShift resource objects associated with the build should be treated when they already exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>buildConfig</code> or <code>bc</code> : Only the BuildConfig is recreated</p>
</li>
<li>
<p><code>imageStream</code> or <code>is</code> : Only the ImageStream is recreated</p>
</li>
<li>
<p><code>all</code> : Both, BuildConfig and ImageStream are recreated</p>
</li>
<li>
<p><code>none</code> : Neither BuildConfig nor ImageStream is recreated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default is <code>none</code>. If you provide the property without value then <code>all</code> is assumed, so everything gets recreated.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.recreate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildStrategy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the effective <a href="#build-mode">mode</a> is <code>openshift</code> then this option sets the build strategy. This can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>s2i</code> for a <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#source-build">Source-to-Image build</a> with a binary source</p>
</li>
<li>
<p><code>docker</code> for a <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#docker-build">Docker build</a> with a binary source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default S2I is used.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.strategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>forcePull</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicable only for OpenShift, S2I build strategy.</p>
<p class="tableblock">While creating a BuildConfig, By default, if the builder image specified in the
build configuration is available locally on the node, that image will be used.</p>
<p class="tableblock">Using forcePull will override the local image and refresh it from the registry the image stream points to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.forcePull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>certPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to SSL certificate when SSL is used for communicating with the Docker daemon. These certificates are normally stored in <code>~/.docker/</code>. With this configuration the path can be set explicitly. If not set, the fallback is first taken from the environment variable <code>DOCKER_CERT_PATH</code> and then as last resort <code>~/.docker/</code>. The keys in this are expected with it standard names <code>ca.pem</code>, <code>cert.pem</code> and <code>key.pem</code>. Please refer to the <a href="https://docs.docker.com/articles/https">Docker documentation</a> for more information about SSL security with Docker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.certPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerHost</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The URL of the Docker Daemon. If this configuration option is not given, then the optional <code>&lt;machine&gt;</code> configuration section is consulted. The scheme of the URL can be either given directly as <code>http</code> or <code>https</code>
depending on whether plain HTTP communication is enabled or SSL should
be used. Alternatively the scheme could be <code>tcp</code> in which case the
protocol is determined via the IANA assigned port: 2375 for <code>http</code>
and 2376 for <code>https</code>. Finally, Unix sockets are supported by using
the scheme <code>unix</code> together with the filesystem path to the unix socket.
The discovery sequence used by the docker-maven-plugin to determine
the URL is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>value of <strong>dockerHost</strong> (<code>docker.host</code>)</p>
</li>
<li>
<p>the Docker host associated with the docker-machine named in <code>&lt;machine&gt;</code>, i.e. the <code>DOCKER_HOST</code> from <code>docker-machine env</code>. See <a href="#docker-machine">below</a> for more information about Docker machine support.</p>
</li>
<li>
<p>the value of the environment variable <code>DOCKER_HOST</code>.</p>
</li>
<li>
<p><code>unix:///var/run/docker.sock</code> if it is a readable socket.</p>
</li>
</ol>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.host</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>image</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In order to temporarily restrict the operation of plugin goals this configuration option can be used. Typically this will be set via the system property <code>docker.image</code> when Maven is called. The value can be a single image name (either its alias or full name) or it can be a comma separated list with multiple image names. Any name which doesn&#8217;t refer an image in the configuration will be ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.image</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>machine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker machine configuration. See <a href="#docker-machine">Docker Machine</a> for possible values</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-mode"></a> <strong>mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The build mode which can be</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubernetes</code> : A Docker image will be created by calling a Docker daemon. See <a href="#build-kubernetes">Kubernetes Build</a> for details.</p>
</li>
<li>
<p><code>openshift</code> : An OpenShift Build will be triggered, which can be either a <em>Docker binary build</em> or a <em>S2I binary build</em>, depending on the configuration <code>buildStrategy</code>. See <a href="#build-openshift">OpenShift Build</a> for details.</p>
</li>
<li>
<p><code>auto</code> : The plugin tries to detect the mode by contacting the configured cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>auto</code> is the default. (<em>Because of technical reasons, "kubernetes" is currently the default, but will change to "auto" eventually</em>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.mode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maxConnections</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of parallel connections are allowed to be opened to the Docker Host. For parsing log output, a connection needs to be kept open (as well for the wait features), so don&#8217;t put that number to low. Default is 100 which should be suitable for most of the cases.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.maxConnections</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>access</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group of configuration parameters to connect to Kubernetes/OpenShift cluster</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default output directory to be used by this plugin. The default value is <code>target/docker</code> and is only used for the goal <code>jkube:build</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.target.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>portPropertyFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global property file into which the mapped properties should be written to. The format of this file and its purpose are also described in <a href="#start-port-mapping">Port Mapping</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to which contains enricher and generators configuration. See <a href="#profiles">Profiles</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.profile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pullSecret</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name to use for naming pullSecret to be created to pull the base image in case pulling from a private registry which requires authentication for Openshift.</p>
<p class="tableblock">  The default value for pull registry will be picked from "docker.pull.registry/docker.registry".</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.build.pullSecret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify globally a registry to use for pulling and pushing images. See <a href="#registry">Registry handling</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>resourceDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where jkube.resources are stored. This is also the directory where a custom profile is looked up. Default is <code>src/main/jkube</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.resourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>environment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment name where resources are placed. For example, if you set this property to dev and resourceDir is the default one, Jkube  will look at src/main/jkube/dev. If not set then root <code>resourceDir</code> directory is used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.environment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this parameter the execution of this plugin can be skipped completely.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipBuild</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set not images will be build (which implies also <em>skip.tag</em>) with <code>jkube:build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.build</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipBuildPom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set the build step will be skipped for modules of type <code>pom</code>. If not set, then by default projects of type <code>pom</code> will be skipped if there are no image configurations contained.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.skip.build.pom</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t add any tags to images that have been built with <code>jkube:build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipMachine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip using docker machine in any case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.machine</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sourceDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default directory that contains the assembly descriptor(s) used by the plugin. The default value is <code>src/main/docker</code>. This option is only relevant for the <code>jkube:build</code> goal.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.source.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>verbose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean attribute for switching on verbose output like the build steps when doing a Docker build. Default is <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.verbose</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="kubernetes-access-configuration">5.2.4. Kubernetes Access Configuration</h4>
<div class="paragraph">
<p>You can configure parameters to define how plugin is going to connect to Kubernetes cluster instead of relaying on default parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;access&gt;</span>
    <span class="tag">&lt;username&gt;</span><span class="tag">&lt;/username&gt;</span>
    <span class="tag">&lt;password&gt;</span><span class="tag">&lt;/password&gt;</span>
    <span class="tag">&lt;masterUrl&gt;</span><span class="tag">&lt;/masterUrl&gt;</span>
    <span class="tag">&lt;apiVersion&gt;</span><span class="tag">&lt;/apiVersion&gt;</span>
  <span class="tag">&lt;/access&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property (System property or Maven property)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>username</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.password</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.namespace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>masterUrl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master URL on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.masterUrl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>apiVersion</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Api version on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.apiVersion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>caCertFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CaCert File on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.caCertFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>caCertData</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CaCert Data on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.caCertData</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientCertFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Cert File on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientCertFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientCertData</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Cert Data on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientCertData</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientKeyFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Key File on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientKeyFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientKeyData</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Key Data on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientKeyData</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientKeyAlgo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Key Algorithm on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientKeyAlgo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>clientKeyPassphrase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Key Passphrase on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.clientKeyPassphrase</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trustStoreFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust Store File on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.trustStoreFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trustStorePassphrase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust Store Passphrase on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.trustStorePassphrase</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>keyStoreFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key Store File on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.keyStoreFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>keyStorePassphrase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key Store Passphrase on which to operate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.keyStorePassphrase</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="image-configuration">5.2.5. Image Configuration</h4>
<div class="paragraph">
<p>The configuration how images should be created a defined in a dedicated <code>&lt;images&gt;</code> sections. These are specified for each image within the <code>&lt;images&gt;</code> element of the configuration with one <code>&lt;image&gt;</code> element per image to use.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;image&gt;</code> element can contain the following sub elements:</p>
</div>
<table id="config-image" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Image Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each <code>&lt;image&gt;</code> configuration has a mandatory, unique docker
repository <em>name</em>. This can include registry and tag parts, but also placeholder parameters. See below for a detailed explanation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shortcut name for an image which can be used for
identifying the image within this configuration. This is used when
linking images together or for specifying it with the global <strong>image</strong> configuration element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#registry"><strong>registry</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry to use for this image. If the <code>name</code> already contains a registry this takes precedence. See <a href="#registry">Registry handling</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#config-image-build"><strong>build</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element which contains all the configuration aspects when doing a <a href="#jkube:build">[jkube:build]</a>. This element can be omitted if the image is only pulled from a registry e.g. as support for integration tests like database images.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>&lt;build&gt;</code> section is mandatory and is explained in <a href="#build-configuration">below</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example for &lt;image&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  ....
  <span class="tag">&lt;images&gt;</span>
    <span class="tag">&lt;image&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;name&gt;</span>%g/docker-demo:0.1<span class="tag">&lt;/name&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;alias&gt;</span>service<span class="tag">&lt;/alias&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;build&gt;</span>....<span class="tag">&lt;/build&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      ....
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>One or more <code>&lt;image&gt;`</code> definitions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Docker image name used when creating the image.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An alias which can be used in other parts of the plugin to reference to this image. This alias must be unique.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A <code>&lt;build&gt;</code> section as described in <a href="#buid-configuration">Build Configuration</a></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build-configuration">5.2.6. Build Configuration</h4>
<div id="build-overview" class="paragraph">
<p>There are two different modes how images can be built:</p>
</div>
<div class="paragraph">
<div class="title">Inline plugin configuration</div>
<p>With an inline plugin configuration all information required to build the image is contained in the plugin configuration. By default its the standard XML based configuration for the plugin but can be switched to a property based configuration syntax as described in the section <a href="#external-configuration">External configuration</a>. The XML configuration syntax is recommended because of its more structured and typed nature.</p>
</div>
<div class="paragraph">
<p>When using this mode, the Dockerfile is created on the fly with all instructions extracted from the configuration given.</p>
</div>
<div id="external-dockerfile" class="paragraph">
<div class="title">External Dockerfile or Docker archive</div>
<p>Alternatively an external Dockerfile template or Docker archive can be used. This mode is switched on by using one of these three configuration options within</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>contextDir</strong> specifies docker build context if an external dockerfile is located outside of Docker build context. If not specified, Dockerfile&#8217;s parent directory is used as build context.</p>
</li>
<li>
<p><strong>dockerFile</strong> specifies a specific Dockerfile path. The Docker build context directory is set to <code>contextDir</code> if given. If not the directory by default is the directory in which the Dockerfile is stored.</p>
</li>
<li>
<p><strong>dockerArchive</strong> specifies a previously saved image archive to load directly. Such a tar archive can be created with <code>docker save</code> or the <a href="#jkube:save">[jkube:save]</a> goal. If a <code>dockerArchive</code> is provided, no <code>dockerFile</code> or <code>dockerFileDir</code> must be given.</p>
</li>
<li>
<p><strong>dockerFileDir</strong> (<em>deprecated</em>, use <strong>contextDir</strong>) specifies a directory containing a Dockerfile that will be used to create the image. The name of the Dockerfile is <code>Dockerfile</code> by default but can be also set with the option <code>dockerFile</code> (see below).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All paths can be either absolute or relative paths (except when both <code>dockerFileDir</code> and <code>dockerFile</code> are provided in which case <code>dockerFile</code> must not be absolute). A relative path is looked up in <code>${project.basedir}/src/main/docker</code> by default. You can make it easily an absolute path by using <code>${project.basedir}</code> in your configuration.</p>
</div>
<div class="paragraph">
<div class="title">Adding assemblies in Dockerfile mode</div>
<p>Any additional files located in the <code>dockerFileDir</code> directory will also be added to the build context as well.
You can also use an assembly if specified in an <a href="#build-assembly">assembly configuration</a>.
However, you need to add the files on your own in the Dockerfile with an <code>ADD</code> or <code>COPY</code> command.
The files of the assembly are stored in a build context relative directory <code>maven/</code> but can be changed by changing the assembly name with the option <code>&lt;name&gt;</code> in the assembly configuration.</p>
</div>
<div class="paragraph">
<p>E.g. the files can be added with</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="dockerfile">COPY maven/ /my/target/directory</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that the assembly files will end up in <code>/my/target/directory</code> within the container.</p>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.maven-dockerignore</code> (or alternatively, a <code>.maven-dockerexclude</code> file), then it is used for excluding files for the build. Each line in this file is treated as a <a href="http://ant.apache.org/manual/Types/fileset.html">FileSet exclude pattern</a> as used by the <a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a>. It is similar to <code>.dockerignore</code> when using Docker but has a slightly different syntax (hence the different name).
<a href="#ex-build-dockerexclude">Example <code>.maven-dockerexclude</code> or <code>.maven-dockerignore</code></a> is an  example which excludes all compiled Java classes.</p>
</div>
<div id="ex-build-dockerexclude" class="exampleblock">
<div class="title">Example 1. Example <code>.maven-dockerexclude</code> or <code>.maven-dockerignore</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>target/classes/**  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Exclude all compiled classes</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.maven-dockerinclude</code> file, then it is used for including only those files for the build. Each line in this file is also treated as a <a href="http://ant.apache.org/manual/Types/fileset.html">FileSet exclude pattern</a> as used by the <a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a>. <a href="#ex-build-dockerinclude">Example <code>.maven-dockerinclude</code></a> shows how to include only jar file that have build to the Docker build context.</p>
</div>
<div id="ex-build-dockerinclude" class="exampleblock">
<div class="title">Example 2. Example <code>.maven-dockerinclude</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>target/*.jar  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only add jar file to you Docker build context.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Except for the <a href="#build-assembly">assembly configuration</a> all other configuration options are ignored for now.</p>
</div>
<div id="simple-dockerfile-build" class="paragraph">
<div class="title">Simple Dockerfile build</div>
<p>When only a single image should be built with a Dockerfile no XML configuration is needed at all.
All what need to be done is to place a <code>Dockerfile</code> into the top-level module directory, alongside to <code>pom.xml</code>.
You can still configure <a href="#global-configuration">global aspects</a> in the plugin configuration, but as soon as you add an <code>&lt;image&gt;</code> in the XML configuration, you need to configure also the build explicitly.</p>
</div>
<div class="paragraph">
<p>The image name is by default set from the Maven coordinates (<code>%g/%a:%l</code>, see <a href="#image-name">Image Name </a> for an explanation of the params which are essentially the Maven GAV)
This name can be set with the property <code>docker.name</code>.</p>
</div>
<div class="paragraph">
<p>If you want to add some <code>&lt;run&gt;</code> configuration to this image for starting it with <code>docker:run</code> then you can add an image configuration but without a <code>&lt;build&gt;</code> section in which case the Dockerfile will be picked up, too. This works only for a single image, though.</p>
</div>
<div id="build-filtering" class="paragraph">
<div class="title">Filtering</div>
<p>kubernetes-maven-plugin filters given Dockerfile with Maven properties, much like the <code>maven-resource-plugin</code> does. Filtering is enabled by default and can be switched off with a build config <code>&lt;filter&gt;false&lt;/filter&gt;</code>. Properties which we want to replace are specified with the <code>${..}</code> syntax.
Replacement includes Maven project properties such as <code>${project.artifactId}</code>, properties set in the build, command-line properties, and system properties. Unresolved properties remain untouched.</p>
</div>
<div class="paragraph">
<p>This partial replacement means that you can easily mix it with Docker build arguments and environment variable reference, but you need to be careful.
If you want to be more explicit about the property delimiter to clearly separate Docker properties and Maven properties you can redefine the delimiter.
In general, the <code>filter</code> option can be specified the same way as delimiters in the resource plugin.
In particular,  if this configuration contains a * then the parts left, and right of the asterisks are used as delimiters.</p>
</div>
<div class="paragraph">
<p>For example, the default <code>&lt;filter&gt;${*}&lt;/filter&gt;</code> parse Maven properties in the format that we know.
If you specify a single character for <code>&lt;filter&gt;</code> then this delimiter is taken for both, the start and the end.
E.g a <code>&lt;filter&gt;@&lt;/filter&gt;</code> triggers on parameters in the format <code>@&#8230;&#8203;@</code>, much like in the <code>maven-invoker-plugin</code>.
Use something like this if you want to clearly separate from Docker builds args.
This form of property replacement works for Dockerfile only.
For replacing other data in other files targeted for the Docker image, please use the <code>maven-resource-plugin</code> or an <a href="#build-assembly">assembly configuration</a> with filtering to make them available in the docker build context.</p>
</div>
<div class="paragraph">
<div class="title">Example</div>
<p>The following example uses a Dockerfile in the directory
<code>src/main/docker/demo</code> and replaces all properties in the format <code>@property@</code> within the Dockerfile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
 <span class="tag">&lt;configuration&gt;</span>
   <span class="tag">&lt;images&gt;</span>
     <span class="tag">&lt;image&gt;</span>
       <span class="tag">&lt;name&gt;</span>user/demo<span class="tag">&lt;/name&gt;</span>
       <span class="tag">&lt;build&gt;</span>
         <span class="tag">&lt;dockerFileDir&gt;</span>demo<span class="tag">&lt;/dockerFileDir&gt;</span>
         <span class="tag">&lt;filter&gt;</span>@<span class="tag">&lt;/filter&gt;</span>
       <span class="tag">&lt;/build&gt;</span>
     <span class="tag">&lt;/image&gt;</span>
   <span class="tag">&lt;/images&gt;</span>
 <span class="tag">&lt;/configuration&gt;</span>
 ...
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div id="build-plugin" class="paragraph">
<div class="title">Build Plugins</div>
<p>This plugin supports so call <strong>dmp-plugins</strong> which are used during the build phase.
dmp-plugins are enabled by just declaring a dependency in the plugin declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>run-java-sh<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>1.2.2<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.eclipse.jkube.runsh.RunShLoader</code></pre>
</div>
</div>
<div class="paragraph">
<p>During a build with <code>docker:build</code>, those classes are loaded and certain fixed method are called.</p>
</div>
<div class="paragraph">
<p>The following methods are supported:</p>
</div>
<table id="build-plugin-methods" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>addExtraFiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>static</em> method called by dmp with a single <code>File</code> argument. This will point to a directory <code>docker-extra</code> which can be referenced easily by a Dockerfile or an assembly. A dmp plugin typically will create an own subdirectory to avoid a clash with other dmp-plugins.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a configured plugin does not provide method of this name and signature, then it will be simply ignored.
Also, no interface needs to be implemented to keep the coupling low.</p>
</div>
<div class="paragraph">
<p>The following official dmp-plugins are known and supported:</p>
</div>
<table id="build-plugins-official" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">G,A</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/fabric8io-images/run-java-sh">run-java.sh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.io</code>, <code>run-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose startup script fo running Java applications. The dmp plugin creates a <code>target/docker-extra/run-java/run-java.sh</code> which can be included in a Dockerfile (see the example above). See the <a href="https://github.com/fabric8io-images/run-java-sh">run-java.sh Documentation</a> for more details.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Check out <code>samples/run-java</code> for a fully working example.</p>
</div>
<div class="paragraph">
<p>All build relevant configuration is contained in the <code>&lt;build&gt;</code> section
of an image configuration. The following configuration options are supported:</p>
</div>
<table id="config-image-build" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Build configuration (<a href="#config-image">&lt;image&gt; </a>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#config-image-build-assembly"><strong>assembly</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specifies the assembly configuration as described in <a href="#build-assembly">Build Assembly</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-buildargs"><strong>args</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the value of <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build args</a>
which should be used when building the image with an external Dockerfile which uses build arguments. The key-value syntax is the same as when defining Maven properties (or <code>labels</code> or <code>env</code>).
This argument is ignored when no external Dockerfile is used. Build args can also be specified as properties as
described in <a href="#build-buildargs">Build Args</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildOptions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the build options to provide to the docker daemon when building the image. These options map to the ones listed as query parameters in the
<a href="https://docs.docker.com/engine/reference/api/docker_remote_api_v1.24/#build-image-from-a-dockerfile">Docker Remote API</a> and are restricted to simple options
(e.g.: memory, shmsize). If you use the respective configuration options for build options natively supported by the build configuration (i.e. <code>noCache</code>, <code>cleanup=remove</code> for buildoption <code>forcerm=1</code> and <code>args</code> for build args) then these will override any corresponding options given here. The key-value syntax is the same as when defining environment variables or labels as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cleanup</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cleanup dangling (untagged) images after each build (including any containers created from them). Default is <code>try</code> which tries to remove the old image, but doesn&#8217;t fail the build if this is not possible because e.g. the image is still used by a running container. Use <code>remove</code> if you want to fail the build and <code>none</code> if no cleanup is requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="context-dir"></a><strong>contextDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a directory used for the build&#8217;s context. You can specify the <code>Dockerfile</code> to use with <strong>dockerFile</strong>, which by default is the Dockerfile found in the <code>contextDir</code>. The Dockerfile can be also located outside of the <code>contextDir</code>, if provided with an absolute file path. See <a href="#external-dockerfile">External Dockerfile</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-startup"><strong>cmd</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command to execute by default (i.e. if no command is provided when a container for this image is started). See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>compression</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The compression mode how the build archive is transmitted to the docker daemon (<code>jkube:build</code>) and how docker build archives are attached to this build as sources (<code>jkube:source</code>). The value can be <code>none</code> (default), <code>gzip</code> or <code>bzip2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a <code>Dockerfile</code> which also triggers <em>Dockerfile mode</em>. See <a href="#external-dockerfile">External Dockerfile</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerFileDir</strong> (<em>deprecated</em> in favor of <strong><a href="#context-dir">contextDir</a></strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a directory holding a <code>Dockerfile</code> and switch on <em>Dockerfile mode</em>. See <a href="#external-dockerfile">External Dockerfile</a> for details. <em>This option is deprecated in favor of _contextDir</em> and will be removed for the next major release_.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerArchive</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a saved image archive which is then imported. See <a href="#external-dockerfile">Docker archive</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-startup"><strong>entryPoint</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entrypoint allows you to configure a container that will run as an executable. See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-env"><strong>env</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The environments as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>filter</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable and set the delimiters for property replacements. By default properties in the format <code>${..}</code> are replaced with Maven properties. You can switch off property replacement by setting this property to <code>false</code>. When using a single char like <code>@</code> then this is used as a delimiter (e.g <code>@&#8230;&#8203;@</code>). See <a href="#build-filtering">Filtering</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-config-from"></a><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base image which should be used for this image. If not given this default to <code>busybox:latest</code> and is suitable for a pure data image.
In case of an <a href="#build-openshift">S2I Binary build</a> this parameter specifies the S2I Builder Image to use, which by default is <code>fabric8/s2i-java:latest</code>. See also <a href="#build-config-from-ext">from-ext</a> how to add additional properties for the base image.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-config-from-ext"></a><strong>fromExt</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Extended definition for a base image. This field holds a map of defined in <code>&lt;key&gt;value&lt;/key&gt;</code> format. The known keys are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code> : Name of the base image</p>
</li>
<li>
<p><code>&lt;kind&gt;</code> : Kind of the reference to the builder image when in S2I build mode. By default its <code>ImageStreamTag</code> but can be also <code>ImageStream</code>. An alternative would be <code>DockerImage</code></p>
</li>
<li>
<p><code>&lt;namespace&gt;</code> : Namespace where this builder image lives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A provided <code>&lt;from&gt;</code> takes precedence over the name given here. This tag is useful for extensions of this plugin.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-healthcheck"><strong>healthCheck</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a health check as described in <a href="#build-healthcheck">Healthcheck</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>imagePullPolicy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific pull policy for the base image. This overwrites any global pull policy. See the globale configuration option <a href="#image-pull-policy">imagePullPolicy</a> for the possible values and the default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>loadNamePattern</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Scan the images in the archive specified in <code>dockerArchive</code> and match the associated repository and tag information against this pattern. When a matching repository and tag is found, create a tag linking the <code>name</code> for this image to the repository and tag that matched the pattern.</p>
</div>
<div class="paragraph">
<p>The wildcards are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?</code> matches a single character</p>
</li>
<li>
<p><code>*</code> matches within one component, where components are separated by slashes, or the final colon that separates the repository from the tag</p>
</li>
<li>
<p><code>**</code> matches multiple components, stopping at the final colon</p>
</li>
<li>
<p><code>**/</code> matches multiple components, but must stop at a slash, or the final colon</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When matching multiple components, <code>**/</code> is likely to be more useful than <code>**</code>. The pattern <code>**image-name:*</code> will match <code>my-group/my-image-name:some-tag</code>, whereas <code>**/image-name:*</code> will not, because the wildcard has to stop at a slash. Note that <code>**/image-name:*</code> will also match 'image-name:some-tag', since the <code>**/</code> wildcard can be empty.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#misc-env"><strong>labels</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels  as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maintainer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The author (<code>MAINTAINER</code>) field for the generated image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>noCache</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t use Docker&#8217;s build cache. This can be overwritten by setting a system property <code>docker.noCache</code> when running Maven.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cacheFrom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>&lt;image&gt;</code> elements specifying image names to use as cache sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optimise</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true then it will compress all the <code>runCmds</code> into a single <code>RUN</code> directive so that only one image layer is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The exposed ports which is a list of <code>&lt;port&gt;</code> elements, one for each port to expose. Whitespace is trimmed from each element and empty elements are ignored. The format can be either pure numerical ("8080") or with the protocol attached ("8080/tcp").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>shell</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell to be used for the <strong>runCmds</strong>. It contains <strong>arg</strong> elements which are defining the executable and its params.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runCmds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commands to be run during the build process. It contains <strong>run</strong> elements which are passed to the shell. Whitespace is trimmed from each element and empty elements are ignored. The run commands are inserted right after the assembly and after <strong>workdir</strong> into the Dockerfile. This tag is not to be confused with the <code>&lt;run&gt;</code> section for this image which specifies the runtime behaviour when starting containers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true disables building of the image. This config option is best used together with a maven property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t add any tags to images. Property: <code>docker.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tags</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of additional <code>tag</code> elements with which an image is to be tagged after the build. Whitespace is trimmed from each element and empty elements are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User to which the Dockerfile should switch to the end (corresponds to the <code>USER</code> Dockerfile directive).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>volumes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <code>volume</code> elements to create a container volume. Whitespace is trimmed from each element and empty elements are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>workdir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to change to when starting the container.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From this configuration this Plugin creates an in-memory Dockerfile,
copies over the assembled files and calls the Docker daemon via its
remote API.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
  <span class="tag">&lt;from&gt;</span>java:8u40<span class="tag">&lt;/from&gt;</span>
  <span class="tag">&lt;maintainer&gt;</span>john.doe@example.com<span class="tag">&lt;/maintainer&gt;</span>
  <span class="tag">&lt;tags&gt;</span>
    <span class="tag">&lt;tag&gt;</span>latest<span class="tag">&lt;/tag&gt;</span>
    <span class="tag">&lt;tag&gt;</span>${project.version}<span class="tag">&lt;/tag&gt;</span>
  <span class="tag">&lt;/tags&gt;</span>
  <span class="tag">&lt;ports&gt;</span>
    <span class="tag">&lt;port&gt;</span>8080<span class="tag">&lt;/port&gt;</span>
  <span class="tag">&lt;/ports&gt;</span>
  <span class="tag">&lt;volumes&gt;</span>
    <span class="tag">&lt;volume&gt;</span>/path/to/expose<span class="tag">&lt;/volume&gt;</span>
  <span class="tag">&lt;/volumes&gt;</span>
  <span class="tag">&lt;buildOptions&gt;</span>
    <span class="tag">&lt;shmsize&gt;</span>2147483648<span class="tag">&lt;/shmsize&gt;</span>
  <span class="tag">&lt;/buildOptions&gt;</span>

  <span class="tag">&lt;shell&gt;</span>
    <span class="tag">&lt;exec&gt;</span>
      <span class="tag">&lt;arg&gt;</span>/bin/sh<span class="tag">&lt;/arg&gt;</span>
      <span class="tag">&lt;arg&gt;</span>-c<span class="tag">&lt;/arg&gt;</span>
    <span class="tag">&lt;/exec&gt;</span>
  <span class="tag">&lt;/shell&gt;</span>
  <span class="tag">&lt;runCmds&gt;</span>
    <span class="tag">&lt;run&gt;</span>groupadd -r appUser<span class="tag">&lt;/run&gt;</span>
    <span class="tag">&lt;run&gt;</span>useradd -r -g appUser appUser<span class="tag">&lt;/run&gt;</span>
  <span class="tag">&lt;/runCmds&gt;</span>

  <span class="tag">&lt;entryPoint&gt;</span>
    <span class="comment">&lt;!-- exec form for ENTRYPOINT --&gt;</span>
    <span class="tag">&lt;exec&gt;</span>
      <span class="tag">&lt;arg&gt;</span>java<span class="tag">&lt;/arg&gt;</span>
      <span class="tag">&lt;arg&gt;</span>-jar<span class="tag">&lt;/arg&gt;</span>
      <span class="tag">&lt;arg&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/arg&gt;</span>
    <span class="tag">&lt;/exec&gt;</span>
  <span class="tag">&lt;/entryPoint&gt;</span>

  <span class="tag">&lt;assembly&gt;</span>
    <span class="tag">&lt;mode&gt;</span>dir<span class="tag">&lt;/mode&gt;</span>
    <span class="tag">&lt;targetDir&gt;</span>/opt/demo<span class="tag">&lt;/targetDir&gt;</span>
    <span class="tag">&lt;descriptor&gt;</span>assembly.xml<span class="tag">&lt;/descriptor&gt;</span>
  <span class="tag">&lt;/assembly&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to see the individual build steps you can switch on <code>verbose</code> mode either by setting the property <code>docker.verbose</code> or by using <code>&lt;verbose&gt;true&lt;/verbose&gt;</code> in the <a href="#global-configuration">Global configuration</a></p>
</div>
</div>
<div class="sect3">
<h4 id="build-assembly">5.2.7. Assembly</h4>
<div class="paragraph">
<p>The <code>&lt;assembly&gt;</code> element within <code>&lt;build&gt;</code> is has an XML struture and defines how build artifacts and other files can enter the Docker image.</p>
</div>
<table id="config-image-build-assembly" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Assembly Configuration (<a href="#config-image">&lt;image&gt; </a> : <a href="#config-image-build">&lt;build&gt; </a>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly name, which is <code>maven</code> by default. This name is used for the archives and directories created during the build. This directory holds the files specified by the assembly. If an <a href="#external-dockerfile">external Dockerfile</a> is used than this name is also the relative directory which contains the assembly files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory under which the files and artifacts contained in the assembly will be copied within the container. The default value for this is <code>/&lt;assembly name&gt;</code>, so <code>/maven</code> if <strong>name</strong> is not set to a different value. This option has no meaning when an <a href="#external-dockerfile">external Dockerfile</a> is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-assembly-descriptor"><strong>inline</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inlined assembly descriptor as described in <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-assembly-descriptor"><strong>descriptor</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to an assembly descriptor file, whose format is described  <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#build-assembly-descriptor-refs"><strong>descriptorRef</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias to a predefined assembly descriptor. The available aliases are also described in <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerFileDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory containing an external Dockerfile. <em>This option is deprecated, please use &lt;dockerFileDir&gt; directly in the &lt;build&gt; section</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exportTargetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification whether the <code>targetDir</code> should be exported as a volume.  This value is <code>true</code> by default except in the case the <code>targetDir</code> is set to the container root (<code>/</code>). It is also <code>false</code> by default when a base image is used with <code>from</code> since exporting makes no sense in this case and will waste disk space unnecessarily.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignorePermissions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification if existing file permissions should be ignored
when creating the assembly archive with a mode <code>dir</code>. This value is <code>false</code> by default. <em>This property is deprecated, use a <code>permissions</code> of <code>ignore</code> instead.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode how the how the assembled files should be collected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dir</code> : Files are simply copied (default),</p>
</li>
<li>
<p><code>tar</code> : Transfer via tar archive</p>
</li>
<li>
<p><code>tgz</code> : Transfer via compressed tar archive</p>
</li>
<li>
<p><code>zip</code> : Transfer via ZIP archive</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archive formats have the advantage that file permission can be preserved better (since the copying is independent from the underlying files systems), but might triggers internal bugs from the Maven assembler (as it has been reported in <a href="https://github.com/fabric8io/docker-maven-plugin/issues/171">#171</a>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>permissions</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Permission of the files to add:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ignore</code> to use the permission as found on files regardless on any
assembly configuration</p>
</li>
<li>
<p><code>keep</code> to respect the assembly provided permissions, <code>exec</code> for setting the executable bit on all files (required for Windows when using an assembly mode <code>dir</code>)</p>
</li>
<li>
<p><code>auto</code> to let the plugin select <code>exec</code> on Windows and <code>keep</code> on others.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>keep</code> is the default value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tarLongFileMode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the TarArchiver behaviour on file paths with more than 100 characters length. Valid values are: "warn"(default), "fail", "truncate", "gnu", "posix", "posix_warn" or "omit"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="config-image-build-assembly-user"></a> <strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User and/or group under which the files should be added. The user must already exist in the base image.</p>
<p class="tableblock">It has the general format <code>user[:group[:run-user]]</code>. The user and group can be given either as numeric user- and group-id or as names. The group id is optional.</p>
<p class="tableblock">If a third part is given, then the build changes to user <code>root</code> before changing the ownerships, changes the ownerships and then change to user <code>run-user</code> which is then used for the final command to execute. This feature might be needed, if the base image already changed the user (e.g. to 'jboss') so that a <code>chown</code> from root to this user would fail.</p>
<p class="tableblock">For example, the image <code>jboss/wildfly</code> use a "jboss" user under which all commands are executed. Adding files in Docker always happens under the UID root. These files can only be changed to "jboss" is the <code>chown</code> command is executed as root. For the following commands to be run again as "jboss" (like the final <code>standalone.sh</code>), the plugin switches back to user <code>jboss</code> (this is this "run-user") after changing the file ownership. For this example a specification of
<code>jboss:jboss:jboss</code> would be required.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the event you do not need to include any artifacts with the image, you may safely omit this element from the configuration.</p>
</div>
<div class="sect4">
<h5 id="build-assembly-descriptor">Assembly Descriptor</h5>
<div class="paragraph">
<p>With using the <code>inline</code>, <code>descriptor</code> or <code>descriptorRef</code> option
it is possible to bring local files, artifacts and dependencies into
the running Docker container. A <code>descriptor</code> points to a file
describing the data to put into an image to build. It has the same
<a href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html">format</a> as for creating assemblies with the
<a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a> with following exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;formats&gt;</code> are ignored, the assembly will allways use a directory
when preparing the data container (i.e. the format is fixed to
<code>dir</code>)</p>
</li>
<li>
<p>The <code>&lt;id&gt;</code> is ignored since only a single assembly descriptor is
used (no need to distinguish multiple descriptors)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also you can inline the assembly description with a <code>inline</code> description
directly into the pom file. Adding the proper namespace even allows for
IDE autocompletion. As an example, refer to the profile <code>inline</code> in
the <code>data-jolokia-demo</code> 's pom.xml.</p>
</div>
<div class="paragraph">
<p>Alternatively <code>descriptorRef</code> can be used with the name of a
predefined assembly descriptor. The following symbolic names can be
used for <code>descriptorRef</code>:</p>
</div>
<table id="build-assembly-descriptor-refs" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Predefined Assembly Descriptors</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Assembly Reference</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>artifact-with-dependencies</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches project&#8217;s artifact and all its dependencies. Also, when a <code>classpath</code> file exists in the target directory, this will be added to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>artifact</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches only the project&#8217;s artifact but no dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>project</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches the whole Maven project but with out the <code>target/</code> directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rootWar</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies the artifact as <code>ROOT.war</code> to the exposed directory. I.e. Tomcat will then deploy the war under the root context.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;images&gt;</span>
  <span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;build&gt;</span>
      <span class="tag">&lt;assembly&gt;</span>
         <span class="tag">&lt;descriptorRef&gt;</span>artifact-with-dependencies<span class="tag">&lt;/descriptorRef&gt;</span>
         .....</code></pre>
</div>
</div>
<div class="paragraph">
<p>will add the created artifact with the name <code>${project.build.finalName}.${artifact.extension}</code> and all jar dependencies in the the <code>targetDir</code> (which is <code>/maven</code> by default).</p>
</div>
<div class="paragraph">
<p>All declared files end up in the configured <code>targetDir</code> (or <code>/maven</code> by default) in the created image.</p>
</div>
<div class="paragraph">
<div class="title">Maven peculiarities when including the artifact</div>
<p>If the assembly references the artifact to build with this pom, it is required that the <code>package</code> phase is included in the run. Otherwise the artifact file, can&#8217;t be found by <code>docker:build</code>. This is an old <a href="https://issues.apache.org/jira/browse/MASSEMBLY-94">outstanding issue</a> of the assembly plugin which probably can&#8217;t be fixed because of the way how Maven works. We tried hard to workaround this issue and in 90% of all cases, you won&#8217;t experience any problem. However, when the following warning happens which might lead to the given error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[WARNING] Cannot include project artifact: org.eclipse.jkube:helloworld:jar:0.20.0; it doesn't have an associated file or directory.
[WARNING] The following patterns were never triggered in this artifact inclusion filter:
o  'org.eclipse.jkube:helloworld'

[ERROR] DOCKER&gt; Failed to create assembly for docker image  (with mode 'dir'): Error creating assembly archive docker: You must set at least one file.</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you have two options to fix this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Call <code>mvn package jkube:build</code> to explicitly run "package" and "docker:build" in a chain.</p>
</li>
<li>
<p>Bind <code>build</code> to an to an execution phase in the plugin&#8217;s definition. By default <code>jkube:build</code> will bind to the <code>install</code> phase is set in an execution. Then you can use a plain <code>mvn install</code> for building the artifact and creating the image.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;executions&gt;</span>
  <span class="tag">&lt;execution&gt;</span>
    <span class="tag">&lt;id&gt;</span>docker-build<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;goals&gt;</span>
       <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
    <span class="tag">&lt;/goals&gt;</span>
  <span class="tag">&lt;/execution&gt;</span>
<span class="tag">&lt;/executions&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Example</div>
<p>In the following example a dependency from the pom.xml is included and
mapped to the name <code>jolokia.war</code>. With this configuration you will end
up with an image, based on <code>busybox</code> which has a directory <code>/maven</code>
containing a single file <code>jolokia.war</code>. This volume is also exported
automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assembly&gt;</span>
  <span class="tag">&lt;inline&gt;</span>
    <span class="tag">&lt;dependencySets&gt;</span>
      <span class="tag">&lt;dependencySet&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
          <span class="tag">&lt;include&gt;</span>org.jolokia:jolokia-war<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>.<span class="tag">&lt;/outputDirectory&gt;</span>
        <span class="tag">&lt;outputFileNameMapping&gt;</span>jolokia.war<span class="tag">&lt;/outputFileNameMapping&gt;</span>
      <span class="tag">&lt;/dependencySet&gt;</span>
    <span class="tag">&lt;/dependencySets&gt;</span>
  <span class="tag">&lt;/inline&gt;</span>
<span class="tag">&lt;/assembly&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another container can now connect to the volume an 'mount' the
<code>/maven</code> directory. A container  from <code>consol/tomcat-7.0</code> will look
into <code>/maven</code> and copy over everything to <code>/opt/tomcat/webapps</code> before
starting Tomcat.</p>
</div>
<div class="paragraph">
<p>If you are using the <code>artifact</code> or <code>artifact-with-dependencies</code> descriptor, it is
possible to change the name of the final build artifact with the following:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
  <span class="tag">&lt;finalName&gt;</span>your-desired-final-name<span class="tag">&lt;/finalName&gt;</span>
  ...
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note, based upon the following documentation listed <a href="http://maven.apache.org/pom.html#BaseBuild_Element">here</a>, there is no guarantee the plugin creating your artifact will honor it in which case you will need to use a custom descriptor like above to achieve the desired naming.</p>
</div>
<div class="paragraph">
<p>Currently the <code>jar</code> and <code>war</code> plugins properly honor the usage of <code>finalName</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="misc-env">5.2.8. Environment and Labels</h4>
<div class="paragraph">
<p>When creating a container one or more environment variables can be set via configuration with the <code>env</code> parameter</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;env&gt;</span>
  <span class="tag">&lt;JAVA_HOME&gt;</span>/opt/jdk8<span class="tag">&lt;/JAVA_HOME&gt;</span>
  <span class="tag">&lt;CATALINA_OPTS&gt;</span>-Djava.security.egd=file:/dev/./urandom<span class="tag">&lt;/CATALINA_OPTS&gt;</span>
<span class="tag">&lt;/env&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you put this configuration into profiles you can easily create various test variants with a single image (e.g. by switching the JDK or whatever).</p>
</div>
<div class="paragraph">
<p>It is also possible to set the environment variables from the outside of the plugin&#8217;s configuration with the parameter <code>envPropertyFile</code>. If given, this property file is used to set the environment variables where the keys and values specify the environment variable. Environment variables specified in this file override any environment variables specified in the configuration.</p>
</div>
<div class="paragraph">
<p>Labels can be set inline the same way as environment variables:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;labels&gt;</span>
   <span class="tag">&lt;com.example.label-with-value&gt;</span>foo<span class="tag">&lt;/com.example.label-with-value&gt;</span>
   <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>${project.artifactId}<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/labels&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="misc-startup">5.2.9. Startup Arguments</h4>
<div class="paragraph">
<p>Using <code>entryPoint</code> and <code>cmd</code> it is possible to specify the <a href="https://docs.docker.com/reference/builder/#entrypoint">entry point</a>
or <a href="https://docs.docker.com/reference/builder/#cmd">cmd</a> for a container.</p>
</div>
<div class="paragraph">
<p>The difference is, that an <code>entrypoint</code> is the command that always be executed, with the <code>cmd</code> as argument. If no <code>entryPoint</code> is provided, it defaults to <code>/bin/sh -c</code> so any <code>cmd</code> given is executed with a shell. The arguments given to <code>docker run</code> are always given as arguments to the
<code>entrypoint</code>, overriding any given <code>cmd</code> option. On the other hand if no extra arguments are given to <code>docker run</code> the default <code>cmd</code> is used as argument to <code>entrypoint</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>See this <a href="http://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile">stackoverflow question</a> for a detailed explanation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>An entry point or command can be specified in two alternative formats:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Entrypoint and Command Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>shell</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell form in which the whole line is given to <code>shell -c</code> for interpretation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exec</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of arguments (with inner <code>&lt;args&gt;</code>) arguments which will be given to the <code>exec</code> call directly without any shell interpretation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Either shell or params should be specified.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
   <span class="comment">&lt;!-- shell form  --&gt;</span>
   <span class="tag">&lt;shell&gt;</span>java -jar $HOME/server.jar<span class="tag">&lt;/shell&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
   <span class="comment">&lt;!-- exec form  --&gt;</span>
   <span class="tag">&lt;exec&gt;</span>
     <span class="tag">&lt;arg&gt;</span>java<span class="tag">&lt;/arg&gt;</span>
     <span class="tag">&lt;arg&gt;</span>-jar<span class="tag">&lt;/arg&gt;</span>
     <span class="tag">&lt;arg&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/arg&gt;</span>
   <span class="tag">&lt;/exec&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be formulated also more dense with:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- shell form  --&gt;</span>
<span class="tag">&lt;entryPoint&gt;</span>java -jar $HOME/server.jar<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
  <span class="comment">&lt;!-- exec form  --&gt;</span>
  <span class="tag">&lt;arg&gt;</span>java<span class="tag">&lt;/arg&gt;</span>
  <span class="tag">&lt;arg&gt;</span>-jar<span class="tag">&lt;/arg&gt;</span>
  <span class="tag">&lt;arg&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/arg&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">INFO</dt>
<dd>
<p>Startup arguments are not used in S2I builds</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="build-buildargs">5.2.10. Build Args</h4>
<div id="property-buildargs" class="paragraph">
<p>As described in section <a href="#build-configuration">Configuration</a> for external Dockerfiles <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build arg</a> can be used. In addition to the
configuration within the plugin configuration you can also use properties to specify them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set a system property when running Maven, eg.: <code>-Ddocker.buildArg.http_proxy=http://proxy:8001</code>. This is especially
useful when using predefined Docker arguments for setting proxies transparently.</p>
</li>
<li>
<p>Set a project property within the <code>pom.xml</code>, eg.:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;docker.buildArg.myBuildArg&gt;</span>myValue<span class="tag">&lt;/docker.buildArg.myBuildArg&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the system property setting will always override the project property. Also note that for all properties which are not Docker <a href="https://docs.docker.com/engine/reference/builder/#arg">predefined</a> properties, the external Dockerfile must contain an <code>ARGS</code> instruction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:push">5.3. <strong>k8s:push</strong></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Section needs review and rearrangements
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This goal uploads images to the registry which have a <code>&lt;build&gt;</code> configuration section. The images to push can be restricted with
the global option <code>filter</code> (see <a href="#global-configuration">Global Configuration</a> for details). The registry to push is by default <code>docker.io</code> but can be specified as part of the images&#8217;s <code>name</code> name the Docker way. E.g. <code>docker.test.org:5000/data:1.5</code> will push the image <code>data</code> with tag <code>1.5</code> to the registry <code>docker.test.org</code> at port <code>5000</code>. Security information (i.e. user and password) can be specified in multiple ways as described in section <a href="#authentication">Authentication</a>.</p>
</div>
<div class="paragraph">
<p>By default a progress meter is printed out on the console, which is omitted when using Maven in batch mode (option <code>-B</code>). A very simplified progress meter is provided when using no color output (i.e. with <code>-Ddocker.useColor=false</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Push options</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipPush</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> the plugin won&#8217;t push any images that have been built.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.push</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t push any tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pushRegistry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The registry to use when pushing the image. See <a href="#registry">Registry Handling</a> for
more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.push.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>retries</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often should a push be retried before giving up. This useful for flaky registries which tend to return 500 error codes from time to time. The default is 0 which means no retry at all.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.push.retries</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="k8s:apply">5.4. <strong>k8s:apply</strong></h3>
<div class="paragraph">
<p>This goals applies the resources created with <a href="#k8s:resource"><strong>k8s:resource</strong></a> to a connected Kubernetes cluster. It&#8217;s  similar to <a href="#k8s:deploy"><strong>k8s:deploy</strong></a> but does not the full deployment cycle of creating the resource, creating the application image and the sending the resource descriptors to the clusters. This goal can be easily bound to <code>&lt;executions&gt;</code> within the plugin&#8217;s configuration and binds by default to the <code>install</code> lifecycle phase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:apply</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:helm">5.5. <strong>k8s:helm</strong></h3>
<div class="paragraph">
<p>This goal is for creating <a href="https://github.com/kubernetes/helm/blob/master/docs/charts.md#the-chart-file-structure">Helm charts</a> for your Maven project so that you can install, update or delete your app in Kubernetes using <a href="https://github.com/kubernetes/helm">Helm</a>.</p>
</div>
<div class="paragraph">
<p>For creating a Helm chart you simply call <code>k8s:helm</code> goal on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:resource k8s:helm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>k8s:resource</code> goal is required to create the resource descriptors which are included in the Helm chart. If you have already built the resource then you can ommit this goal.</p>
</div>
<div class="paragraph">
<p>The configuration happens in a <code>&lt;helm&gt;</code> section within the plugin&#8217;s configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Helm configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;helm&gt;</span>
      <span class="tag">&lt;chart&gt;</span>Jenkins<span class="tag">&lt;/chart&gt;</span>
      <span class="tag">&lt;keywords&gt;</span>ci,cd,server<span class="tag">&lt;/keywords&gt;</span>
    <span class="tag">&lt;/helm&gt;</span>
    ...
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration section know the following subelements in order to configure your Helm chart.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Helm configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chart</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart name, which is <code>${project.artifactId}</code> if not given.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.chart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For which platform to generate the chart. By default this is <code>kubernetes</code>, but can be also <code>openshift</code> for using OpenShift specific resources in the chart. <em>Please note that there is no OpenShift support yet for charts, so this is experimental</em>. You can also add both values as a comma separated list.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sourceDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the resource descriptors generated with <code>k8s:resource</code>. By default this is <code>${basedir}/target/classes/META-INF/jkube., which is also the output directory used by `k8s:resource</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.sourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to create the the Helm chart, which is <code>${basedir}/target/jkube.helm</code> by default for Kubernetes (and <code>${basedir}/target/jkube.helmshift</code> for OpenShift).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.outputDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>keywords</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of keywords to add to the chart</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>engine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The template engine to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chartExtension</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Helm chart file extension, default value is <code>tar.gz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.helm.chartExtension</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In a next step you can install this via the <a href="https://github.com/kubernetes/helm/releases">helm command line tool</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">helm install target/jkube.helm/kubernetes</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add the <code>helm</code> goal to your project so that it is automatically executed just add the <code>helm</code> goal to the <code>executions</code> section of the <code>kubernetes-maven-plugin</code> section of your <code>pom.xml</code>.</p>
</div>
<div class="listingblock">
<div class="title">Add helm goal</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>deploy<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition this goal will also create a tar-archive below <code>${basedir}/target</code> which contains the chart with its template. This tar is added as an aritfact with classifier <code>helm</code> to the build (<code>helmshift</code> for the OpenShift mode).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goals-overview-develop">6. Development Goals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="k8s:deploy">6.1. <strong>k8s:deploy</strong></h3>
<div class="paragraph">
<p>This is the main goal for building your docker image, generating the kubernetes resources and deploying them into the cluster (insofar your pom.xml is set up correct; keep reading :)).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This goal is designed to run <a href="#k8s:build"><strong>k8s:build</strong></a> and <a href="#k8s:resource"><strong>k8s:resource</strong></a> before the deploy <strong>*iff</strong> you have the goals bound in your pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>

  <span class="comment">&lt;!-- Connect k8s:resource, k8s:build and k8s:helm to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>jkube<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Effectively this builds your project then invokes these goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#k8s:build"><strong>k8s:build</strong></a></p>
</li>
<li>
<p><a href="#k8s:apply"><strong>k8s:apply</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default the behaviour of resource goal is it generates <code>route.yml</code> for a service if you have not done any configuration changes. Sometimes there may be case when you want to generate route.yml but do not want to create route resource on OpenShift Cluster. This can be achieved by the following configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example for not generating route resource on your cluster</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;enricher&gt;</span>
            <span class="tag">&lt;excludes&gt;</span>
                <span class="tag">&lt;exclude&gt;</span>jkube-expose<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;/enricher&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:undeploy">6.2. <strong>k8s:undeploy</strong></h3>
<div class="paragraph">
<p>This goal is for deleting the kubernetes resources that you deployed via the  <a href="#k8s:run">[k8s:run]</a> or <a href="#k8s:deploy"><strong>k8s:deploy</strong></a> goals</p>
</div>
<div class="paragraph">
<p>It iterates through all the resources generated by the <a href="#k8s:resource"><strong>k8s:resource</strong></a> goal and deletes them from your current kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:undeploy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:log">6.3. <strong>k8s:log</strong></h3>
<div class="paragraph">
<p>This goal tails the log of the app that you deployed via the <a href="#k8s:deploy"><strong>k8s:deploy</strong></a> goal</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:log</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then terminate the output by hitting <code>Ctrl+C</code></p>
</div>
<div class="paragraph">
<p>If you wish to get the log of the app and then terminate immediately then try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:log -Djkube.log.follow=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lets you pipe the output into grep or some other tool</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:log -Djkube.log.follow=false | grep Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your app is running in multiple pods you can configure the pod name to log via the <code>jkube.log.pod</code> property, otherwise it defaults to the latest pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:log -Djkube.log.pod=foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your pod has multiple containers you can configure the container name to log via the <code>jkube.log.container</code> property, otherwise it defaults to the first container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:log -Djkube.log.container=foo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:debug">6.4. <strong>k8s:debug</strong></h3>
<div class="paragraph">
<p>This goal enables debugging in your Java app and then port forwards from localhost to the latest running pod of your app so that you can easily debug your app from your Java IDE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then follow the on screen instructions.</p>
</div>
<div class="paragraph">
<p>The default debug port is <code>5005</code>. If you wish to change the local port to use for debugging then pass in the <code>jkube.debug.port</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:debug -Djkube.debug.port=8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your IDE you start a Remote debug execution using this remote port using localhost and you should be able to set breakpoints and step through your code.</p>
</div>
<div class="paragraph">
<p>This lets you debug your apps while they are running inside a Kubernetes cluster - for example if you wish to debug a REST endpoint while another pod is invoking it.</p>
</div>
<div class="paragraph">
<p>Debug is enabled via the <code>JAVA_ENABLE_DEBUG</code> environment variable being set to <code>true</code>. This environment variable is used for all the standard Java docker images used by Spring Boot, flat classpath and executable JAR projects and Wildfly Swarm. If you use your own custom docker base image you may wish to also respect this environment variable too to enable debugging.</p>
</div>
<div class="sect3">
<h4 id="speeding-up-debugging">6.4.1. Speeding up debugging</h4>
<div class="paragraph">
<p>By default the <code>k8s:debug</code> goal has to edit your Deployment to enable debugging then wait for a pod to start. It might be in development you frequently want to debug things and want to speed things up a bit.</p>
</div>
<div class="paragraph">
<p>If so you can enable debug mode for each build via the <code>jkube.debug.enabled</code> property.</p>
</div>
<div class="paragraph">
<p>e.g. you can pass this property on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:deploy -Djkube.debug.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can add something like this to your <code>~/.m2/settings.xml</code> file so that you enable debug mode for all maven builds on your laptop by using a profile :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;settings&gt;</span>
  <span class="tag">&lt;profiles&gt;</span>
    <span class="tag">&lt;profile&gt;</span>
      <span class="tag">&lt;id&gt;</span>enable-debug<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;activeByDefault&gt;</span>true<span class="tag">&lt;/activeByDefault&gt;</span>
      <span class="tag">&lt;/activation&gt;</span>
      <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;jkube.debug.enabled&gt;</span>true<span class="tag">&lt;/jkube.debug.enabled&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/profile&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then whenever you type the <code>k8s:debug</code> goal there is no need for the maven goal to edit the <code>Deployment</code> and wait for a pod to restart; we can immediately start debugging when you type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:debug</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="debugging-with-suspension">6.4.2. Debugging with suspension</h4>
<div class="paragraph">
<p>The <code>k8s:debug</code> goal allows to attach a remote debugger to a running container, but the application is free to execute when the debugger is not attached.
In some cases, you may want to have complete control on the execution, e.g. to investigate the application behavior at startup. This can be done using the <code>jkube.debug.suspend</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:debug -Djkube.debug.suspend</code></pre>
</div>
</div>
<div class="paragraph">
<p>The suspend flag will set the <code>JAVA_DEBUG_SUSPEND</code> environment variable to <code>true</code> and <code>JAVA_DEBUG_SESSION</code> to a random number in your deployment.
When the <code>JAVA_DEBUG_SUSPEND</code> environment variable is set, standard docker images will use <code>suspend=y</code> in the JVM startup options for debugging.</p>
</div>
<div class="paragraph">
<p>The <code>JAVA_DEBUG_SESSION</code> environment variable is always set to a random number (each time you run the debug goal with the suspend flag) in order to tell Kubernetes to restart the pod.
The remote application will start only after a remote debugger is attached. You can use the remote debugging feature of your IDE to connect (on <code>localhost</code>, port <code>5005</code> by default).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>jkube.debug.suspend</code> flag will disable readiness probes in the Kubernetes deployment in order to start port-forwarding during the early phases of application startup
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="k8s:watch">6.5. <strong>k8s:watch</strong></h3>
<div class="paragraph">
<p>This goal is used to monitor the project workspace for changes and automatically trigger a redeploy of the application
running on Kubernetes.</p>
</div>
<div class="paragraph">
<p>In order to use k8s:watch for spring-boot, you need to make sure that <code>devtools</code> is included in the repacked
archive, as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>		&lt;plugin&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;configuration&gt;
				&lt;excludeDevtools&gt;false&lt;/excludeDevtools&gt;
			&lt;/configuration&gt;
		&lt;/plugin&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to set a <code>spring.devtools.remote.secret</code> in application.properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.devtools.remote.secret=mysecret</pre>
</div>
</div>
<div class="paragraph">
<p>Before entering the watch mode, this goal must generate the docker image and the Kubernetes resources
(optionally including some development libraries/configuration),
and deploy the app on Kubernetes. Lifecycle bindings should be configured as follows to allow
the generation of such resources.</p>
</div>
<div class="listingblock">
<div class="title">Lifecycle bindings for k8s:watch</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any application having <code>resource</code> and <code>build</code> goals bound to the lifecycle, the following
command can be used to run the watch task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn k8s:watch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This plugin supports different watcher providers, enabled automatically if the project satisfies certain conditions.</p>
</div>
<div class="paragraph">
<p>Watcher providers can also be configured manually. The <a href="#generator-example">Generator example</a> is a good blueprint, simply replace <code>&lt;generator&gt;</code> with <code>&lt;watcher&gt;</code>. The configuration is structurally identical.</p>
</div>
<div class="sect3">
<h4 id="watcher-spring-boot">6.5.1. Spring Boot</h4>
<div class="paragraph">
<p>This watcher is enabled by default for all Spring Boot projects. It performs the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploys your application with Spring Boot DevTools enabled</p>
</li>
<li>
<p>tails the log of the latest running pod for your application</p>
</li>
<li>
<p>watches the local development build of your Spring Boot based application and then triggers a reload of the application when there are changes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can try it on any spring boot application via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn k8s:watch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the goal starts up the spring boot RemoteSpringApplication it will watch for local development changes.</p>
</div>
<div class="paragraph">
<p>e.g. if you edit the java code of your app and then build it via something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see your app reload on the fly in the shell running the <a href="#k8s:watch"><strong>k8s:watch</strong></a> goal!</p>
</div>
<div class="paragraph">
<p>There is also support for LiveReload as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="watcher-docker-image">6.5.2. Docker Image</h4>
<div class="paragraph">
<p>This is a generic watcher that can be used in Kubernetes mode only. Once activated, it listens for changes in the project workspace
 in order to trigger a redeploy of the application.</p>
</div>
<div class="paragraph">
<p>The watcher can be activated e.g. by running this command in another shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>The watcher will detect that the binary artifact has changed and will first rebuild the docker image,
then start a redeploy of the Kubernetes pod.</p>
</div>
<div class="paragraph">
<p>It uses the watch feature of the <a href="https://dmp.jkube.io/#docker:watch">docker-maven-plugin</a> under the hood.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generators">7. Generators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usual way to define Docker images is with the plugin configuration as explained in <a href="#k8s:build"><strong>k8s:build</strong></a>. This can either be done completely within the <code>pom.xml</code> or by referring to an external Dockerfile. Since kubernetes-maven-plugin includes <a href="https://github.com/jkubeio/docker-maven-plugin">docker-maven-plugin</a> the way by which images are built is identical.</p>
</div>
<div class="paragraph">
<p>However, this plugin provides an additional route for defining image configurations. This is done by so called <em>Generators</em>. A generator is a Java component providing an auto-detection mechanism for certain build types like a Spring Boot build or a plain Java build. As soon as a <em>Generator</em> detects that it is applicable it will be called with the list of images configured in the <code>pom.xml</code>. Typically a generator only creates dynamically a new image configuration if this list is empty. But a generator is free to also add new images to an existing list or even change the current image list.</p>
</div>
<div class="paragraph">
<p>You can easily create your own generator as explained in <a href="#generators-api">Generator API</a>. This section will focus on existing generators and how you can configure them.</p>
</div>
<div class="paragraph">
<p>The included <em>Generators</em> are enabled by default, but you can easily disable them or only select a certain set of generators. Each generator has a <em>name</em>, which is unique for a generator.</p>
</div>
<div class="paragraph">
<p>The generator configuration is embedded in a <code>&lt;generator&gt;</code> configuration section:</p>
</div>
<div id="generator-example" class="listingblock">
<div class="title">Example for a generator configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  ....
  <span class="tag">&lt;configuration&gt;</span>
    ....
    <span class="tag">&lt;generator&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;includes&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;include&gt;</span>spring-boot<span class="tag">&lt;/include&gt;</span>
      <span class="tag">&lt;/includes&gt;</span>
      <span class="tag">&lt;config&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tag">&lt;spring-boot&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
          <span class="tag">&lt;alias&gt;</span>ping<span class="tag">&lt;/alias&gt;</span>
        <span class="tag">&lt;/spring-boot&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/generator&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start of generators' configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generators can be included and excluded. Includes have precedence, and the generators are called in the given order.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuration for individual generators.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The config is a map of supported config values. Each section is embedded in a tag named after the generator.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sub-elements are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Generator configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;includes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one ore more <code>&lt;include&gt;</code> elements with generator names which should be included. If given only this list of generators are included in this given order. The order is important because by default only the first matching generator kicks in. The generators from every active profile are included, too. However the generators listed here are moved to the front of the list, so that they are called first. Use the profile <code>raw</code> if you want to explicitly set the complete list of generators.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;excludes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>&lt;exclude&gt;</code> elements with generator names to exclude. If set then all detected generators are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all generators. Each generator support a specific set of configuration values as described in the documentation. The subelements of this section are generator names to configure. E.g. for generator <code>spring-boot</code>, the sub-element is called <code>&lt;spring-boot&gt;</code>. This element then holds the specific generator configuration like <code>&lt;name&gt;</code> for specifying the final image name. See above for an example. Configuration coming from profiles are merged into this config, but not overriding the configuration specified here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Beside specifying generator configuration in the plugin&#8217;s configuration it can be set directly with properties, too:</p>
</div>
<div class="listingblock">
<div class="title">Example generator property config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Djkube.generator.spring-boot.alias=&quot;myapp&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general scheme is a prefix <code>jkube.generator.</code> followed by the unique generator name and then the generator specific key.</p>
</div>
<div class="paragraph">
<p>In addition to the provided default <em>Generators</em> described in the next section <a href="#generators-default">Default Generators</a>, custom generators can be easily added. There are two ways to include generators:</p>
</div>
<div class="paragraph">
<div class="title">Plugin dependency</div>
<p>You can declare the generator holding jars as dependency to this plugin as shown in this example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  ....
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>io.acme<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>mygenerator<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>1.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Compile time dependency</div>
<p>Alternatively and if your application code comes with a custom generator you can set the global configuration option <code>useProjectClasspath</code> (property: <code>jkube.useProjectClasspath</code>) to true. In this case also the project artifact and its dependencies are looked up for <em>Generators</em>. See <a href="#generators-api">Generator API</a> for details how to write your own generators.</p>
</div>
<div class="sect2">
<h3 id="generators-default">7.1. Default Generators</h3>
<div class="paragraph">
<p>All default generators examine the build information for certain aspects and generate a Docker build configuration on the fly. They can be configured to a certain degree, where the configuration is generator specific.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Default Generators</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Generator</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-java-exec">Java Applications</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java-exec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic generator for flat classpath and fat-jar Java applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-spring-boot">Spring Boot</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring-boot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Boot specific generator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-wildfly-swarm">Wildfly Swarm</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wildfly-swarm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Wildfly Swarm apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-thorntail-v2">Thorntail v2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thorntail-v2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Thorntail v2 apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-vertx">Vert.x</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Vert.x applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-karaf">Karaf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>karaf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Karaf based apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-webapp">Web applications</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>webapps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for WAR based applications supporting Tomcat, Jetty and Wildfly base images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generator-quarkus">Quarkus</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Quarkus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generator for Quarkus based applications</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are some configuration options which are shared by all generators:</p>
</div>
<table id="generator-options-common" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Common generator options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>add</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this set to <code>true</code>, then the generator <em>adds</em> to an existing image configuration. By default this is disabled, so that a generator only kicks in when there are no other image configurations in the build, which are either configured directly for a <code>k8s:build</code> or already added by a generator which has been run previously.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias name for referencing this image in various other parts of the configuration. This is also used in the log output. The default alias name is the name of the generator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.alias</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the base image from where to start when creating the images. By default the generators make an opinionated decision for the base image which are described in the respective generator section.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.from</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>fromMode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whe using OpenShift S2I builds the base image can be either a plain docker image (mode: <code>docker</code>) or a reference to an <a href="https://docs.openshift.com/container-platform/3.3/architecture/core_concepts/builds_and_image_streams.html"> ImageStreamTag</a> (mode: <code>istag</code>). In the case of an ImageStreamTag, <code>from</code> has to be specified in the form <code>namespace/image-stream:tag</code>. The mode takes only effect when running in OpenShift mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.fromMode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Docker image name used when doing Docker builds. For OpenShift S2I builds its the name of the image stream. This can be a pattern as descibed in <a href="#image-name-placeholders">Name Placeholders</a>. The default is <code>%g/%a:%l</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A optional Docker registry used when doing Docker builds. It has no effect for OpenShift S2I builds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.generator.registry</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When used as properties they can be directly referenced with the property names above.</p>
</div>
<div class="sect3">
<h4 id="generator-java-exec">7.1.1. Java Applications</h4>
<div class="paragraph">
<p>One of the most generic <em>Generators</em> is the <code>java-exec</code> generator.
It is responsible for starting up arbitrary Java application.
It knows how to deal with fat-jar applications where the application and all dependencies are included within a single jar and the <code>MANIFEST.MF</code> within the jar references a main class.
But also flat classpath applications, where the dependencies are separate jar files and a main class is given.</p>
</div>
<div class="paragraph">
<p>If no main class is explicitly configured, the plugin first attempts to locate a fat jar.
If the Maven build creates a JAR file with a <code>META-INF/MANIFEST.MF</code> containing a <code>Main-Class</code> entry, then this is considered to be the fat jar to use.
If there are more than one of such files then the largest one is used.</p>
</div>
<div class="paragraph">
<p>If a main class is configured (see below) then the image configuration will contain the application jar plus all dependency jars.
If no main class is configured as well as no fat jar being detected, then this <em>Generator</em> tries to detect a single main class by searching for <code>public static void main(String args[])</code> among the application classes. If exactly one class is found this is considered to be the main class. If no or more than one is found the <em>Generator</em> finally does nothing.</p>
</div>
<div class="paragraph">
<p>It will use the following base image by default, but as explained <a href="#generator-options-common">above</a> and can be changed with the <code>from</code> configuration.</p>
</div>
<table id="generator-java-exec-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Java Base Images</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 30.7692%;">
<col style="width: 30.7692%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
<th class="tableblock halign-left valign-top">ImageStream</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Community</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.java-jboss-openjdk8-jdk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.s2i-java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.java</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Red Hat</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-java-openshift</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-java-openshift</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fis-java-openshift</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These images always refer to the latest tag. The <em>Red Hat</em> base images are selected, when the plugin itself is a Red Hat supported version (which is detected by the plugins version number).</p>
</div>
<div class="paragraph">
<p>When a <code>fromMode</code> of <code>istag</code> is used to specify an <code>ImageStreamTag</code> and when no <code>from</code> is given, then as default the <code>ImageStreamTag</code> <code>fis-java-openshift</code> in the namespace <code>openshift</code> is chosen. If you are using a RedHat variation of this plugin (i.e. if the version is ending with <code>-redhat</code>), then a <code>fromMode</code> of <code>istag</code> is the default, otherwise its <code>fromMode = "docker"</code> which use the a plain Docker image reference for the S2I builder image.</p>
</div>
<div class="paragraph">
<p>Beside the common configuration parameters described in the table <a href="#generator-options-common">common generator options</a> the following additional configuration options are recognized:</p>
</div>
<table id="generator-java-exec-options" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Java Application configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>assemblyRef</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a reference to an assembly is given, then this is used without trying to detect the artifacts to include.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory within the generated image where to put the detected artefacts into. Change this only if the base image is changed, too.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/deployments</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jolokiaPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Jolokia agent exposed by the base image. Set this to 0 if you don&#8217;t want to expose the Jolokia port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8778</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mainClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main class to call. If not given first a check is performed to detect a fat-jar (see above). Next a class is looked up by scanning <code>target/classes</code> for a single class with a main method. If no such class is found or if more than one is found, then this generator does nothing.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>prometheusPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Prometheus jmx_exporter exposed by the base image. Set this to 0 if you don&#8217;t want to expose the Prometheus port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9779</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>webPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose as service, which is supposed to be the port of a web application. Set this to 0 if you don&#8217;t want to expose a port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The exposed ports are typically later on use by <a href="#enrichers">Enrichers</a> to create default Kubernetes or OpenShift services.</p>
</div>
<div class="paragraph">
<p>You can add additional files to the target image within <code>baseDir</code> by placing files into <code>src/main/jkube-includes</code>. These will be added with mode <code>0644</code>, while everything in <code>src/main/jkube-includes/bin</code> will be added with <code>0755</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-spring-boot">7.1.2. Spring Boot</h4>
<div class="paragraph">
<p>This generator is called <code>spring-boot</code> and gets activated when it finds a <code>spring-boot-maven-plugin</code> in the pom.xml.</p>
</div>
<div class="paragraph">
<p>This generator is based on the <a href="#generator-java-exec">Java Application</a> Generator and inherits all of its configuration values. The generated container port is read from the <code>server.port</code> property <code>application.properties</code>, defaulting to <code>8080</code> if it is not found. It also uses the same default images as the <a href="#generator-java-exec-from">java-exec Generator</a>.</p>
</div>
<div class="paragraph">
<p>Beside the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options">java-exec options</a> the following additional configuration is recognized:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Spring-Boot configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>color</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If seth force the use of color in the Spring Boot console output.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The generator adds Kubernetes liveness and readiness probes pointing to either the management or server port as read from the <code>application.properties</code>.
If the <code>management.port</code> (for Spring Boot 1) or <code>management.server.port</code> (for Spring Boot 2) and <code>management.ssl.key-store</code> (for Spring Boot 1) or <code>management.server.ssl.key-store</code> (for Spring Boot 2) properties are set in <code>application.properties</code> otherwise or <code>server.ssl.key-store</code> property is set in <code>application.properties</code> then the probes are automatically set to use <code>https</code>.</p>
</div>
<div class="paragraph">
<p>The generator works differently when called together with <code>k8s:watch</code>.
In that case it enables support for <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html">Spring Boot Developer Tools</a> which allows for hot reloading of the Spring Boot app.
In particular, the following steps are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a secret token is not provided within the Spring Boot application configuration <code>application.properties</code> or <code>application.yml</code> with the key <code>spring.devtools.remote.secret</code> then a custom secret token is created and added to <code>application.properties</code></p>
</li>
<li>
<p>Add <code>spring-boot-devtools.jar</code> as <code>BOOT-INF/lib/spring-devtools.jar</code> to the spring-boot fat jar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since during <code>k8s:watch</code> the application itself within the <code>target/</code> directory is modified for allowing easy reloading you must ensure that you do a <code>mvn clean</code> before building an artefact which should be put into production.
Since the released version are typically generated with a CI system which does a clean build anyway this should be only a theoretical problem.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-wildfly-swarm">7.1.3. Wildfly Swarm</h4>
<div class="paragraph">
<p>The WildFly Swarm generator detects a WildFly Swarm build and disables the Prometheus Java agent because of this <a href="https://issues.jboss.org/browse/THORN-1859">issue</a>.</p>
</div>
<div class="paragraph">
<p>Otherwise this generator is identical to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-thorntail-v2">7.1.4. Thorntail v2</h4>
<div class="paragraph">
<p>The Thorntail v2 generator detects a Thorntail v2 build and disables the Prometheus Java agent because of this <a href="https://issues.jboss.org/browse/THORN-1859">issue</a>.</p>
</div>
<div class="paragraph">
<p>Otherwise this generator is identical to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="generator-vertx">7.1.5. Vert.x</h4>
<div class="paragraph">
<p>The Vert.x generator detects an application using Eclipse Vert.x. It generates the metadata to start the application as a fat jar.</p>
</div>
<div class="paragraph">
<p>Currently, this generator is enabled if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you are using the Vert.x Maven Plugin (<a href="https://github.com/reactiverse/vertx-maven-plugin" class="bare">https://github.com/reactiverse/vertx-maven-plugin</a>)</p>
</li>
<li>
<p>you are depending on <code>io.vertx:vertx-core</code> and uses the Maven Shader plugin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Otherwise this generator is identical to the <a href="#generator-java-exec">java-exec generator</a>. It supports the  <a href="#generator-options-common">common generator options</a> and the <a href="#generator-java-exec-options"><code>java-exec</code> options</a>.</p>
</div>
<div class="paragraph">
<p>The generator automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enable metrics and JMX publishing of the metrics when <code>io.vertx:vertx-dropwizard-metrics</code> is in the project&#8217;s classpath / dependencies.</p>
</li>
<li>
<p>enable clustering when a Vert.x cluster manager is available in the project&#8217;s classpath / dependencies. this is done by appending <code>-cluster</code> to the command line.</p>
</li>
<li>
<p>Force IPv4 stack when <code>vertx-infinispan</code> is used.</p>
</li>
<li>
<p>Disable the async DNS resolver to fallback to the regular JVM DNS resolver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can pass application parameter by setting the <code>JAVA_ARGS</code> env variable. You can pass system properties either using the same variable or using <code>JAVA_OPTIONS</code>. For instance, create <code>src/main/jkube/deployment.yml</code> with the following content to configure <code>JAVA_ARGS</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
 <span class="key">template</span>:
   <span class="key">spec</span>:
     <span class="key">containers</span>:
       - <span class="string"><span class="content">env:</span></span>
         - <span class="string"><span class="content">name: JAVA_ARGS</span></span>
           <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">-Dfoo=bar -cluster -instances=2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generator-karaf">7.1.6. Karaf</h4>
<div class="paragraph">
<p>This generator named <code>karaf</code> kicks in when the build uses a <code>karaf-maven-plugin</code>. By default the following base images are used:</p>
</div>
<table id="generator-karaf-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Karaf Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Community</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.s2i-karaf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.s2i-karaf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Red Hat</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-karaf-openshift</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-karaf-openshift</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a <code>fromMode</code> of <code>istag</code> is used to specify an <code>ImageStreamTag</code> and when no <code>from</code> is given, then as default the <code>ImageStreamTag</code> <code>fis-karaf-openshift:2.0</code> in the namespace <code>openshift</code> is chosen.</p>
</div>
<div class="paragraph">
<p>In addition to the  <a href="#generator-options-common">common generator options</a> this generator can be configured with the following options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Karaf configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>baseDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory within the generated image where to put the detected artefacts into. Change this only if the base image is changed, too.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/deployments</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jolokiaPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Jolokia agent exposed by the base image. Set this to 0 if you don&#8217;t want to expose the Jolokia port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8778</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mainClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main class to call. If not given first a check is performed to detect a fat-jar (see above). Next a class is tried to be found by scanning <code>target/classes</code> for a single class with a main method. If no if found or more than one is found, then this generator does nothing.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User and/or group under which the files should be added. The syntax of this options is descriped in <a href="#config-image-build-assembly-user">Assembly Configuration</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss:jboss:jboss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>webPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose as service, which is supposed to be the port of a web application. Set this to 0 if you don&#8217;t want to expose a port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="generator-webapp">7.1.7. Web Applications</h4>
<div class="paragraph">
<p>The <code>webapp</code> generator tries to detect WAR builds and selects a base servlet container image based on the configuration found in the <code>pom.xml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>Tomcat</strong> base image is selected when a <code>tomcat6-maven-plugin</code> or <code>tomcat7-maven-plugin</code> is present or when a <code>META-INF/context.xml</code> could be found in the classes directory.</p>
</li>
<li>
<p>A <strong>Jetty</strong> base image is selected when a <code>jetty-maven-plugin</code> is present or one of the files <code>WEB-INF/jetty-web.xml</code> or <code>WEB-INF/jetty-logging.properties</code> is found.</p>
</li>
<li>
<p>A <strong>Wildfly</strong> base image is chosen for a given <code>jboss-as-maven-plugin</code> or <code>wildfly-maven-plugin</code> or when a Wildfly specific deployment descriptor like <code>jboss-web.xml</code> is found.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The base images chosen are:</p>
</div>
<table id="generator-webapp-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Webapp Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tomcat</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.tomcat-8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Jetty</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jkube.jetty-9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Wildfly</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss/wildfly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>S2I builds are currently not yet supported for the webapp generator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to the  <a href="#generator-options-common">common generator options</a> this generator can be configured with the following options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Webapp configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>server</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix server to use in the base image. Can be either <strong>tomcat</strong>, <strong>jetty</strong> or <strong>wildfly</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>targetDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to put the war file into the target image. By default its selected by the base image chosen but can be overwritten with this option.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User and/or group under which the files should be added. The syntax of this options is descriped in <a href="#config-image-build-assembly-user">Assembly Configuration</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>path</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context path with which the application can be reached by default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code> (root context)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cmd</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to use to start the container. By default the base images startup command is used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of ports to expose in the image and which eventually are translated later to Kubernertes services. The ports depend on the base image and are selecte automatically. But they can be overwritten here.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="generator-quarkus">7.1.8. Quarkus</h4>
<div class="paragraph">
<p>The <code>Quarkus</code> generator tried to detect quarkus based projects looking at project <code>pom.xml</code>:</p>
</div>
<div class="paragraph">
<p>The base images chosen are:</p>
</div>
<table id="generator-quarkus-from" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Webapp Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Native</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.fedoraproject.org/fedora-minimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Normal Build</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openjdk:11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>S2I builds are currently not yet supported for the Quarkus generator.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generators-api">7.2. Generator API</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The API is still a bit in flux and will be documented later. Please refer to the  <a href="https://github.com/jkubeio/kubernetes-maven-plugin/blob/master/generator/api/src/main/java/org.eclipse.jkube/maven/generator/api/Generator.java">Generator</a> Interface in the meantime.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enrichers">8. Enrichers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enriching is the complementary concept to <a href="#generators">Generators</a>. Whereas Generators are used to create and customize Docker images, Enrichers are use to create and customize Kubernetes resource objects.</p>
</div>
<div class="paragraph">
<p>There are a lot of similarities to Generators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Enricher has a unique name.</p>
</li>
<li>
<p>Enrichers are looked up automatically from the plugin dependencies and there is a set of default enrichers delivered with this plugin.</p>
</li>
<li>
<p>Enrichers are configured the same ways as generators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#generator-example">Generator example</a> is a good blueprint, simply replace <code>&lt;generator&gt;</code> with <code>&lt;enricher&gt;</code>. The configuration is structural identical:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Enricher configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;includes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one ore more <code>&lt;include&gt;</code> elements with enricher names which should be included. If given, only this list of enrichers are included in this order. The enrichers from every active profile are included, too. However the enrichers listed here are moved to the front of the list, so that they are called first. Use the profile <code>raw</code> if you want to explicitly set the complete list of enrichers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;excludes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>&lt;exclude&gt;</code> elements with enricher names to exclude. This means all the detected enrichers are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all enrichers. Each enricher supports a specific set of configuration values as described in its documentation. The subelements of this section are enricher names. E.g. for enricher <code>jkube-service</code>, the sub-element is called <code>&lt;jkube-service&gt;</code>. This element then holds the specific enricher configuration like <code>&lt;name&gt;</code> for the service name. Configuration coming from profiles are merged into this config, but not overriding the configuration specified here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This plugin comes with a set of default enrichers. In addition custom enrichers can be easily added by providing implementation of the <a href="#enricher-api">Enricher API</a> and adding these as a dependency to the build.</p>
</div>
<div class="sect2">
<h3 id="enrichers-default">8.1. Default Enrichers</h3>
<div class="paragraph">
<p>kubernetes-maven-plugin comes with a set of enrichers which are enabled by default. There are two categories of default enrichers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Generic Enrichers</strong> are used to add default resource object when they are missing or add common metadata extracted from the given build information</p>
</li>
<li>
<p><strong>Specific Enrichers</strong> are enrichers which are focused on a certain tech stack that they detect.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Default Enrichers Overview</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enricher</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-prometheus">jkube-prometheus</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Prometheus annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-maven-scm-enricher">jkube-maven-scm-enricher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Maven SCM information as annotations to the kubernetes/openshift resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-controller">jkube-controller</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create default controller (replication controller, replica set or deployment) if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-dependency">jkube-dependency</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Examine build dependencies for <code>kubernetes.yml</code> and add the objects found therein.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-git">jkube-git</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check local <code>.git</code> directory and add build information as annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-image">jkube-image</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add the image name into a <code>PodSpec</code> of replication controller, replication sets and deployments, if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-name">jkube-name</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a default name to every object which misses a name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-pod-annotation">jkube-pod-annotation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy over annotations from a <code>Deployment</code> to a <code>Pod</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-portname">jkube-portname</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a default portname for commonly known service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-project-label">jkube-project-label</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Maven coordinates as labels to all objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-service">jkube-service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a default service if missing and extract ports from the Docker image configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-maven-issue-mgmt-enricher">jkube-maven-issue-mgmt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Maven Issue Management information as annotations to the kubernetes/openshift resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-revision-history-enricher">jkube-revision-history</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add revision history limit (<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#revision-history-limit">Kubernetes doc</a>) as a deployment spec property to the Kubernetes/OpenShift resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-triggers-annotation">jkube-triggers-annotation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ImageStreamTag change triggers on Kubernetes resources such as StatefulSets, ReplicaSets and DaemonSets using the <code>image.openshift.io/triggers</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-configmap-file">jkube-configmap-file</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ConfigMap elements defined as XML or as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-secret-file">jkube-secret-file</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Secret elements defined as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jkube-jkube-serviceaccount">[jkube-jkube-serviceaccount]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a ServiceAccount defined as XML or mentioned in resource fragement.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="enrichers-standard">8.1.1. Standard Enrichers</h4>
<div class="paragraph">
<p>Default enrichers are used for adding missing resources or adding metadata to given resource objects. The following default enhancers are available out of the box</p>
</div>
<div class="sect4">
<h5 id="jkube-controller">jkube-controller</h5>

</div>
<div class="sect4">
<h5 id="jkube-service">jkube-service</h5>
<div class="paragraph">
<p>This enricher is used to ensure that a service is present.
This can be either directly configured with fragments or with the XML configuration, but it can be also automatically inferred by looking at the ports exposed by an image configuration.
An explicit configuration always takes precedence over auto detection. For enriching an existing service this enricher actually works only on a configured service which matches with the configured (or inferred) service name.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table id="enricher-jkube-service" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Default service enricher</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name to enrich by default. If not given here or configured elsewhere, the artifactId is used</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>headless</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether a headless service without a port should be configured. A headless service has the <code>ClusterIP</code> set to <code>None</code> and will be only used if no ports are exposed by the image configuration or by the configuration <code>port</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>expose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a label <code>expose</code> with value <code>true</code> is added which can be picked up by the jkube.https://github.com/jkubeio/exposecontroller[expose-controller] to expose the service to the outside by various means. See the documentation of expose-controller for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes / OpenShift service type to set like <em>LoadBalancer</em>, <em>NodePort</em> or <em>ClusterIP</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service port to use. By default the same port as the ports exposed in the image configuration is used, but can be changed with this parameter. See <a href="#jkube-service-ports">below</a> for a detailed description of the format which can be put into this variable.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>multiPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to <code>true</code> if you want all ports to be exposed from an image configuration. Otherwise only the first port is used as a service port.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>protocol</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default protocol to use for the services. Must be <code>tcp</code> or <code>udp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>normalizePort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize the port numbering of the service to common and conventional port numbers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Following is the Port mapping that comes in effect, when normalizePort option is set true.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalized Port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8081</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8181</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You specify the properties like for any enricher within the enrichers configuration like in</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  ..
  <span class="tag">&lt;enricher&gt;</span>
    <span class="tag">&lt;config&gt;</span>
      <span class="tag">&lt;jkube-service&gt;</span>
        <span class="tag">&lt;name&gt;</span>my-service<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;type&gt;</span>NodePort<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;multiPort&gt;</span>true<span class="tag">&lt;/multiPort&gt;</span>
      <span class="tag">&lt;/jkube-service&gt;</span>
    <span class="tag">&lt;/config&gt;</span>
  <span class="tag">&lt;/enricher&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div id="jkube-service-ports" class="paragraph">
<div class="title">Port specification</div>
<p>With the option <code>port</code> you can influence the mapping how ports are mapped from the pod to the service.
By default and if this option is not given the ports exposed are dictated by the ports exposed from the Docker images contained in the pods.
Remember, each image configured can be part of the pod.
However you can expose also completely different ports as the images meta data declare.</p>
</div>
<div class="paragraph">
<p>The property <code>port</code> can contain a comma separated list of mappings of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&lt;servicePort1&gt;:&lt;targetPort1&gt;/&lt;protocol&gt;,&lt;servicePort2&gt;:&lt;targetPort2&gt;/&lt;protocol&gt;,....</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>targetPort</code> and <code>&lt;protocol&gt;</code> specification is optional. These ports are overlayed over the ports exposed by the images, in the given order.</p>
</div>
<div class="paragraph">
<p>This is best explained by some examples.</p>
</div>
<div class="paragraph">
<p>For example if you have a pod which exposes a Microservice on port 8080 and you want to expose it as a service on port 80 (so that it can be accessed with <code><a href="http://myservice" class="bare">http://myservice</a></code>)  you can simply use the following enricher configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;enricher&gt;</span>
    <span class="tag">&lt;config&gt;</span>
      <span class="tag">&lt;jkube-service&gt;</span>
        <span class="tag">&lt;name&gt;</span>myservice<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;port&gt;</span>80:8080<span class="tag">&lt;/port&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;/jkube-service&gt;</span>
    <span class="tag">&lt;/config&gt;</span>
  <span class="tag">&lt;/enricher&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>80 is the service port, 8080 the port opened in from the pod&#8217;s images</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your pod <em>exposes</em> their ports (which e.g. all generator do), then you can even omit the 8080 here (i.e. <code>&lt;port&gt;80&lt;/port&gt;</code>).
In this case the <em>first</em> port exposed will be mapped to port 80, all other exposed ports will be omitted.</p>
</div>
<div class="paragraph">
<p>By default an automatically generated service only exposes the first port, even when more ports are exposed.
When you want to map multiple ports you need to set the config option <code>&lt;multiPort&gt;true&lt;/multiPort&gt;</code>.
In this case you can also provide multiple mappings as a comma separated list in the <code>&lt;port&gt;</code> specification where each element of the list are the mapping for the first, second, &#8230;&#8203; port.</p>
</div>
<div class="paragraph">
<p>A more (and bit artificially constructed) specification could be <code>&lt;port&gt;80,9779:9779/udp,443&lt;/port&gt;</code>.
Assuming that the image exposes ports <code>8080</code> and <code>8778</code> (either directly or via <a href="#generators">generators</a>) and we have switched on multiport mode, then the following service port mappings will be performed for the automatically generated service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod port 8080 is mapped to service port 80.</p>
</li>
<li>
<p>Pod port 9779 is mapped to service port 9779 with protocol UDP. Note how this second entry overrides the pod exposed port 8778.</p>
</li>
<li>
<p>Pod port 443 is mapped to service port 443.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example show also the mapping rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Port specification in <code>port</code> always override the port meta data of the contained Docker images (i.e. the ports exposed)</p>
</li>
<li>
<p>You can always provide a complete mapping with <code>port</code> on your own</p>
</li>
<li>
<p>The ports exposed by the images serve as <em>default values</em> which are used if not specified by this configuration option.</p>
</li>
<li>
<p>You can map ports which are <em>not</em> exposed by the images by specifying them as target ports.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Multiple ports are <strong>only</strong> mapped when <em>multiPort</em> mode is enabled (which is switched off by default). If <em>multiPort</em> mode is disabled, only the first port from the list of mapped ports as calculated like above is taken.</p>
</div>
<div class="paragraph">
<p>When you set <code>legacyPortMapping</code> to true than ports 8080 to 9090 are mapped to port 80 automatically if not explicitly mapped via <code><em>port</em></code>. I.e. when an image exposes port 8080 with a legacy mapping this mapped to a service port 80, not 8080. You <em>should not</em> switch this on for any good reason. In fact it might be that this option can vanish anytime.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-image">jkube-image</h5>

</div>
<div class="sect4">
<h5 id="jkube-name">jkube-name</h5>

</div>
<div class="sect4">
<h5 id="jkube-portname">jkube-portname</h5>

</div>
<div class="sect4">
<h5 id="jkube-pod-annotation">jkube-pod-annotation</h5>

</div>
<div class="sect4">
<h5 id="jkube-project-label">jkube-project-label</h5>
<div class="paragraph">
<p>Enricher that adds standard labels and selectors to generated resources (e.g. <code>app</code>, <code>group</code>, <code>provider</code>, <code>version</code>).</p>
</div>
<div class="paragraph">
<p>The <code>jkube-project-label</code> enricher supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 54.5454%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useProjectLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable this flag to turn on the generation of the old <code>project</code> label in Kubernetes resources. The <code>project</code> label has been replaced by the <code>app</code> label in newer versions of the plugin.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The project labels which are already specified in the input fragments are not overridden by the enricher.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-git">jkube-git</h5>
<div class="paragraph">
<p>Enricher that adds info from .git directory as annotations.</p>
</div>
<div class="paragraph">
<p>The git branch &amp; latest commit on the branch are annotated as jkube.git-branch &amp; jkube.git-commit.
fabrci8/git-url is annotated as the url of your configured remote.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 54.5454%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gitRemote</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the git remote name, whose url you want to annotate as 'git-url'.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>origin</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="jkube-dependency">jkube-dependency</h5>

</div>
<div class="sect4">
<h5 id="jkube-volume-permission">jkube-volume-permission</h5>
<div class="paragraph">
<p>Enricher which fixes the permission of persistent volume mount with the help of an init container.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-autotls">jkube-openshift-autotls</h5>
<div class="paragraph">
<p>Enricher which adds appropriate annotations and volumes to enable OpenShift&#8217;s automatic <a href="https://docs.openshift.org/latest/dev_guide/secrets.html#service-serving-certificate-secrets">Service Serving Certificate Secrets</a>.
This enricher adds an init container to convert the service serving certificates from PEM (the format that OpenShift generates them in) to
a JKS-format Java keystore ready for consumption in Java services.</p>
</div>
<div class="paragraph">
<p>This enricher is disabled by default. In order to use it, you must configure the Kubernetes Maven plugin to use this enricher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.3.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;enricher&gt;</span>
      <span class="tag">&lt;includes&gt;</span>
        <span class="tag">&lt;include&gt;</span>jkube-openshift-autotls<span class="tag">&lt;/include&gt;</span>
      <span class="tag">&lt;/includes&gt;</span>
      <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-openshift-autotls&gt;</span>
          ...
        <span class="tag">&lt;/jkube-openshift-autotls&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/enricher&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The auto-TLS enricher supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 54.5454%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tlsSecretName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret to be used to store the generated service serving certs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;project.artifactId&gt;-tls</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tlsSecretVolumeMountPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the service serving secret should be mounted to in the pod.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/run/secrets/jkube.io/tls-pem</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tlsSecretVolumeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret volume.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tls-pem</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jksVolumeMountPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the generated keystore volume should be mounted to in the pod.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/run/secrets/jkube.io/tls-jks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jksVolumeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore volume.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tls-jks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pemToJKSInitContainerImage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the image used as an init container to convert PEM certificate/key to Java keystore.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jimmidyson/pemtokeystore:v0.1.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pemToJKSInitContainerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the init container to convert PEM certificate/key to Java keystore.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tls-jks-converter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystoreFileName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the generated keystore file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystore.jks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystorePassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to use for the generated keystore.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keystoreCertAlias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The alias in the keystore used for the imported service serving certificate.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>[[enrichers-jkube]
=== Jkube Enrichers
Jkube enrichers are used for providing the connection to other components of the jkube.Microservices platform. They are useful to add icons to to application or links to documentation sites.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-karaf">jkube-healthcheck-karaf</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Apache Karaf. This requires that
 <code>jkube.karaf-checks</code> has been enabled in the Karaf startup features.</p>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8181</code></p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>failureThreshold = <code>3</code></p>
</li>
<li>
<p>successThreshold = <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and use paths <code>/readiness-check</code> for readiness check and <code>/health-check</code> for liveness check.</p>
</div>
<div class="paragraph">
<p>These options cannot be configured.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-prometheus">jkube-prometheus</h5>
<div class="paragraph">
<p>This enricher adds Prometheus annotation like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">List</span></span>
<span class="key">items</span>:
- <span class="string"><span class="content">apiVersion: v1</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
  <span class="key">metadata</span>:
    <span class="key">annotations</span>:
      <span class="key">prometheus.io/scrape</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">prometheus.io/port</span>: <span class="string"><span class="content">9779</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the enricher inspects the images' BuildConfiguration and add the annotations if the port 9779 is listed.
You can force the plugin to add annotations by setting enricher&#8217;s config <code><code>prometheusPort</code></code></p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-webapp">jkube-healthcheck-webapp</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with WebApp. This requires that you have <code>maven-war-plugin</code> set.</p>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code></p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = ``</p>
</li>
<li>
<p>initialReadinessDelay = 10</p>
</li>
<li>
<p>initialLivenessDelay = 180</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>path</code> attribute is not set (default value) then this enricher is disabled.</p>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-maven-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.3.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;goals&gt;</span>
          <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
          <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
          <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;enricher&gt;</span>
      <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-healthcheck-webapp&gt;</span>
          <span class="tag">&lt;path&gt;</span>/<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/jkube-healthcheck-webapp&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/enricher&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
    ...
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-spring-boot">jkube-healthcheck-spring-boot</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Spring Boot. This requires the following dependency
 has been enabled in Spring Boot</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;dependency&gt;</span>
     <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
     <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will try to discover the settings from the <code>application.properties</code> / <code>application.yaml</code> Spring Boot configuration file.</p>
</div>
<div class="paragraph">
<p>The port number is read from the <code>management.port</code> option, and will use the default value of <code>8080</code>
The scheme will use HTTPS if <code>server.ssl.key-store</code> option is in use, and fallback to use <code>HTTP</code> otherwise.</p>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readinessProbeInitialDelaySeconds</code> : <code>10</code></p>
</li>
<li>
<p><code>readinessProbePeriodSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>livenessProbeInitialDelaySeconds</code> : <code>180</code></p>
</li>
<li>
<p><code>livenessProbePeriodSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>timeoutSeconds</code> : <em>&lt;kubernetes-default&gt;</em></p>
</li>
<li>
<p><code>failureThreshold</code>: <code>3</code></p>
</li>
<li>
<p><code>successThreshold</code>: <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-maven-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.3.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
          <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
              <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
          <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;enricher&gt;</span>
            <span class="tag">&lt;config&gt;</span>
              <span class="tag">&lt;jkube-healthcheck-spring-boot&gt;</span>
                <span class="tag">&lt;timeoutSeconds&gt;</span>5<span class="tag">&lt;/timeoutSeconds&gt;</span>
                <span class="tag">&lt;readinessProbeInitialDelaySeconds&gt;</span>30<span class="tag">&lt;/readinessProbeInitialDelaySeconds&gt;</span>
                <span class="tag">&lt;failureThreshold&gt;</span>3<span class="tag">&lt;/failureThreshold&gt;</span>
                <span class="tag">&lt;successThreshold&gt;</span>1<span class="tag">&lt;/successThreshold&gt;</span>
              <span class="tag">&lt;/jkube-healthcheck-spring-boot&gt;</span>
            <span class="tag">&lt;/config&gt;</span>
          <span class="tag">&lt;/enricher&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-wildfly-swarm">jkube-jkube-healthcheck-wildfly-swarm</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with WildFly Swarm. This requires the following fraction
 has been enabled in WildFly Swarm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;dependency&gt;</span>
     <span class="tag">&lt;groupId&gt;</span>org.wildfly.swarm<span class="tag">&lt;/groupId&gt;</span>
     <span class="tag">&lt;artifactId&gt;</span>microprofile-health<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code></p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = <code>/health</code></p>
</li>
<li>
<p>failureThreshold = <code>3</code></p>
</li>
<li>
<p>successThreshold = <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-maven-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.3.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
          <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
              <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
          <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;enricher&gt;</span>
            <span class="tag">&lt;config&gt;</span>
              <span class="tag">&lt;jkube-healthcheck-wildfly-swarm&gt;</span>
                <span class="tag">&lt;port&gt;</span>4444<span class="tag">&lt;/port&gt;</span>
                <span class="tag">&lt;scheme&gt;</span>HTTPS<span class="tag">&lt;/scheme&gt;</span>
                <span class="tag">&lt;path&gt;</span>health/myapp<span class="tag">&lt;/path&gt;</span>
                <span class="tag">&lt;failureThreshold&gt;</span>3<span class="tag">&lt;/failureThreshold&gt;</span>
                <span class="tag">&lt;successThreshold&gt;</span>1<span class="tag">&lt;/successThreshold&gt;</span>
              <span class="tag">&lt;/jkube-healthcheck-wildfly-swarm&gt;</span>
            <span class="tag">&lt;/config&gt;</span>
          <span class="tag">&lt;/enricher&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-thorntail-v2">jkube-healthcheck-thorntail-v2</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Thorntail v2. This requires the following fraction
 has been enabled in Thorntail</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;dependency&gt;</span>
     <span class="tag">&lt;groupId&gt;</span>io.thorntail<span class="tag">&lt;/groupId&gt;</span>
     <span class="tag">&lt;artifactId&gt;</span>microprofile-health<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The enricher will use the following settings by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code></p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = <code>/health</code></p>
</li>
<li>
<p>failureThreshold = <code>3</code></p>
</li>
<li>
<p>successThreshold = <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be configured by the enricher in the <code>kubernetes-maven-plugin</code> configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.3.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
          <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
              <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
          <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;enricher&gt;</span>
            <span class="tag">&lt;config&gt;</span>
              <span class="tag">&lt;jkube-healthcheck-thorntail&gt;</span>
                <span class="tag">&lt;port&gt;</span>4444<span class="tag">&lt;/port&gt;</span>
                <span class="tag">&lt;scheme&gt;</span>HTTPS<span class="tag">&lt;/scheme&gt;</span>
                <span class="tag">&lt;path&gt;</span>health/myapp<span class="tag">&lt;/path&gt;</span>
                <span class="tag">&lt;failureThreshold&gt;</span>3<span class="tag">&lt;/failureThreshold&gt;</span>
                <span class="tag">&lt;successThreshold&gt;</span>1<span class="tag">&lt;/successThreshold&gt;</span>
              <span class="tag">&lt;/jkube-healthcheck-thorntail&gt;</span>
            <span class="tag">&lt;/config&gt;</span>
          <span class="tag">&lt;/enricher&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-healthcheck-vertx">jkube-healthcheck-vertx</h5>
<div class="paragraph">
<p>This enricher adds kubernetes readiness and liveness probes with Eclipse Vert.x applications. The readiness probe lets Kubernetes
detects when the application is ready, while the liveness probe allows Kubernetes to verify that the application is
still alive.</p>
</div>
<div class="paragraph">
<p>This enricher allows configuring the readiness and liveness probes. Are supported: <code>http</code> (emit HTTP requests), <code>tcp</code> (open a socket), <code>exec</code> (execute a command).</p>
</div>
<div class="paragraph">
<p>By default, this enricher uses the same configuration for liveness and readiness probes. But specific configurations can be provided. The configurations can be overridden using project&#8217;s properties.</p>
</div>
<div class="sect5">
<h6 id="using-the-jkube-healthcheck-vertx-enricher">Using the jkube-healthcheck-vertx enricher</h6>
<div class="paragraph">
<p>The enricher is automatically executed if your project uses the <code>vertx-maven-plugin</code> or depends on <code>io.vertx:vertx-core</code>.
However, by default, no health check will be added to your deployment.</p>
</div>
</div>
<div class="sect5">
<h6 id="minimal-configuration">Minimal configuration</h6>
<div class="paragraph">
<p>The minimal configuration to add health checks is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;enricher&gt;</span>
      <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
            <span class="tag">&lt;path&gt;</span>/health<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/enricher&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It configures the readiness and liveness health checks using HTTP requests on the port <code>8080</code> (default port) and on the path <code>/health</code>. The defaults are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>port = <code>8080</code> (for HTTP)</p>
</li>
<li>
<p>scheme = <code>HTTP</code></p>
</li>
<li>
<p>path = <em>none</em> (disabled)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>the previous configuration can also be given use project&#8217;s properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;vertx.health.path&gt;</span>/health<span class="tag">&lt;/vertx.health.path&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuring-differently-the-readiness-and-liveness-health-checks">Configuring differently the readiness and liveness health checks</h6>
<div class="paragraph">
<p>You can provide two different configuration for the readiness and liveness checks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;enricher&gt;</span>
      <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
            <span class="tag">&lt;readiness&gt;</span>
              <span class="tag">&lt;path&gt;</span>/ready<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/readiness&gt;</span>
            <span class="tag">&lt;liveness&gt;</span>
              <span class="tag">&lt;path&gt;</span>/health<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/enricher&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>readiness</code> and <code>liveness</code> chunks in user properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;vertx.health.readiness.path&gt;</span>/ready<span class="tag">&lt;/vertx.health.readiness.path&gt;</span>
    <span class="tag">&lt;vertx.health.liveness.path&gt;</span>/ready<span class="tag">&lt;/vertx.health.liveness.path&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shared (generic) configuration can be set outside of the specific configuration. For instance, to use the port 8081:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.1.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>fmp<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;enricher&gt;</span>
      <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
            <span class="tag">&lt;port&gt;</span>8081<span class="tag">&lt;/port&gt;</span>
            <span class="tag">&lt;readiness&gt;</span>
              <span class="tag">&lt;path&gt;</span>/ready<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/readiness&gt;</span>
            <span class="tag">&lt;liveness&gt;</span>
              <span class="tag">&lt;path&gt;</span>/health<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/enricher&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;vertx.health.port&gt;</span>8081<span class="tag">&lt;/vertx.health.port&gt;</span>
    <span class="tag">&lt;vertx.health.readiness.path&gt;</span>/ready<span class="tag">&lt;/vertx.health.readiness.path&gt;</span>
    <span class="tag">&lt;vertx.health.liveness.path&gt;</span>/ready<span class="tag">&lt;/vertx.health.liveness.path&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuration-structure">Configuration Structure</h6>
<div class="paragraph">
<p>The configuration is structured as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
    <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
        <span class="comment">&lt;!-- Generic configuration, applied to both liveness and readiness --&gt;</span>
        <span class="tag">&lt;path&gt;</span>/both<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;liveness&gt;</span>
            <span class="comment">&lt;!-- Specific configuration for the liveness probe --&gt;</span>
            <span class="tag">&lt;port-name&gt;</span>ping<span class="tag">&lt;/port-name&gt;</span>
        <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;readiness&gt;</span>
            <span class="comment">&lt;!-- Specific configuration for the readiness probe --&gt;</span>
            <span class="tag">&lt;port-name&gt;</span>ready<span class="tag">&lt;/port-name&gt;</span>
        <span class="tag">&lt;/readiness&gt;</span>
    <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same structured is used in project&#8217;s properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Generic configuration given as vertx.health.$attribute --&gt;</span>
<span class="tag">&lt;vertx.health.path&gt;</span>/both<span class="tag">&lt;/vertx.health.path&gt;</span>
<span class="comment">&lt;!-- Specific liveness configuration given as vertx.health.liveness.$attribute --&gt;</span>
<span class="tag">&lt;vertx.health.liveness.port-name&gt;</span>ping<span class="tag">&lt;/vertx.health.liveness.port-name&gt;</span>
<span class="comment">&lt;!-- Specific readiness configuration given as vertx.health.readiness.$attribute --&gt;</span>
<span class="tag">&lt;vertx.health.readiness.port-name&gt;</span>ready<span class="tag">&lt;/vertx.health.readiness.port-name&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Important</strong>: Project&#8217;s properties override the configuration provided in the plugin configuration. The overriding rules are:
<em>specific properties</em> &gt; <em>generic properties</em> &gt; <em>specific configuration</em> &gt; <em>generic configuration</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="probe-configuration">Probe configuration</h6>
<div class="paragraph">
<p>You can configure the different aspect of the probes. These attributes can be configured for both the readiness and liveness probes or be specific to one.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Probe configuration</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The probe type among <code>http</code> (default), <code>tcp</code> and <code>exec</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial-delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after the container has started before probes are initiated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often (in seconds) to perform the probe.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds after which the probe times out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>success-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive successes for the probe to be considered successful after having failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failure-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum consecutive failures for the probe to be considered failed after having succeeded.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>More details about probes are available on <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" class="bare">https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="http-probe-configuration">HTTP probe configuration</h6>
<div class="paragraph">
<p>When using HTTP <code>GET</code> requests to determine readiness or liveness, several aspects can be configured. HTTP probes are used by default. To be more specific set the <code>type</code> attribute to <code>http</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. HTTP probes configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheme</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme to use for connecting to the host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTTP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to access on the HTTP server. An empty path disable the check</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom headers to set in the request. HTTP allows repeated headers. Cannot be configured using project&#8217;s properties. An example is available below.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of the port to access on the container. A 0 or negative number disable the check.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the port to access on the container. If neither the <code>port</code> or the <code>port-name</code> is set, the check is disabled. If both are set the configuration is considered invalid.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of HTTP probe configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
    <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
        <span class="tag">&lt;initialDelay&gt;</span>3<span class="tag">&lt;/initialDelay&gt;</span>
        <span class="tag">&lt;period&gt;</span>3<span class="tag">&lt;/period&gt;</span>
        <span class="tag">&lt;liveness&gt;</span>
            <span class="tag">&lt;port&gt;</span>8081<span class="tag">&lt;/port&gt;</span>
            <span class="tag">&lt;path&gt;</span>/ping<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;scheme&gt;</span>HTTPS<span class="tag">&lt;/scheme&gt;</span>
            <span class="tag">&lt;headers&gt;</span>
                <span class="tag">&lt;X-Custom-Header&gt;</span>Awesome<span class="tag">&lt;/X-Custom-Header&gt;</span>
            <span class="tag">&lt;/headers&gt;</span>
        <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;readiness&gt;</span>
            <span class="comment">&lt;!-- disable the readiness probe --&gt;</span>
            <span class="tag">&lt;port&gt;</span>-1<span class="tag">&lt;/port&gt;</span>
        <span class="tag">&lt;/readiness&gt;</span>
    <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="tcp-probe-configuration">TCP probe configuration</h6>
<div class="paragraph">
<p>You can also configure the probes to just open a socket on a specific port. The <code>type</code> attribute must be set to <code>tcp</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. TCP probes configuration</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of the port to access on the container. A 0 or negative number disable the check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the port to access on the container. If neither the <code>port</code> or the <code>port-name</code> is set, the check is disabled. If both are set the configuration is considered invalid.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
    <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
        <span class="tag">&lt;initialDelay&gt;</span>3<span class="tag">&lt;/initialDelay&gt;</span>
        <span class="tag">&lt;period&gt;</span>3<span class="tag">&lt;/period&gt;</span>
        <span class="tag">&lt;liveness&gt;</span>
            <span class="tag">&lt;type&gt;</span>tcp<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;port&gt;</span>8081<span class="tag">&lt;/port&gt;</span>
        <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;readiness&gt;</span>
            <span class="tag">&lt;--</span> <span class="attribute-name">use</span> <span class="attribute-name">HTTP</span> <span class="attribute-name">Get</span> <span class="attribute-name">probe</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
            <span class="tag">&lt;path&gt;</span>/ping<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;port&gt;</span>8080<span class="tag">&lt;/port&gt;</span>
        <span class="tag">&lt;/readiness&gt;</span>
    <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="exec-probe-configuration">Exec probe configuration</h6>
<div class="paragraph">
<p>You can also configure the probes to execute a command. If the command succeeds, it returns 0, and Kubernetes consider the pod to be alive and healthy. If the command returns a non-zero value, Kubernetes kills the pod and restarts it. To use a command, you must set the <code>type</code> attribute to <code>exec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
    <span class="tag">&lt;jkube-healthcheck-vertx&gt;</span>
        <span class="tag">&lt;initialDelay&gt;</span>3<span class="tag">&lt;/initialDelay&gt;</span>
        <span class="tag">&lt;period&gt;</span>3<span class="tag">&lt;/period&gt;</span>
        <span class="tag">&lt;liveness&gt;</span>
            <span class="tag">&lt;type&gt;</span>exec<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;command&gt;</span>
                <span class="tag">&lt;cmd&gt;</span>cat<span class="tag">&lt;/cmd&gt;</span>
                <span class="tag">&lt;cmd&gt;</span>/tmp/healthy<span class="tag">&lt;/cmd&gt;</span>
            <span class="tag">&lt;/command&gt;</span>
        <span class="tag">&lt;/liveness&gt;</span>
        <span class="tag">&lt;readiness&gt;</span>
            <span class="tag">&lt;--</span> <span class="attribute-name">use</span> <span class="attribute-name">HTTP</span> <span class="attribute-name">Get</span> <span class="attribute-name">probe</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
            <span class="tag">&lt;path&gt;</span>/ping<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;port&gt;</span>8080<span class="tag">&lt;/port&gt;</span>
        <span class="tag">&lt;/readiness&gt;</span>
    <span class="tag">&lt;/jkube-healthcheck-vertx&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the snippet above the command is passed using the <code>command</code> attribute. This attribute cannot be configured using project&#8217;s properties. An empty command disables the check.</p>
</div>
</div>
<div class="sect5">
<h6 id="disabling-health-checks">Disabling health checks</h6>
<div class="paragraph">
<p>You can disables the checks by setting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>port</code> to 0 or to a negative number for <code>http</code> and <code>tcp</code> probes</p>
</li>
<li>
<p>the <code>command</code> to an empty list for <code>exec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first case, you can use project&#8217;s properties to disable them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Disables <code>tcp</code> and <code>http</code> probes --&gt;</span>
<span class="tag">&lt;vertx.health.port&gt;</span>-1<span class="tag">&lt;/vertx.health.port&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>http</code> probes, an empty or not set <code>path</code> also disable the probe.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-maven-scm-enricher">jkube-maven-scm-enricher</h5>
<div class="paragraph">
<p>This enricher adds additional <a href="https://maven.apache.org/pom.html#SCM">SCM</a> related metadata to all objects supporting annotations.
These metadata will be added only if <a href="https://maven.apache.org/pom.html#SCM">SCM</a> information is present in the maven <code>pom.xml</code> of the project.</p>
</div>
<div class="paragraph">
<p>The following annotations will be added to the objects that supports annotations,</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Maven SCM Enrichers Annotation Mapping</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Maven SCM Info</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scm/connection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/scm-con-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SCM connection that will be used to connect to the project&#8217;s SCM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scm/developerConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/scm-devcon-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SCM Developer Connection that will be used to connect to the project&#8217;s developer SCM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scm/tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/scm-tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SCM tag that will be used to checkout the sources, like HEAD dev-branch etc.,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scm/url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/scm-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SCM web url that can be used to browse the SCM over web browser</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lets say you have a maven pom.xml with the following scm information,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;scm&gt;</span>
    <span class="tag">&lt;connection&gt;</span>scm:git:git://github.com/jkubeio/kubernetes-maven-plugin.git<span class="tag">&lt;/connection&gt;</span>
    <span class="tag">&lt;developerConnection&gt;</span>scm:git:git://github.com/jkubeio/kubernetes-maven-plugin.git<span class="tag">&lt;/developerConnection&gt;</span>
    <span class="tag">&lt;url&gt;</span>git://github.com/jkubeio/kubernetes-maven-plugin.git<span class="tag">&lt;/url&gt;</span>
<span class="tag">&lt;/scm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This infomation will be enriched as annotations in the generated manifest like,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">...</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
  <span class="key">metadata</span>:
    <span class="error">annotations</span>
      <span class="key">jkube.io/scm-con-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">scm:git:git://github.com/jkubeio/kubernetes-maven-plugin.git</span><span class="delimiter">&quot;</span></span>
      <span class="key">jkube.io/scm-devcon-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">scm:git:git://github.com/jkubeio/kubernetes-maven-plugin.git</span><span class="delimiter">&quot;</span></span>
      <span class="key">jkube.io/scm-tag</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HEAD</span><span class="delimiter">&quot;</span></span>
      <span class="key">jkube.io/scm-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">git://github.com/jkubeio/kubernetes-maven-plugin.git</span><span class="delimiter">&quot;</span></span>
<span class="head"><span class="head">...</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-maven-issue-mgmt-enricher">jkube-maven-issue-mgmt</h5>
<div class="paragraph">
<p>This enricher adds additional <a href="https://maven.apache.org/pom.html#Issue_Management">Issue Management</a> related metadata to all objects supporting annotations.
These metadata will be added only if the <a href="https://maven.apache.org/pom.html#Issue_Management">Issue Management</a> information in available in maven <code>pom.xml</code> of the project.</p>
</div>
<div class="paragraph">
<p>The following annotations will be added to the objects that supports annotations,</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Maven Issue Tracker Enrichers Annotation Mapping</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Maven Issue Tracker Info</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">issueManagement/system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/issue-system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Issue Management system like Bugzilla, JIRA, GitHub etc.,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">issueManagement/url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jkube.io/issue-tracker-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Issue Management url e.g. GitHub Issues Url</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lets say you have a maven pom.xml with the following issue management information,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;issueManagement&gt;</span>
   <span class="tag">&lt;system&gt;</span>GitHub<span class="tag">&lt;/system&gt;</span>
   <span class="tag">&lt;url&gt;</span>https://github.com/reactiverse/vertx-maven-plugin/issues/<span class="tag">&lt;/url&gt;</span>
<span class="tag">&lt;/issueManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This information will be enriched as annotations in the generated manifest like,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">...</span></span>
  <span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
  <span class="key">metadata</span>:
    <span class="key">annotations</span>:
      <span class="key">jkube.io/issue-system</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GitHub</span><span class="delimiter">&quot;</span></span>
      <span class="key">jkube.io/issue-tracker-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/reactiverse/vertx-maven-plugin/issues/</span><span class="delimiter">&quot;</span></span>
<span class="head"><span class="head">...</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-revision-history-enricher">jkube-revision-history</h5>
<div class="paragraph">
<p>This enricher adds <code>spec.revisionHistoryLimit</code> property to deployment spec of Kubernetes/OpenShift resources.
A deployment’s revision history is stored in the replica sets, that specifies the number of old ReplicaSets to retain in order to allow rollback.
For more information read <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#revision-history-limit">Kubernetes documentation</a>.</p>
</div>
<div class="paragraph">
<p>The following configuration parameters can be used to influence the behaviour of this enricher:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Default revision history enricher</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of revision histories to retain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Just as any other enricher you can specify required properties with in the enricher&#8217;s configuration as below,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enricher&gt;</span>
    <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-revision-history&gt;</span>
            <span class="tag">&lt;limit&gt;</span>8<span class="tag">&lt;/limit&gt;</span>
        <span class="tag">&lt;/jkube-revision-history&gt;</span>
    <span class="tag">&lt;/config&gt;</span>
<span class="tag">&lt;/enricher&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This information will be enriched as spec property in the generated manifest like,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">...</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">spec</span>:
  <span class="key">revisionHistoryLimit</span>: <span class="string"><span class="content">8</span></span>
<span class="head"><span class="head">...</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-triggers-annotation">jkube-triggers-annotation</h5>
<div class="paragraph">
<p>This enricher adds ImageStreamTag change triggers on Kubernetes resources that support the <code>image.openshift.io/triggers</code> annotation, such as StatefulSets, ReplicaSets and DaemonSets.</p>
</div>
<div class="paragraph">
<p>The trigger is added to all containers that apply, but can be restricted to a limited set of containers using the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enricher&gt;</span>
    <span class="tag">&lt;config&gt;</span>
        <span class="tag">&lt;jkube-triggers-annotation&gt;</span>
            <span class="tag">&lt;containers&gt;</span>container-name-1,c2<span class="tag">&lt;/containers&gt;</span>
        <span class="tag">&lt;/jkube-triggers-annotation&gt;</span>
    <span class="tag">&lt;/config&gt;</span>
<span class="tag">&lt;/enricher&gt;</span>
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jkube-configmap-file">jkube-configmap-file</h5>
<div class="paragraph">
<p>This enricher adds ConfigMap defined as <code>resources</code> in plugin configuration and/or resolves file content from an annotation.</p>
</div>
<div class="paragraph">
<p>As XML you can define:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;resources&gt;</span>
    <span class="tag">&lt;configMap&gt;</span>
      <span class="tag">&lt;name&gt;</span>myconfigmap<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;entries&gt;</span>
        <span class="tag">&lt;entry&gt;</span>
          <span class="tag">&lt;name&gt;</span>A<span class="tag">&lt;/name&gt;</span>
          <span class="tag">&lt;value&gt;</span>B<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/entry&gt;</span>
       <span class="tag">&lt;/entries&gt;</span>
    <span class="tag">&lt;/configMap&gt;</span>
  <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a ConfigMap data with key <code>A</code> and value <code>B</code>.</p>
</div>
<div class="paragraph">
<p>You can also use <code>file</code> tag to refer to the content of a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;resources&gt;</span>
    <span class="tag">&lt;configMap&gt;</span>
      <span class="tag">&lt;name&gt;</span>configmap-test<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;entries&gt;</span>
        <span class="tag">&lt;entry&gt;</span>
          <span class="tag">&lt;file&gt;</span>src/test/resources/test-application.properties<span class="tag">&lt;/file&gt;</span>
        <span class="tag">&lt;/entry&gt;</span>
       <span class="tag">&lt;/entries&gt;</span>
    <span class="tag">&lt;/configMap&gt;</span>
  <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a ConfigMap with key <code>test-application.properties</code> and value the content of the <code>src/test/resources/test-application.properties</code> file.
If you set <code>name</code> tag then this is used as key instead of the filename.</p>
</div>
<div class="paragraph">
<p>If you are defining a custom <code>ConfigMap</code> file, you can use an annotation to define a file name as key and its content as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">${project.artifactId}</span></span>
  <span class="key">annotations</span>:
    <span class="key">maven.jkube.io/cm/application.properties</span>: <span class="string"><span class="content">src/test/resources/test-application.properties</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>ConfigMap</code> data with key <code>application.properties</code> (part defined after <code>cm</code>) and value the content of <code>src/test/resources/test-application.properties</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="jkube-secret-file">jkube-secret-file</h5>
<div class="paragraph">
<p>This enricher adds Secret defined as file content from an annotation.</p>
</div>
<div class="paragraph">
<p>If you are defining a custom <code>Secret</code> file, you can use an annotation to define a file name as key and its content as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">${project.artifactId}</span></span>
  <span class="key">annotations</span>:
    <span class="key">maven.jkube.io/secret/application.properties</span>: <span class="string"><span class="content">src/test/resources/test-application.properties</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>Secret</code> data with the key <code>application.properties</code> (part defined after <code>secret</code>) and value content of <code>src/test/resources/test-application.properties</code> file (base64 encoded).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enricher-api">8.2. Enricher API</h3>
<div class="paragraph">
<p><em>how to write your own enricher and install them</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profiles">9. Profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Profiles can be used to combine a set of enrichers and generators and to give this combination a referable name.</p>
</div>
<div class="paragraph">
<p>Profiles are defined in YAML. The following example shows a simple profiles which uses only the <a href="#generator-spring-boot">Spring Boot generator</a> and some enrichers adding for adding default resources:</p>
</div>
<div class="listingblock">
<div class="title">Profile Definition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: my-spring-boot-apps </span></span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">generator</span>: <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">includes</span>:
      - <span class="string"><span class="content">spring-boot</span></span>
  <span class="key">enricher</span>: <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">includes</span>: <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="comment"># Default Deployment object</span>
      - <span class="string"><span class="content">jkube-controller</span></span>
      <span class="comment"># Add a default service</span>
      - <span class="string"><span class="content">jkube-service</span></span>
    <span class="key">excludes</span>: <i class="conum" data-value="5"></i><b>(5)</b>
      - <span class="string"><span class="content">jkube-icon</span></span>
    <span class="key">config</span>: <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="key">jkube-service</span>:
        <span class="comment"># Expose service as NodePort</span>
        <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span>
  <span class="key">order</span>: <span class="string"><span class="content">10 </span></span><i class="conum" data-value="7"></i><b>(7)</b>
- <span class="string"><span class="content">name: another-profile</span></span>
  <span class="error">....</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Profile&#8217;s name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#generators">Generators</a> to use</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#enrichers">Enrichers</a> to use</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>List of enricher to <strong>include</strong> in that given order</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>List of enricher to <strong>exclude</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Configuration for services an enrichers</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>An order which influences the way how profiles with the same name are merged</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <code>profiles.yml</code> has a list of profiles which are defined with these elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Profile elements</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile name. This plugin comes with a set of <a href="#profile-predefined">predefined profiles</a>. Those profiles can be extended by defining a custom profile with the same name of the profile to extend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>generator</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generator definitions. See <a href="#generator-enricher-definition">below</a> for the format of this definitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>enricher</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of enrichers definitions. See <a href="#generator-enricher-definition">below</a> for the format of this definitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>order</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order of the profile which is used when profiles of the same name are merged.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="generator-enricher-definition">9.1. Generator and Enricher definitions</h3>
<div class="paragraph">
<p>The definition of generators and enrichers in the profile follow the same format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Generator and Enericher definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>includes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generators or enrichers to include. The order in the list determines the order in which the processors are applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>excludes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of generators or enrichers. These have precedences over <em>includes</em> and will exclude a processor even when referenced in an <em>includes</em> sections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>config</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for genertors or enrichers. This is a map where the keys are the name of the processor to configure and the value is again a map with configuration keys and values specific to the processor. See the documentation of the respective generator or enricher for the available configuration keys.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="profiles-lookup-order">9.2. Lookup order</h3>
<div class="paragraph">
<p>Profiles can be defined externally either directly as a build resource in <code>src/main/jkube/profiles.yml</code> or provided as part of a plugin&#8217;s dependency where it is supposed to be included as <code>META-INF/jkube/profiles.yml</code>. Multiple profiles can be include in these <code>profiles.yml</code> descriptors as a list:</p>
</div>
<div class="paragraph">
<p>If a profile is <a href="#profiles-using">used</a> then it is looked up from various places in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the compile and plugin classpath from <code>META-INF/jkube/profiles-default.yml</code>. These files are reserved for profiles defined by this plugin</p>
</li>
<li>
<p>From the compile and plugin classpath from <code>META-INF/jkube/profiles.yml</code>. Use this location for defining your custom profiles which you want to include via dependencies.</p>
</li>
<li>
<p>From the project in <code>src/main/jkube/profiles.yml</code>. The directory can be tuned with the plugin option <code>resourceDir</code> (property: <code>jkube.resourceDir</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When multiple profiles of the same name are found, then these profiles are merged. If profile have an order number, then the <em>higher</em> order takes precedences when merging profiles.</p>
</div>
<div class="paragraph">
<p>For <em>includes</em> of the same processors, the processor is moved to the earliest position. E.g consider the following two profiles with the name <code>my-profile</code></p>
</div>
<div class="listingblock">
<div class="title">Profile A</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">name</span>: <span class="string"><span class="content">my-profile</span></span>
<span class="key">enricher</span>:
  <span class="key">includes</span>: <span class="string"><span class="content">[ e1, e2 ]</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Profile B</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">name</span>: <span class="string"><span class="content">my-profile</span></span>
<span class="key">enricher</span>:
  <span class="key">includes</span>: <span class="string"><span class="content">[ e3, e1 ]</span></span>
<span class="key">order</span>: <span class="string"><span class="content">10</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then when merged results in the following profile (when no order is given, it defaults to 0):</p>
</div>
<div class="listingblock">
<div class="title">Profile merged</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">name</span>: <span class="string"><span class="content">my-profile</span></span>
<span class="key">enricher</span>:
  <span class="key">includes</span>: <span class="string"><span class="content">[ e1, e2, e3 ]</span></span>
<span class="key">order</span>: <span class="string"><span class="content">10</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Profile with the same order number are merged according to the lookup order described above, where the latter profile is supposed to have a higher order.</p>
</div>
<div class="paragraph">
<p>The configuration for enrichers and generators are merged, too, where higher order profiles override configuration values with the same key of lower order profile configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="profiles-using">9.3. Using Profiles</h3>
<div class="paragraph">
<p>Profiles can be selected by defining them in the plugin configuration, by giving a system property or by using <a href="#profile-resource-fragments">special directories</a> in the directory holding the resource fragments.</p>
</div>
<div class="paragraph">
<div class="title">Profile used in plugin configuration</div>
<p>Here is an example how the profile can be used in a plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;profile&gt;</span>my-spring-boot-apps<span class="tag">&lt;/profile&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    .....
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name which select the profile from the <code>profiles.yml</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Profile as system property</div>
<p>Alternatively a profile can be also specified on the command line when calling Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Djkube.profile=my-spring-boot-apps k8s:build k8s:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration for enrichers and generators are provided as part of the plugin&#8217;s <code>&lt;configuration&gt;</code> then this takes precedence over any profile specified.</p>
</div>
<div id="profiles-resource-fragments" class="paragraph">
<div class="title">Profiles for resource fragments</div>
<p>Profiles are also very useful when used together with resource fragments in <code>src/main/jkube</code>. By default the resource objects defined here are enriched with the configured profile (if any). A different profile can be selected easily by using a sub directory within <code>src/main/jkube</code>. The name of each sub directory is interpreted as a profile name and all resource definition files found in this sub directory are enhanced with the enhancers defined in this profile.</p>
</div>
<div class="paragraph">
<p>For example, consider the following directory layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>src/main/k8s:
  app-rc.yml
  app-svc.yml
  raw/ --&gt;
    couchbase-rc.yml
    couchbase-svc.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the resource descriptors <code>app-rc.yml</code> and <code>app-svc.yml</code> are enhanced with the enrichers defined in the main configuration. The files two files <code>couchbase-rc.yml</code> and <code>couchbase-svc.yml</code> in the sub directory <code>raw/</code> instead are enriched with the profile <strong>raw</strong>. This is a predefined profile which includes no enricher at all, so the couchbase resource objects are not enriched and taken over literally. This is an easy way how you can fine tune enrichment for different object set.</p>
</div>
</div>
<div class="sect2">
<h3 id="profiles-predefined">9.4. Predefined Profiles</h3>
<div class="paragraph">
<p>This plugin comes with a list of the following predefined profiles:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Predefined Profiles</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Profile</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>default</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default profile which is active if no profile is specified. It consists of a curated set of generator and enrichers. See <a href="#profiles-default">below</a> for the current definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>minimal</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This profile contains no generators and only enrichers for adding default objects (controller and services). No other enrichment is included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>explicit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like default but without adding default objects like controllers and services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>aggregate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes no generators and only the <a href="#jkube-dependency">jkube-dependency</a> enricher for picking up and combining resources from the compile time dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>internal-microservice</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not expose a port for the service to generate. Otherwise the same as the <em>default</em> profile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>osio</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes everything in the <em>default</em> profile, plus additional enrichers and generators relevant only to <a href="https://openshift.io">OpenShift.io</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="profiles-extended">9.5. Extending Profiles</h3>
<div class="paragraph">
<p>A profile can also extend another profile to avoid repetition e.g of generators if the profile is only about including certain enrichers. For example, for a profile like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: minimal</span><span class="content">
   extends: default
   enricher:
     includes:
      - jkube-name
      - jkube-controller
      - jkube-service
      - jkube-image
      - jkube-project-label
      - jkube-debug
      - jkube-namespace
      - jkube-metadata
      - jkube-controller-from-configuration
      - jkube-openshift-deploymentconfig
      - jkube-openshift-project
      - jkube-openshift-service-expose
      - jkube-openshift-route</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>one then would not need to repeat all generators as they are inherited from the <code>default</code> profile.</p>
</div>
<div id="profiles-default" class="listingblock">
<div class="title">Default Profile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Default profile which is always activated</span>
- <span class="string"><span class="content">name: default</span></span>
  <span class="key">enricher</span>:
    <span class="comment"># The order given in &quot;includes&quot; is the order in which enrichers are called</span>
    <span class="key">includes</span>:
    - <span class="string"><span class="content">jkube-metadata</span></span>
    - <span class="string"><span class="content">jkube-name</span></span>
    - <span class="string"><span class="content">jkube-controller</span></span>
    - <span class="string"><span class="content">jkube-controller-from-configuration</span></span>
    - <span class="string"><span class="content">jkube-service</span></span>
    - <span class="string"><span class="content">jkube-namespace</span></span>
    - <span class="string"><span class="content">jkube-image</span></span>
    - <span class="string"><span class="content">jkube-portname</span></span>
    - <span class="string"><span class="content">jkube-project-label</span></span>
    - <span class="string"><span class="content">jkube-dependency</span></span>
    - <span class="string"><span class="content">jkube-pod-annotations</span></span>
    - <span class="string"><span class="content">jkube-git</span></span>
    - <span class="string"><span class="content">jkube-maven-scm</span></span>
    - <span class="string"><span class="content">jkube-serviceaccount</span></span>
    - <span class="string"><span class="content">jkube-maven-issue-mgmt</span></span>
    <span class="comment"># TODO: Documents and verify enrichers below</span>
    - <span class="string"><span class="content">jkube-debug</span></span>
    - <span class="string"><span class="content">jkube-remove-build-annotations</span></span>
    - <span class="string"><span class="content">jkube-volume-permission</span></span>
    - <span class="string"><span class="content">jkube-configmap-file</span></span>
    - <span class="string"><span class="content">jkube-secret-file</span></span>

    <span class="comment"># Route exposure</span>
    - <span class="string"><span class="content">jkube-openshift-service-expose</span></span>
    - <span class="string"><span class="content">jkube-openshift-route</span></span>
    - <span class="string"><span class="content">jkube-openshift-deploymentconfig</span></span>
    - <span class="string"><span class="content">jkube-openshift-project</span></span>

    <span class="comment"># -----------------------------------------</span>
    <span class="comment"># TODO: Document and verify enrichers below</span>
    <span class="comment"># Health checks</span>
    - <span class="string"><span class="content">jkube-healthcheck-quarkus</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-spring-boot</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-wildfly-swarm</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-thorntail-v2</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-karaf</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-vertx</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-docker</span></span>
    - <span class="string"><span class="content">jkube-healthcheck-webapp</span></span>
    - <span class="string"><span class="content">jkube-prometheus</span></span>
    <span class="comment"># Dependencies shouldn't be enriched anymore, therefor it's last in the list</span>
    - <span class="string"><span class="content">jkube-dependency</span></span>
    - <span class="string"><span class="content">jkube-revision-history</span></span>
    - <span class="string"><span class="content">jkube-docker-registry-secret</span></span>
    - <span class="string"><span class="content">jkube-triggers-annotation</span></span>
    - <span class="string"><span class="content">jkube-openshift-imageChangeTrigger</span></span>

  <span class="key">generator</span>:
    <span class="comment"># The order given in &quot;includes&quot; is the order in which generators are called</span>
    <span class="key">includes</span>:
    - <span class="string"><span class="content">quarkus</span></span>
    - <span class="string"><span class="content">spring-boot</span></span>
    - <span class="string"><span class="content">wildfly-swarm</span></span>
    - <span class="string"><span class="content">thorntail-v2</span></span>
    - <span class="string"><span class="content">karaf</span></span>
    - <span class="string"><span class="content">vertx</span></span>
    - <span class="string"><span class="content">java-exec</span></span>
    - <span class="string"><span class="content">webapp</span></span>
  <span class="key">watcher</span>:
    <span class="key">includes</span>:
    - <span class="string"><span class="content">spring-boot</span></span>
    - <span class="string"><span class="content">docker-image</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access-configuration">10. Access configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="docker-access">10.1. Docker Access</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This section is work-in-progress and not yet finished
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Kubernetes builds the kubernetes-maven-plugin uses the Docker remote API so the URL of your Docker Daemon must be specified. The URL can be specified by the dockerHost or machine configuration, or by the <code>DOCKER_HOST</code> environment variable. If not given</p>
</div>
<div class="paragraph">
<p>The Docker remote API supports communication via SSL and
authentication with certificates.  The path to the certificates can
be specified by the certPath or machine configuration, or by the
<code>DOCKER_CERT_PATH</code> environment variable.</p>
</div>
</div>
<div class="sect2">
<h3 id="openshift-and-kubernetes-access">10.2. OpenShift and Kubernetes Access</h3>
<div class="paragraph">
<p>If no <code>DOCKER_HOST</code> is set and no unix socket could be accessed under <code>/var/run/docker.sock</code> then f-m-p checks whethe <a href="https://github.com/jkubeio/gojkube.gojkube" class="bare">https://github.com/jkubeio/gojkube.gojkube</a>. is in the path and uses <code>gojkube.docker-env</code> to get the connection parameter to the Docker host exposed by</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry">11. Registry handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker uses registries to store images. The registry is typically
specified as part of the name. I.e. if the first part (everything
before the first <code>/</code>) contains a dot (<code>.</code>) or colon (<code>:</code>) this part is
interpreted as an address (with an optionally port) of a remote
registry. This registry (or the default <code>docker.io</code> if no
registry is given) is used during push and pull operations. This
plugin follows the same semantics, so if an image name is specified
with a registry part, this registry is contacted. Authentication is
explained in the next <a href="#_authentication">section</a>.</p>
</div>
<div class="paragraph">
<p>There are some situations however where you want to have more
flexibility for specifying a remote registry. This might be because
you do not want to hard code a registry into <code>pom.xml</code> but
provide it from the outside with an environment variable or a system
property.</p>
</div>
<div class="paragraph">
<p>This plugin supports various ways of specifying a registry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the image name contains a registry part, this registry is used
unconditionally and can not be overwritten from the outside.</p>
</li>
<li>
<p>If an image name doesn&#8217;t contain a registry, then by default the
default Docker registry <code>docker.io</code> is used for push and pull
operations. But this can be overwritten through various means:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>&lt;image&gt;</code> configuration contains a <code>&lt;registry&gt;</code> subelement
this registry is used.</p>
</li>
<li>
<p>Otherwise, a global configuration element <code>&lt;registry&gt;</code> is
evaluated which can be also provided as system property via
<code>-Ddocker.registry</code>.</p>
</li>
<li>
<p>Finally an environment variable <code>DOCKER_REGISTRY</code> is looked up for
detecting a registry.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This registry is used for pulling (i.e. for autopull the base image
when doing a <code>jkube:build</code>) and pushing with <code>jkube:push</code>. However,
when these two goals a are combined on the command line like in <code>mvn
-Ddocker.registry=myregistry:5000 package jkube:build jkube:push</code>
the same registry is used for both operation. For a more fine grained
control, separate registries for <em>pull</em> and <em>push</em> can be specified.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the plugin&#8217;s configuration with the parameters <code>&lt;pullRegistry&gt;</code> and
<code>&lt;pushRegistry&gt;</code>, respectively.</p>
</li>
<li>
<p>With the system properties <code>docker.pull.registry</code> and
<code>docker.push.registry</code>, respectively.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;registry&gt;</span>docker.jolokia.org:443<span class="tag">&lt;/registry&gt;</span>
  <span class="tag">&lt;images&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="comment">&lt;!-- Without an explicit registry ... --&gt;</span>
      <span class="tag">&lt;name&gt;</span>jolokia/jolokia-java<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- ... hence use this registry --&gt;</span>
      <span class="tag">&lt;registry&gt;</span>docker.ro14nd.de<span class="tag">&lt;/registry&gt;</span>
      ....
    <span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="tag">&lt;name&gt;</span>postgresql<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- No registry in the name, hence use the globally
           configured docker.jolokia.org:443 as registry --&gt;</span>
      ....
    <span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="comment">&lt;!-- Explicitely specified always wins --&gt;</span>
      <span class="tag">&lt;name&gt;</span>docker.example.com:5000/another/server<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is some special behaviour when using an externally provided
registry like described above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When <em>pulling</em>, the image pulled will be also tagged with a repository
name <strong>without</strong> registry. The reasoning behind this is that this
image then can be referenced also by the configuration when the
registry is not specified anymore explicitly.</p>
</li>
<li>
<p>When <em>pushing</em> a local image, temporarily a tag including the
registry is added and removed after the push. This is required
because Docker can only push registry-named images.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication">12. Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When pulling (via the <code>autoPull</code> mode of <code>jkube:start</code>) or pushing image, it
might be necessary to authenticate against a Docker registry.</p>
</div>
<div class="paragraph">
<p>There are five different locations searched for credentials.  In order, these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Providing system properties <code>docker.username</code> and <code>docker.password</code> from the outside.</p>
</li>
<li>
<p>Using a <code>&lt;authConfig&gt;</code> section in the plugin configuration with <code>&lt;username&gt;</code> and <code>&lt;password&gt;</code> elements.</p>
</li>
<li>
<p>Using OpenShift configuration in <code>~/.config/kube</code></p>
</li>
<li>
<p>Using a <code>&lt;server&gt;</code> configuration in <code>~/.m2/settings.xml</code></p>
</li>
<li>
<p>Login into a registry with <code>docker login</code> (credentials in a credential helper or in <code>~/.docker/config.json</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the username and password directly in the <code>pom.xml</code> is not
recommended since this is widely visible. This is easiest and
transparent way, though. Using an <code>&lt;authConfig&gt;</code> is straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;image&gt;</span>consol/tomcat-7.0<span class="tag">&lt;/image&gt;</span>
    ...
    <span class="tag">&lt;authConfig&gt;</span>
      <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
      <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
    <span class="tag">&lt;/authConfig&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The system property provided credentials are a good compromise when
using CI servers like Jenkins. You simply provide the credentials from
the outside:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Ddocker.username=jolokia -Ddocker.password=s!cr!t jkube:push</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most <em>mavenish</em> way is to add a server to the Maven settings file <code>~/.m2/settings.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servers&gt;</span>
  <span class="tag">&lt;server&gt;</span>
    <span class="tag">&lt;id&gt;</span>docker.io<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
    <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
  <span class="tag">&lt;/server&gt;</span>
  ....
<span class="tag">&lt;/servers&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server id must specify the registry to push to/pull from, which by
default is central index <code>docker.io</code> (or <code>index.docker.io</code> / <code>registry.hub.docker.com</code> as fallbacks).
Here you should add your docker.io account for your repositories. If you have multiple accounts
for the same registry, the second user can be specified as part of the ID. In the example above, if you
have a second account 'jkubeio' then use an <code>&lt;id&gt;docker.org.eclipse.jkubeio&lt;/id&gt;</code> for this second entry. I.e. add the
username with a slash to the id name. The default without username is only taken if no server entry with
a username appended id is chosen.</p>
</div>
<div class="paragraph">
<p>The most <em>secure</em> way is to rely on docker&#8217;s credential store or credential helper and read confidential information
from an external credentials store, such as the native keychain of the operating system. Follow the instruction on
<a href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">the docker login documentation</a>.</p>
</div>
<div class="paragraph">
<p>As a final fallback, this plugin consults <code>$DOCKER_CONFIG/config.json</code> if <code>DOCKER_CONFIG</code> is set, or <code>~/.docker/config.json</code> if not, and reads credentials stored directly within this
file. This unsafe behavior happened when connecting to a registry with the command <code>docker login</code> from the command line
with older versions of docker (pre 1.13.0) or when docker is not configured to use a
<a href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">credential store</a>.</p>
</div>
<div class="sect2">
<h3 id="pull-vs-push-authentication">12.1. Pull vs. Push Authentication</h3>
<div class="paragraph">
<p>The credentials lookup described above is valid for both push and
pull operations. In order to narrow things down, credentials can be
provided for pull or push operations alone:</p>
</div>
<div class="paragraph">
<p>In an <code>&lt;authConfig&gt;</code> section a sub-section <code>&lt;pull&gt;</code> and/or <code>&lt;push&gt;</code>
can be added. In the example below the credentials provider are only
used for image push operations:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;image&gt;</span>consol/tomcat-7.0<span class="tag">&lt;/image&gt;</span>
    ...
    <span class="tag">&lt;authConfig&gt;</span>
      <span class="tag">&lt;push&gt;</span>
         <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
         <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
      <span class="tag">&lt;/push&gt;</span>
    <span class="tag">&lt;/authConfig&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the credentials are given on the command line as system
properties, then the properties <code>docker.pull.username</code> /
<code>docker.pull.password</code> and <code>docker.push.username</code> /
<code>docker.push.password</code> are used for pull and push operations,
respectively (when given). Either way, the standard lookup algorithm
as described in the previous section is used as fallback.</p>
</div>
</div>
<div class="sect2">
<h3 id="openshift-authentication">12.2. OpenShift Authentication</h3>
<div class="paragraph">
<p>When working with the default registry in OpenShift, the credentials
to authenticate are the OpenShift username and access token. So, a
typical interaction with the OpenShift registry from the outside is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc login
...
mvn -Ddocker.registry=docker-registry.domain.com:80/default/myimage \
    -Ddocker.username=$(oc whoami) \
    -Ddocker.password=$(oc whoami -t)</pre>
</div>
</div>
<div class="paragraph">
<p>(note, that the image&#8217;s username part ("default" here") must
correspond to an OpenShift project with the same name to which you
currently connected account has access).</p>
</div>
<div class="paragraph">
<p>This can be simplified by using the system property
<code>docker.useOpenShiftAuth</code> in which case the plugin does the
lookup. The equivalent to the example above is</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc login
...
mvn -Ddocker.registry=docker-registry.domain.com:80/default/myimage \
    -Ddocker.useOpenShiftAuth</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the configuration option <code>&lt;useOpenShiftAuth&gt;</code> can be
added to the <code>&lt;authConfig&gt;</code> section.</p>
</div>
<div class="paragraph">
<p>For dedicated <em>pull</em> and <em>push</em> configuration the system properties
<code>docker.pull.useOpenShiftAuth</code> and <code>docker.push.useOpenShiftAuth</code> are
available as well as the configuration option <code>&lt;useOpenShiftAuth&gt;</code> in
an <code>&lt;pull&gt;</code> or <code>&lt;push&gt;</code> section within the <code>&lt;authConfig&gt;</code>
configuration.</p>
</div>
<div class="paragraph">
<p>If <code>useOpenShiftAuth</code> is enabled then the OpenShift Konfiguration will be looked up in <code>$KUBECONFIG</code> or, if this environment variable is not set, in <code>~/.kube/config</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="password-encryption">12.3. Password encryption</h3>
<div class="paragraph">
<p>Regardless which mode you choose you can encrypt password as described
in the
<a href="http://maven.apache.org/guides/mini/guide-encryption.html">Maven documentation</a>. Assuming
that you have setup a <em>master password</em> in
<code>~/.m2/security-settings.xml</code> you can create easily encrypt
passwords:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mvn --encrypt-password
Password:
{QJ6wvuEfacMHklqsmrtrn1/ClOLqLm8hB7yUL23KOKo=}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This password then can be used in <code>authConfig</code>, <code>docker.password</code>
and/or the <code>&lt;server&gt;</code> setting configuration. However, putting an
encrypted password into <code>authConfig</code> in the <code>pom.xml</code> doesn&#8217;t make
much sense, since this password is encrypted with an individual master
password.</p>
</div>
</div>
<div class="sect2">
<h3 id="extended-authentication">12.4. Extended Authentication</h3>
<div class="paragraph">
<p>Some docker registries require additional steps to authenticate.
<a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/ECR_GetStarted.html">Amazon ECR</a> requires using an IAM access key to obtain temporary docker login credentials.
The <code>docker:push</code> and <code>docker:pull</code> goals automatically execute this exchange for any registry of the form <em>&lt;awsAccountId&gt;</em> <strong>.dkr.ecr.</strong> <em>&lt;awsRegion&gt;</em> <strong>.amazonaws.com</strong>, unless the <code>skipExtendedAuth</code> configuration (<code>docker.skip.extendedAuth</code> property) is set true.</p>
</div>
<div class="paragraph">
<p>Note that for an ECR repository with URI <code>123456789012.dkr.ecr.eu-west-1.amazonaws.com/example/image</code> the d-m-p&#8217;s <code>docker.registry</code> should be set to <code>123456789012.dkr.ecr.eu-west-1.amazonaws.com</code> and <code>example/image</code> is the <code>&lt;name&gt;</code> of the image.</p>
</div>
<div class="paragraph">
<p>You can use any IAM access key with the necessary permissions in any of the locations mentioned above except <code>~/.docker/config.json</code>.
Use the IAM <strong>Access key ID</strong> as the username and the <strong>Secret access key</strong> as the password.
In case you&#8217;re using temporary security credentials provided by the AWS Security Token Service (AWS STS), you have to provide the <strong>security token</strong> as well.
To do so, either specify the <code>docker.authToken</code> system property or provide an <code>&lt;auth&gt;</code> element alongside username &amp; password in the <code>authConfig</code>.</p>
</div>
<div class="paragraph">
<p>In case you are running on an EC2 instance that has an appropriate IAM role assigned
(e.g. a role that grants the AWS built-in policy <em>AmazonEC2ContainerRegistryPowerUser</em>)
authentication information doesn&#8217;t need to be provided at all. Instead the instance
meta-data service is queried for temporary access credentials supplied by the
assigned role.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="volume-configuration">13. Volume Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes maven plugin supports volume configuration in XML format in pom.xml. These are the volume types which are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Supported Volume Types</caption>
<colgroup>
<col style="width: 4.3478%;">
<col style="width: 95.6522%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Volume Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hostPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounts a file or directory from the host node&#8217;s filesystem into your pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emptyDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Containers in the Pod can all read and write the same files in the emptyDir volume, though that volume can be mounted at the same or different paths in each Container. When a Pod is removed from a node for any reason, the data in the emptyDir is deleted forever.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitRepo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It mounts an empty directory and clones a git repository into it for your Pod to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is used to pass sensitive information, such as passwords, to Pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfsPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows an existing NFS(Network File System) share to be mounted into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcePdName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounts a Google Compute Engine(GCE) into your Pod. You must create PD using <code>gcloud</code> or GCE API or UI before you can use it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">glusterFsPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a Glusterfs (an open source networked filesystem) volume to be mounted into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to mount a PersistentVolume into a Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">awsElasticBlockStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounts an Amazon Web Services(AWS) EBS Volume into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azureDisk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounts a Microsoft Azure Data Disk into a Pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azureFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounts a Microsoft Azure File Volume(SMB 2.1 and 3.0 into a Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cephfs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows an existing CephFS volume to be mounted into your Pod. You must have your own Ceph server running with the share exported before you can use it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows existing fibre channel volume to be mounted in a Pod. You must configure FC SAN Zoning to allocate and mask those LUNs (volumes) to the target WWNs beforehand so that Kubernetes hosts can access them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flocker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flocker is an open source clustered Container data volume manager. A <code>flocker</code> volume allows a Flocker dataset to be mounted into a Pod. You must have your own Flocker installation running before you can use it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iscsi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows an existing ISCSI(SCSI over IP) volume to be mounted into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">portworxVolume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A portworxVolume is an elastic block storage layer that runs hyperconverged with Kubernetes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quobyte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows existing <code>Quobyte</code> volume to be mounted into your Pod. You must have your own Quobyte setup running the volumes created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a Rados Block Device volume to be mounted into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scaleIO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ScaleIO is a software-based storage platform that can use existing hardware to create clusters of scalable shared block networked storage. The scaleIO volume plugin allows deployed Pods to access existing ScaleIO volumes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storageOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A storageos volume allows an existing StorageOS volume to be mounted into your Pod. You must run the StorageOS container on each node that wants to access StorageOS volumes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vsphereVolume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to mount a vSphere VMDK volume into your Pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">downwardAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A downwardAPI volume is used to make downward API data available to applications. It mounts a directory and writes the requested data in plain text files.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="faq">14. FAQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="general-questions">14.1. General questions</h3>
<div class="sect3">
<h4 id="how-do-i-define-an-environment-variable">14.1.1. How do I define an environment variable?</h4>
<div class="paragraph">
<p>The easiest way is to add a <code>src/main/jkube/deployment.yml</code> file to your project containing something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
  <span class="key">template</span>:
    <span class="key">spec</span>:
      <span class="key">containers</span>:
        <span class="key">-env</span>:
          - <span class="string"><span class="content">name: FOO</span></span>
            <span class="key">value</span>: <span class="string"><span class="content">bar</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will generate an environment variable <code>$FOO</code> of value <code>bar</code></p>
</div>
<div class="paragraph">
<p>For a full list of the environments used in java base images, <a href="https://hub.docker.com/r/jkube.java-jboss-openjdk8-jdk">see this list</a></p>
</div>
</div>
<div class="sect3">
<h4 id="how-do-i-define-a-system-property">14.1.2. How do I define a system property?</h4>
<div class="paragraph">
<p>The simplest way is to add system properties to the <code>JAVA_OPTIONS</code> environment variable.</p>
</div>
<div class="paragraph">
<p>For a full list of the environments used in java base images, <a href="https://hub.docker.com/r/jkube.java-jboss-openjdk8-jdk">see this list</a></p>
</div>
<div class="paragraph">
<p>e.g. add a <code>src/main/jkube/deployment.yml</code> file to your project containing something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
 <span class="key">template</span>:
   <span class="key">spec</span>:
     <span class="key">containers</span>:
       - <span class="string"><span class="content">env:</span></span>
         - <span class="string"><span class="content">name: JAVA_OPTIONS</span></span>
           <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">-Dfoo=bar -Dxyz=abc</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will define the system properties <code>foo=bar</code> and <code>xyz=abc</code></p>
</div>
</div>
<div class="sect3">
<h4 id="how-do-i-mount-a-config-file-from-a-configmap">14.1.3. How do I mount a config file from a ConfigMap?</h4>
<div class="paragraph">
<p>First you need to create your <code>ConfigMap</code> resource via a file <code>src/main/jkube/configmap.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">data</span>:
  <span class="key">application.properties</span>: <span class="string"><span class="delimiter">|</span><span class="content">
    # spring application properties file
    welcome = Hello from Kubernetes ConfigMap!!!
    dummy = some value</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then mount the entry in the <code>ConfigMap</code> into your <code>Deployment</code> via a file <code>src/main/jkube/deployment.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">metadata</span>:
  <span class="key">annotations</span>:
    <span class="key">configmap.jkube.io/update-on-change</span>: <span class="string"><span class="content">${project.artifactId}</span></span>
<span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">spec</span>:
      <span class="key">volumes</span>:
        - <span class="string"><span class="content">name: config</span></span>
          <span class="key">configMap</span>:
            <span class="key">name</span>: <span class="string"><span class="content">${project.artifactId}</span></span>
            <span class="key">items</span>:
            - <span class="string"><span class="content">key: application.properties</span></span>
              <span class="key">path</span>: <span class="string"><span class="content">application.properties</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">volumeMounts:</span><span class="content">
            - name: config
              mountPath: /deployments/config</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is <a href="https://github.com/jkube.quickstarts/spring-boot-webmvc/tree/master/src/main/jkube">an example quickstart doing this</a></p>
</div>
<div class="paragraph">
<p>Note that the annotation <code>configmap.jkube.io/update-on-change</code> is optional; its used if your application is not capable of watching for changes in the <code>/deployments/config/application.properties</code> file. In this case if you are also running the <a href="https://github.com/jkubeio/configmapcontroller">configmapcontroller</a> then this will cause a rolling upgrade of your application to use the new <code>ConfigMap</code> contents as you change it.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-do-i-use-a-persistent-volume">14.1.4. How do I use a Persistent Volume?</h4>
<div class="paragraph">
<p>First you need to create your <code>PersistentVolumeClaim</code> resource via a file <code>src/main/jkube/foo-pvc.yml</code> where <code>foo</code> is the name of the <code>PersistentVolumeClaim</code>. It might be your app requires multiple vpersistent volumes so you will need multiple <code>PersistentVolumeClaim</code> resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
  <span class="key">accessModes</span>:
  - <span class="string"><span class="content">ReadWriteOnce</span></span>
  <span class="key">resources</span>:
    <span class="key">requests</span>:
      <span class="key">storage</span>: <span class="string"><span class="content">100Mi</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to mount the <code>PersistentVolumeClaim</code> into your <code>Deployment</code> create a file <code>src/main/jkube/deployment.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
  <span class="key">template</span>:
    <span class="key">spec</span>:
      <span class="key">volumes</span>:
      - <span class="string"><span class="content">name: foo</span></span>
        <span class="key">persistentVolumeClaim</span>:
          <span class="key">claimName</span>: <span class="string"><span class="content">foo</span></span>
      <span class="key">containers</span>:
      - <span class="string"><span class="content">volumeMounts:</span></span>
        - <span class="string"><span class="content">mountPath: /whatnot</span></span>
          <span class="key">name</span>: <span class="string"><span class="content">foo</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the above defines the <code>PersistentVolumeClaim</code> called <code>foo</code> which is then mounted into the container at <code>/whatnot</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix">15. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="kindfilename-type-mapping">15.1. Kind/Filename Type Mapping</h3>
<table id="appendix-kind-mapping" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kind</th>
<th class="tableblock halign-left valign-top">Filename Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BuildConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc</code>, <code>buildconfig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterRole</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cr</code>, <code>crole</code>, <code>clusterrole</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConfigMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cm</code>, <code>configmap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterRoleBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>crb</code>, <code>clusterrb</code>, <code>clusterrolebinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CronJob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cj</code>, <code>cronjob</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CustomResourceDefinition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>crd</code>, <code>customerresourcedefinition</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DaemonSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ds</code>, <code>daemonset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DeploymentConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dc</code>, <code>deploymentconfig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImageStream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is</code>, <code>imagestream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImageStreamTag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>istag</code>, <code>imagestreamtag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ingress</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>job</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LimitRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lr</code>, <code>limitrange</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ns</code>, <code>namespace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuthClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oauthclient</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PolicyBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pb</code>, <code>policybinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pv</code>, <code>persistentvolume</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PersistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pvc</code>, <code>persistemtvolumeclaim</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProjectRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pr</code>, <code>projectrequest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicaSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rs</code>, <code>replicaset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicationController</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rc</code>, <code>replicationcontroller</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResourceQuota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rq</code>, <code>resourcequota</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleBinding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rb</code>, <code>rolebinding</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleBindingRestriction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rbr</code>, <code>rolebindingrestriction</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>route</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>svc</code>, <code>service</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServiceAccount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sa</code>, <code>serviceaccount</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StatefulSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statefulset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>template</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pd</code>, <code>pod</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="custom-kindfilename-mapping">15.2. Custom Kind/Filename Mapping</h3>
<div class="paragraph">
<p>You can add your custom <code>Kind/Filename</code> mappings.
To do it you have two approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting an environment variable or system property called <code>jkube.mapping</code> pointing out to a <code>.properties</code> files with pairs <code>&lt;kind&gt;&#8658;filename1&gt;, &lt;filename2&gt;</code>
By default if no environment variable nor system property is set, scan for a file located at classpath <code>/META-INF/jkube.kind-filename-type-mapping-default.properties</code>.</p>
</li>
<li>
<p>By embedding in MOJO configuration the mapping:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>k8s-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;mappings&gt;</span>
      <span class="tag">&lt;mapping&gt;</span>
        <span class="tag">&lt;kind&gt;</span>Var<span class="tag">&lt;/kind&gt;</span>
        <span class="tag">&lt;filenameTypes&gt;</span>foo, bar<span class="tag">&lt;/filenameTypes&gt;</span>
      <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/mappings&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.1.0<br>
Last updated 2019-12-23 22:18:04 +0530
</div>
</div>
</body>
</html>